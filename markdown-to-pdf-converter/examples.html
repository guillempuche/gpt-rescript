<style>body {word-wrap: break-word;}</style><h1>ReScript Code Examples</h1><p>This document contains a collection of code examples in ReScript.</p><h2>chat-script--chat-box</h2><p>Rescript v11</p>
<p>Repo: https://github.com/Exegetech/chat-rescript</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;frontend&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;,
    &quot;dev&quot;: &quot;vite&quot;,
    &quot;build&quot;: &quot;vite build&quot;,
    &quot;preview&quot;: &quot;vite preview&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;0.5.0&quot;,
    &quot;@rescript/react&quot;: &quot;0.11.0&quot;,
    &quot;shared&quot;: &quot;workspace:*&quot;,
    &quot;daisyui&quot;: &quot;3.9.2&quot;,
    &quot;react&quot;: &quot;18.2.0&quot;,
    &quot;react-dom&quot;: &quot;18.2.0&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.4&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@vitejs/plugin-react&quot;: &quot;4.0.0&quot;,
    &quot;autoprefixer&quot;: &quot;10.4.15&quot;,
    &quot;postcss&quot;: &quot;8.4.28&quot;,
    &quot;tailwindcss&quot;: &quot;3.3.3&quot;,
    &quot;vite&quot;: &quot;4.4.9&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Chat__Box.res</p>
<pre class="codehilite"><code>module Bubble = Chat__Bubble
module Input = Chat__Input

@react.component
let make = (
  ~chats: array&lt;Message.ToClient.t&gt;,
  ~currentUser: string,
  ~onSubmit: (string, string) =&gt; (),
) =&gt; {
  let bottomRef = React.useRef(Nullable.null)

  React.useEffect1(() =&gt; {
    switch Nullable.toOption(bottomRef.current) {
      | Some(dom) =&gt; dom-&gt;AppDom.scrollIntoView
      | None =&gt; ()
    }

    None
  }, [chats]);

  let usersColor = Util.makeUsersColorDict(currentUser, chats)

  let handleSubmit = (message) =&gt; {
    onSubmit(currentUser, message)
  }

  &lt;div&gt;
    &lt;div className=`
      bg-slate-100
      p-4
      h-[40rem]
      overflow-y-scroll
      rounded-t-lg
    `&gt;
      {Array.mapWithIndex(chats, (chat, idx) =&gt; {
        &lt;Bubble
          key={Int.toString(idx)}
          usersColor
          currentUser
          chat
        /&gt;
      })-&gt;React.array}

      &lt;div ref={ReactDOM.Ref.domRef(bottomRef)} /&gt;
    &lt;/div&gt;

    &lt;Input
      onSubmit={handleSubmit}
    /&gt;
  &lt;/div&gt;
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Chat__Box.resi</p>
<pre class="codehilite"><code>@react.component
let make: (
  ~chats: array&lt;Message.ToClient.t&gt;,
  ~currentUser: string,
  ~onSubmit: (string, string) =&gt; (),
) =&gt; Jsx.element
</code></pre>

<p>=========== End file</p><h2>brightid--bot</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Bot.res</p>
<pre class="codehilite"><code>open Discord
open NodeFetch
open Shared

let {brightIdVerificationEndpoint} = module(Endpoints)
let {context} = module(Constants)

module type Command = {
  let data: SlashCommandBuilder.t
  let execute: Interaction.t =&gt; promise&lt;unit&gt;
}
module type Button = {
  let customId: string
  let execute: Interaction.t =&gt; promise&lt;unit&gt;
}

@val @scope(&quot;globalThis&quot;)
external fetch: (string, 'params) =&gt; promise&lt;Response.t&lt;JSON.t&gt;&gt; = &quot;fetch&quot;

Env.createEnv()

let envConfig = Env.getConfig()

@raises([Env.Error])
let envConfig = switch envConfig {
| Ok(envConfig) =&gt; envConfig
| Error(err) =&gt; err-&gt;Env.EnvError-&gt;raise
}

@raises([Env.Error])
let gistConfig = () =&gt; {
  let id = envConfig[&quot;gistId&quot;]
  let name = &quot;guildData.json&quot;
  let token = envConfig[&quot;githubAccessToken&quot;]
  Utils.Gist.makeGistConfig(~id, ~name, ~token)
}

let options: Client.clientOptions = {
  intents: [&quot;GUILDS&quot;, &quot;GUILD_MESSAGES&quot;, &quot;GUILD_MEMBERS&quot;],
  partials: [&quot;GUILD_MEMBER&quot;],
}

let client = Client.createDiscordClient(~options)

let commands: Collection.t&lt;string, module(Command)&gt; = Collection.make()
let buttons: Collection.t&lt;string, module(Button)&gt; = Collection.make()

// One by one is the only way I can find to do this atm. Hopefully we find a better way
let _ =
  commands
  -&gt;Collection.set(Commands_Help.data-&gt;SlashCommandBuilder.getCommandName, module(Commands_Help))
  -&gt;Collection.set(
    Commands_Verify.data-&gt;SlashCommandBuilder.getCommandName,
    module(Commands_Verify),
  )
  -&gt;Collection.set(
    Commands_Invite.data-&gt;SlashCommandBuilder.getCommandName,
    module(Commands_Invite),
  )

let _ =
  buttons
  -&gt;Collection.set(Buttons_Verify.customId, module(Buttons_Verify))
  -&gt;Collection.set(Buttons_Sponsor.customId, module(Buttons_Sponsor))
  -&gt;Collection.set(Buttons_PremiumSponsor.customId, module(Buttons_PremiumSponsor))

type missingFields = RoleID
let missingFields = guild =&gt; ()

let validateConfig = async (config, decoder) =&gt; {
  open Utils.Gist
  try {
    let brightIdGuilds = await ReadGist.content(~config, ~decoder)
    brightIdGuilds-&gt;Dict.get(config.id)-&gt;Option.map(missingFields)
  } catch {
  | _ =&gt; None
  }
}

let updateGistOnGuildCreate = async (guild, roleId, content) =&gt; {
  open Utils

  let guildId = guild-&gt;Guild.getGuildId

  let entry = {
    open Shared.BrightId.Gist
    {
      name: guild-&gt;Guild.getGuildName-&gt;Some,
      role: Some(&quot;Verified&quot;),
      roleId: Some(roleId),
      inviteLink: None,
      sponsorshipAddress: None,
      sponsorshipAddressEth: None,
      usedSponsorships: None,
      assignedSponsorships: None,
      premiumSponsorshipsUsed: None,
      premiumExpirationTimestamp: None,
    }
  }

  await Gist.UpdateGist.addEntry(~content, ~config=gistConfig(), ~key=guildId, ~entry)
}

let rec fetchContextIds = async (~retry=5, ()) =&gt; {
  open Decode
  let requestTimeout = 60000
  let endpoint = `${brightIdVerificationEndpoint}/${context}`
  let params = {
    &quot;method&quot;: &quot;GET&quot;,
    &quot;headers&quot;: {
      &quot;Accept&quot;: &quot;application/json&quot;,
      &quot;Content-Type&quot;: &quot;application/json&quot;,
    },
    &quot;timestamp&quot;: requestTimeout,
  }
  let res = await fetch(endpoint, params)
  let json = await Response.json(res)
  switch (
    json-&gt;Json.decode(Decode_BrightId.Verifications.data),
    json-&gt;Json.decode(Decode_BrightId.Error.data),
  ) {
  | (Ok({data}), _) =&gt; Set.fromArray(data.contextIds)
  | (_, Ok(error)) =&gt;
    let retry = retry - 1
    switch retry {
    | 0 =&gt; error-&gt;Exceptions.BrightIdError-&gt;raise
    | _ =&gt; await fetchContextIds(~retry, ())
    }
  | (Error(error), _) =&gt;
    let retry = retry - 1
    switch retry {
    | 0 =&gt; error-&gt;Json.Decode.DecodeError-&gt;raise
    | _ =&gt; await fetchContextIds(~retry, ())
    }
  }
}

let assignRoleOnCreate = async (guild, role) =&gt; {
  let maybeMembers = switch await guild-&gt;Guild.getGuildMemberManager-&gt;GuildMemberManager.fetchAll {
  | exception _ =&gt; None
  | members =&gt; Some(members)
  }
  let contextIds = await fetchContextIds()

  let filterVerifiedMembers = (guildMember, contextIds) =&gt;
    guildMember
    -&gt;GuildMember.getGuildMemberId
    -&gt;UUID.v5(envConfig[&quot;uuidNamespace&quot;])
    -&gt;Set.has(contextIds, _)

  let assignRoleToGuildMember = (guildMember, role) =&gt; {
    guildMember-&gt;GuildMember.getGuildMemberRoleManager-&gt;GuildMemberRoleManager.add(role, ())
  }

  let makeAddRolePromises = members =&gt; {
    Collection.filter(members, filterVerifiedMembers(_, contextIds))
    -&gt;Collection.mapValues(assignRoleToGuildMember(_, role))
    -&gt;Collection.values
  }

  let addRolePromises = Option.map(maybeMembers, makeAddRolePromises)

  switch addRolePromises {
  | None =&gt; 0
  | Some(promises) =&gt;
    switch await Promise.all(promises) {
    | exception e =&gt; raise(e)
    | results =&gt; Array.length(results)
    }
  }
}

let onGuildCreate = async guild =&gt; {
  open Utils
  open Shared.Decode
  let roleManager = guild-&gt;Guild.getGuildRoleManager
  let guildId = guild-&gt;Guild.getGuildId
  let guildName = guild-&gt;Guild.getGuildName

  let id = envConfig[&quot;gistId&quot;]
  let name = &quot;guildData.json&quot;
  let token = envConfig[&quot;githubAccessToken&quot;]
  let config = Gist.makeGistConfig(~id, ~name, ~token)

  let role = await RoleManager.create(
    roleManager,
    {
      name: &quot;Verified&quot;,
      color: &quot;ORANGE&quot;,
      reason: &quot;Create a role to mark verified users with BrightID&quot;,
    },
  )
  switch role {
  | exception e =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
  | role =&gt;
    let content = await Gist.ReadGist.content(~config, ~decoder=Decode_Gist.brightIdGuilds)

    switch await updateGistOnGuildCreate(guild, role-&gt;Role.getRoleId, content) {
    | exception e =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
    | _ =&gt;
      Console.log(`${guildName} : ${guildId}: Successfully added to the database`)

      switch await assignRoleOnCreate(guild, role) {
      | exception e =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
      | verifiedMembersCount =&gt;
        Console.log(
          `${guildName} : ${guildId}: Successfully assigned role to ${Int.toString(
              verifiedMembersCount,
            )} current members`,
        )
      }
    }
  }
}

let onInteraction = async (interaction: Interaction.t) =&gt; {
  let guildId = interaction-&gt;Interaction.getGuild-&gt;Guild.getGuildId
  let guildName = interaction-&gt;Interaction.getGuild-&gt;Guild.getGuildName
  let isCommand = interaction-&gt;Interaction.isCommand
  let isButton = interaction-&gt;Interaction.isButton
  let user = interaction-&gt;Interaction.getUser
  switch (isCommand, isButton) {
  | (true, false) =&gt; {
      let commandName = interaction-&gt;Interaction.getCommandName
      let command = commands-&gt;Collection.get(commandName)
      switch command-&gt;Nullable.toOption {
      | None =&gt; Console.error(`${guildName} : ${guildId}: Command ${commandName} not found `)
      | Some(module(Command)) =&gt;
        switch await Command.execute(interaction) {
        | exception e =&gt;
          switch e {
          | Exceptions.BrightIdError({errorMessage}) =&gt;
            Console.error2(`${guildName} : ${guildId}: `, errorMessage)
          | Exceptions.VerifyCommandError(msg) =&gt; Console.error2(`${guildName} : ${guildId}: `, msg)
          | Exceptions.InviteCommandError(msg) =&gt; Console.error2(`${guildName} : ${guildId}: `, msg)
          | JsError(obj) =&gt; Console.error2(`${guildName} : ${guildId}: `, obj)
          | _ =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
          }
        | _ =&gt;
          Console.log(
            `${guildName} : ${guildId}: Successfully served the command ${commandName} for ${user-&gt;User.getUsername}`,
          )
        }
      }
    }

  | (false, true) =&gt; {
      let buttonCustomId = interaction-&gt;Interaction.getCustomId

      let button = buttons-&gt;Collection.get(buttonCustomId)
      switch button-&gt;Nullable.toOption {
      | None =&gt; Console.error(`${guildName} : ${guildId}: Button ${buttonCustomId} not found `)
      | Some(module(Button)) =&gt;
        switch await Button.execute(interaction) {
        | exception e =&gt;
          switch e {
          | Exceptions.BrightIdError({errorMessage}) =&gt;
            Console.error2(`${guildName} : ${guildId}: `, errorMessage)
          | Exceptions.PremiumSponsorButtonError(msg) =&gt;
            Console.error2(`${guildName} : ${guildId}: `, msg)
          | Exceptions.SponsorButtonError(msg) =&gt; Console.error2(`${guildName} : ${guildId}: `, msg)
          | Exceptions.ButtonVerifyHandlerError(msg) =&gt;
            Console.error2(`${guildName} : ${guildId}: `, msg)
          | JsError(obj) =&gt; Console.error2(`${guildName} : ${guildId}: `, obj)
          | _ =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
          }
        | _ =&gt;
          Console.log(
            `${guildName} : ${guildId}: Successfully served button press &quot;${buttonCustomId}&quot; for ${user-&gt;User.getUsername}`,
          )
        }
      }
    }

  | (_, _) =&gt; Console.error(&quot;Bot.res: Unknown interaction&quot;)
  }
}

let onGuildDelete = async guild =&gt; {
  open Utils
  open Shared.Decode

  let guildId = Guild.getGuildId(guild)
  let guildName = Guild.getGuildName(guild)

  switch await Gist.ReadGist.content(~config=gistConfig(), ~decoder=Decode_Gist.brightIdGuilds) {
  | exception JsError(e) =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
  | guilds =&gt;
    switch guilds-&gt;Dict.get(guildId) {
    | Some(_) =&gt;
      switch await Gist.UpdateGist.removeEntry(
        ~content=guilds,
        ~key=guildId,
        ~config=gistConfig(),
      ) {
      | _ =&gt; Console.log(`${guildName} : ${guildId}: Successfully removed guild data`)
      | exception JsError(e) =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
      }

    | None =&gt; Console.error(`${guildName} : ${guildId}: Could not find guild data to delete`)
    }
  }
}

let onGuildMemberAdd = async guildMember =&gt; {
  open Utils
  open Services_VerificationInfo

  let guildName = guildMember-&gt;GuildMember.getGuild-&gt;Guild.getGuildName
  let guildId = guildMember-&gt;GuildMember.getGuild-&gt;Guild.getGuildId
  let _ = switch await getBrightIdVerification(guildMember) {
  | VerificationInfo({unique}) =&gt;
    switch unique {
    | true =&gt;
      switch await Gist.ReadGist.content(
        ~config=gistConfig(),
        ~decoder=Decode.Decode_Gist.brightIdGuilds,
      ) {
      | exception e =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
      | guilds =&gt;
        let guild = guildMember-&gt;GuildMember.getGuild
        let guildId = guild-&gt;Guild.getGuildId
        let brightIdGuild = guilds-&gt;Dict.get(guildId)
        switch brightIdGuild {
        | None =&gt; Console.error2(`${guildName} : ${guildId}: `, `Guild does not exist in Gist`)
        | Some({roleId: None}) =&gt;
          Console.error2(`${guildName} : ${guildId}: `, `Guild does not have a saved roleId`)
        | Some({roleId: Some(roleId)}) =&gt;
          let role =
            guild
            -&gt;Guild.getGuildRoleManager
            -&gt;RoleManager.getCache
            -&gt;Collection.get(roleId)
            -&gt;Nullable.toOption
          switch role {
          | None =&gt; Console.error2(`${guildName} : ${guildId}: `, `Role does not exist`)
          | Some(role) =&gt;
            let guildMemberRoleManager = guildMember-&gt;GuildMember.getGuildMemberRoleManager
            let _ = switch await GuildMemberRoleManager.add(
              guildMemberRoleManager,
              role,
              ~reason=&quot;User is already verified by BrightID&quot;,
              (),
            ) {
            | exception e =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
            | _ =&gt;
              let uuid =
                guildMember-&gt;GuildMember.getGuildMemberId-&gt;UUID.v5(envConfig[&quot;uuidNamespace&quot;])
              Console.log(`${guildName} : ${guildId} verified the user with contextId: ${uuid}`)
            }
          }
        }
      }
    | false =&gt;
      Console.error2(
        `${guildName} : ${guildId}: `,
        `User ${guildMember-&gt;GuildMember.getDisplayName} is not unique`,
      )
    }
  | exception e =&gt;
    switch e {
    | Exceptions.BrightIdError({errorMessage}) =&gt;
      Console.error2(`${guildName} : ${guildId}: `, errorMessage)
    | JsError(obj) =&gt; Console.error2(`${guildName} : ${guildId}: `, obj)
    | _ =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
    }
  }
}

let onRoleUpdate = async role =&gt; {
  open Utils
  let guildId = role-&gt;Role.getGuild-&gt;Guild.getGuildId
  let guildName = role-&gt;Role.getGuild-&gt;Guild.getGuildName
  try {
    let brightIdGuilds = await Gist.ReadGist.content(
      ~config=gistConfig(),
      ~decoder=Decode.Decode_Gist.brightIdGuilds,
    )
    switch brightIdGuilds-&gt;Dict.get(guildId) {
    | None =&gt; Console.error2(`${guildName} : ${guildId}: `, `Guild does not exist in Gist`)
    | Some(brightIdGuild) =&gt;
      switch brightIdGuild.roleId {
      | None =&gt; Console.error2(`${guildName} : ${guildId}: `, `Guild does not have a saved roleId`)
      | Some(roleId) =&gt;
        let isVerifiedRole = role-&gt;Role.getRoleId === roleId
        switch isVerifiedRole {
        | true =&gt;
          let roleName = role-&gt;Role.getName
          let entry = {
            ...brightIdGuild,
            role: Some(roleName),
          }
          let _ = await Gist.UpdateGist.updateEntry(
            ~content=brightIdGuilds,
            ~entry,
            ~key=guildId,
            ~config=gistConfig(),
          )
          Console.log(`${guildName} : ${guildId} updated the role name to ${roleName}`)
        | false =&gt; ()
        }
      }
    }
  } catch {
  | e =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
  }
}

let onGuildMemberUpdate = async (_, newMember) =&gt; {
  open Utils
  open Services_VerificationInfo
  let guild = newMember-&gt;GuildMember.getGuild
  let guildName = guild-&gt;Guild.getGuildName
  let guildId = guild-&gt;Guild.getGuildId
  try {
    let brightIdGuilds = await Gist.ReadGist.content(
      ~config=gistConfig(),
      ~decoder=Decode.Decode_Gist.brightIdGuilds,
    )
    switch brightIdGuilds-&gt;Dict.get(guildId) {
    | None =&gt; ()
    | Some({roleId: None}) =&gt; ()
    | Some({roleId: Some(roleId)}) =&gt;
      let member =
        await guild
        -&gt;Guild.getGuildMemberManager
        -&gt;GuildMemberManager.fetchOne(newMember-&gt;GuildMember.getGuildMemberId)
      switch await getBrightIdVerification(member) {
      | VerificationInfo({unique}) =&gt;
        let guildMemberRoleManager = member-&gt;GuildMember.getGuildMemberRoleManager
        let roles = guildMemberRoleManager-&gt;GuildMemberRoleManager.getCache
        let role =
          guild
          -&gt;Guild.getGuildRoleManager
          -&gt;RoleManager.getCache
          -&gt;Collection.get(roleId)
          -&gt;Nullable.toOption
        switch (role, roles-&gt;Collection.has(roleId), unique) {
        | (None, _, _) =&gt; ()
        | (Some(role), true, false) =&gt;
          let _ = await GuildMemberRoleManager.removeRole(
            guildMemberRoleManager,
            role,
            ~reason=&quot;User is not verified by BrightID&quot;,
            (),
          )
        | (Some(role), false, true) =&gt;
          let guildMemberRoleManager = member-&gt;GuildMember.getGuildMemberRoleManager
          let _ = await GuildMemberRoleManager.add(
            guildMemberRoleManager,
            role,
            ~reason=&quot;User is verified by BrightID&quot;,
            (),
          )
        | (_, _, _) =&gt; ()
        }
      | exception e =&gt;
        switch e {
        | Exceptions.BrightIdError(_) =&gt;
          let role =
            guild
            -&gt;Guild.getGuildRoleManager
            -&gt;RoleManager.getCache
            -&gt;Collection.get(roleId)
            -&gt;Nullable.toOption
          let guildMemberRoleManager = newMember-&gt;GuildMember.getGuildMemberRoleManager
          switch role {
          | None =&gt; ()
          | Some(role) =&gt;
            let _ = switch await GuildMemberRoleManager.removeRole(
              guildMemberRoleManager,
              role,
              ~reason=&quot;User is not verified by BrightID&quot;,
              (),
            ) {
            | exception e =&gt;
              switch e {
              | Exn.Error(obj) =&gt;
                switch Exn.message(obj) {
                | Some(m) =&gt; Console.error2(`${guildName} : ${guildId}: `, m)
                | None =&gt; ()
                }
              | _ =&gt; ()
              }
            | _ =&gt; ()
            }
          }
        | Exn.Error(obj) =&gt;
          switch Exn.message(obj) {
          | Some(m) =&gt; Console.error2(`${guildName} : ${guildId}: `, m)
          | None =&gt; ()
          }
        | _ =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
        }
      }
    }
  } catch {
  | Exn.Error(obj) =&gt;
    switch Exn.message(obj) {
    | Some(m) =&gt; Console.error2(`${guildName} : ${guildId}: `, m)
    | None =&gt; ()
    }
  | e =&gt; Console.error2(`${guildName} : ${guildId}: `, e)
  }
}

client-&gt;Client.on(
  #ready(
    () =&gt; {
      Console.log(&quot;Logged In&quot;)
    },
  ),
)

client-&gt;Client.on(#guildCreate(guild =&gt; guild-&gt;onGuildCreate-&gt;ignore))

client-&gt;Client.on(#interactionCreate(interaction =&gt; interaction-&gt;onInteraction-&gt;ignore))

client-&gt;Client.on(#guildDelete(guild =&gt; guild-&gt;onGuildDelete-&gt;ignore))

client-&gt;Client.on(#guildMemberAdd(member =&gt; member-&gt;onGuildMemberAdd-&gt;ignore))

client-&gt;Client.on(#roleUpdate((~oldRole as _, ~newRole) =&gt; newRole-&gt;onRoleUpdate-&gt;ignore))

client-&gt;Client.on(
  #guildMemberUpdate((~oldMember, ~newMember) =&gt; onGuildMemberUpdate(oldMember, newMember)-&gt;ignore),
)

client-&gt;Client.login(envConfig[&quot;discordApiToken&quot;])-&gt;ignore
</code></pre>

<p>=========== End file</p><h2>fullstack--examples</h2><p>Rescript v10</p>
<p>Repo: https://github.com/skonky/fullstack</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;rescript-web&quot;,
  &quot;version&quot;: &quot;0.0.0&quot;,
  &quot;author&quot;: &quot;skonky&quot;,
  &quot;private&quot;: true,
  &quot;license&quot;: &quot;Apache-2.0&quot;,
  &quot;dependencies&quot;: {
    &quot;next&quot;: &quot;10.2.3&quot;,
    &quot;react&quot;: &quot;17.0.1&quot;,
    &quot;react-dom&quot;: &quot;17.0.1&quot;
  },
  &quot;scripts&quot;: {
    &quot;dev&quot;: &quot;concurrently \&quot;next dev -p 5000\&quot; \&quot;rescript build -w\&quot;&quot;,
    &quot;debug&quot;: &quot;NODE_OPTIONS='--inspect' next&quot;,
    &quot;build&quot;: &quot;rescript &amp;&amp; next build&quot;,
    &quot;now-build&quot;: &quot;rescript &amp;&amp; next build&quot;,
    &quot;export&quot;: &quot;next export&quot;,
    &quot;start&quot;: &quot;next start -p $PORT&quot;,
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:start&quot;: &quot;rescript build -w&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@rescript/react&quot;: &quot;0.10.3&quot;,
    &quot;autoprefixer&quot;: &quot;10.1.0&quot;,
    &quot;concurrently&quot;: &quot;^7.6.0&quot;,
    &quot;cssnano&quot;: &quot;5.0.5&quot;,
    &quot;daisyui&quot;: &quot;^2.51.3&quot;,
    &quot;gentype&quot;: &quot;4.1&quot;,
    &quot;next-transpile-modules&quot;: &quot;7.1.2&quot;,
    &quot;postcss&quot;: &quot;8.2.15&quot;,
    &quot;postcss-cli&quot;: &quot;8.3.1&quot;,
    &quot;rescript&quot;: &quot;9.1&quot;,
    &quot;tailwindcss&quot;: &quot;^3.0.23&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Examples.res</p>
<pre class="codehilite"><code>type todo = {
  id: int,
  title: string,
  isDone: bool,
}

type state = {newTodoValue: string, todos: array&lt;todo&gt;}

let initialState: state = {
  newTodoValue: &quot;&quot;,
  todos: [
    {
      id: 1,
      title: &quot;Initial todo&quot;,
      isDone: false,
    },
  ],
}

type actions =
  | CreateTodo
  | InputChanged(string)
  | RemoveTodo(int)
  | ClearCompleted
  | ToggleTodoStatus(int)

let reducer = (state, action) =&gt; {
  switch action {
  | CreateTodo =&gt; {
      newTodoValue: &quot;&quot;,
      todos: Js.Array.concat(
        [
          {
            title: state.newTodoValue,
            isDone: false,
            id: state.todos-&gt;Js.Array2.length + 1,
          },
        ],
        state.todos,
      ),
    }
  | InputChanged(newTodoValue) =&gt; {
      ...state,
      newTodoValue: newTodoValue,
    }
  | RemoveTodo(id) =&gt; {
      ...state,
      todos: state.todos-&gt;Js.Array2.filter(t =&gt; t.id != id),
    }
  | ClearCompleted =&gt; {
      ...state,
      todos: state.todos-&gt;Js.Array2.filter(todo =&gt; !todo.isDone),
    }
  | ToggleTodoStatus(id) =&gt; {
      ...state,
      todos: state.todos-&gt;Js.Array2.map(todo =&gt; {
        if todo.id == id {
          {
            ...todo,
            isDone: !todo.isDone,
          }
        } else {
          todo
        }
      }),
    }
  }
}

let default = () =&gt; {
  open Js.Array2

  let (state, dispatch) = React.useReducer(reducer, initialState)
  let handleClearAllCompletedTodos = _ =&gt; dispatch(ClearCompleted)

  let noTodosCompleted = state.todos-&gt;Js.Array2.find(todo =&gt; todo.isDone)-&gt;Belt.Option.isNone

  let handleChange = event =&gt; {
    let value = ReactEvent.Form.target(event)[&quot;value&quot;]
    dispatch(InputChanged(value))
  }

  let handleCreateTodo = _ =&gt; {
    dispatch(CreateTodo)
  }

  let handleDelete = (id, _) =&gt; {
    dispatch(RemoveTodo(id))
  }

  let handleToggleTodoStatus = (id, _) =&gt; {
    dispatch(ToggleTodoStatus(id))
  }

  &lt;div className=&quot;p-6&quot;&gt;
    &lt;input
      value=state.newTodoValue
      onChange={handleChange}
      className=&quot;input input-bordered mr-5&quot;
      placeholder=&quot;Type here&quot;
    /&gt;
    &lt;button onClick={handleCreateTodo} className=&quot;btn btn-primary mr-3&quot;&gt;
      {&quot;Create&quot;-&gt;React.string}
    &lt;/button&gt;
    &lt;button
      disabled=noTodosCompleted onClick={handleClearAllCompletedTodos} className=&quot;btn btn-success&quot;&gt;
      {&quot;Clear completed&quot;-&gt;React.string}
    &lt;/button&gt;
    &lt;div className=&quot;overflow-x-auto&quot;&gt;
      &lt;table className=&quot;table w-full mt-6&quot;&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th&gt; {&quot;#&quot;-&gt;React.string} &lt;/th&gt;
            &lt;th&gt; {&quot;Name&quot;-&gt;React.string} &lt;/th&gt;
            &lt;th className=&quot;text-right&quot;&gt; {&quot;Controls&quot;-&gt;React.string} &lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
          {state.todos
          -&gt;map(todo =&gt; {
            let todoClassName = todo.isDone ? &quot;p-3 line-through opacity-50&quot; : &quot;p-3&quot;
            &lt;tr key={Belt.Int.toString(todo.id)}&gt;
              &lt;td&gt; {Belt.Int.toString(todo.id)-&gt;React.string} &lt;/td&gt;
              &lt;td className=todoClassName&gt; {todo.title-&gt;React.string} &lt;/td&gt;
              &lt;td className=&quot;text-right&quot;&gt;
                &lt;button onClick={handleToggleTodoStatus(todo.id)} className=&quot;btn ml-3&quot;&gt;
                  {&quot;toggle&quot;-&gt;React.string}
                &lt;/button&gt;
                &lt;button onClick={handleDelete(todo.id)} className=&quot;btn btn-error ml-3&quot;&gt;
                  {&quot;delete&quot;-&gt;React.string}
                &lt;/button&gt;
              &lt;/td&gt;
            &lt;/tr&gt;
          })
          -&gt;React.array}
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/div&gt;
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Examples.resi</p>
<pre class="codehilite"><code>let default: unit =&gt; React.element
</code></pre>

<p>=========== End file</p><h2>brightid--sidebar</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Sidebar.res</p>
<pre class="codehilite"><code>module ConnectButton = {
  @react.component @module(&quot;@rainbow-me/rainbowkit&quot;)
  external make: (
    ~children: React.element=?,
    ~style: ReactDOM.Style.t=?,
    ~className: string=?,
  ) =&gt; 'b = &quot;ConnectButton&quot;
}

@react.component
let make = (~isSidebarVisible, ~handleIsSidebarVisible, ~guilds, ~loadingGuilds) =&gt; {
  open ReactProSidebar

  let icon = ({id, icon}: Types.oauthGuild) =&gt; {
    switch icon {
    | None =&gt; &quot;/assets/brightid_logo_white.png&quot;
    | Some(icon) =&gt; `https://cdn.discordapp.com/icons/${id}/${icon}.png`
    }
  }

  let sidebarElements = {
    switch (guilds, loadingGuilds) {
    | (_, true) =&gt;
      let intersection = guilds-&gt;Belt.Array.map((guild: Types.oauthGuild) =&gt; {
        &lt;Menu iconShape=&quot;square&quot; key={guild.id}&gt;
          &lt;MenuItem
            className=&quot;bg-extraDark&quot;
            icon={&lt;img
              className=&quot; bg-extraDark rounded-lg border-1 border-white&quot; src={guild-&gt;icon}
            /&gt;}&gt;
            &lt;Remix.Link
              className=&quot;font-semibold text-xl&quot; to={`/guilds/${guild.id}`} prefetch={#intent}&gt;
              {guild.name-&gt;React.string}
            &lt;/Remix.Link&gt;
          &lt;/MenuItem&gt;
        &lt;/Menu&gt;
      })
      let loading = Belt.Array.range(0, 4)-&gt;Belt.Array.map(i =&gt; {
        &lt;Menu iconShape=&quot;square&quot; key={(i + 1)-&gt;Belt.Int.toString}&gt;
          &lt;MenuItem
            className=&quot;flex animate-pulse flex-row h-full bg-extraDark &quot;
            icon={&lt;img
              className=&quot; bg-extraDark  rounded-lg&quot; src=&quot;/assets/brightid_logo_white.png&quot;
            /&gt;}&gt;
            &lt;div className=&quot;flex flex-col space-y-3&quot;&gt;
              &lt;div className=&quot;w-36 bg-gray-300 h-6 rounded-md &quot; /&gt;
            &lt;/div&gt;
          &lt;/MenuItem&gt;
        &lt;/Menu&gt;
      })
      intersection-&gt;Belt.Array.concat(loading)-&gt;React.array
    | ([], false) =&gt; &lt;p className=&quot;text-white&quot;&gt; {&quot;Couldn't Load Discord Servers&quot;-&gt;React.string} &lt;/p&gt;
    | (_, false) =&gt;
      switch guilds-&gt;Belt.Array.length {
      | 0 =&gt; &lt;p className=&quot;text-white&quot;&gt; {&quot;No Guilds&quot;-&gt;React.string} &lt;/p&gt;
      | _ =&gt;
        guilds
        -&gt;Belt.Array.map((guild: Types.oauthGuild) =&gt; {
          &lt;Menu iconShape=&quot;square&quot; key={guild.id}&gt;
            &lt;MenuItem
              className=&quot;bg-extraDark&quot;
              icon={&lt;img
                className=&quot; bg-extraDark rounded-lg border-1 border-white&quot; src={guild-&gt;icon}
              /&gt;}&gt;
              &lt;Remix.Link
                className=&quot;font-semibold text-xl&quot; to={`/guilds/${guild.id}`} prefetch={#intent}&gt;
                {guild.name-&gt;React.string}
              &lt;/Remix.Link&gt;
            &lt;/MenuItem&gt;
          &lt;/Menu&gt;
        })
        -&gt;React.array
      }
    }
  }

  &lt;ProSidebar
    className=&quot;bg-dark scrollbar-hide&quot;
    breakPoint=&quot;md&quot;
    onToggle={handleIsSidebarVisible}
    toggled={isSidebarVisible}&gt;
    &lt;SidebarHeader
      className=&quot;p-2 flex justify-around items-center top-0 sticky bg-dark z-10 scrollbar-hide&quot;&gt;
      &lt;InviteButton /&gt;
    &lt;/SidebarHeader&gt;
    &lt;SidebarContent className=&quot;scrollbar-hide&quot;&gt;
      &lt;Menu iconShape=&quot;square&quot; key={0-&gt;Belt.Int.toString} /&gt;
      {sidebarElements}
    &lt;/SidebarContent&gt;
    &lt;SidebarFooter className=&quot;bg-extraDark bottom-0 sticky scrollbar-hide list-none&quot;&gt;
      &lt;Remix.Link to={&quot;&quot;}&gt;
        &lt;MenuItem&gt;
          &lt;img src={&quot;/assets/brightid_reversed.svg&quot;} /&gt;
        &lt;/MenuItem&gt;
      &lt;/Remix.Link&gt;
    &lt;/SidebarFooter&gt;
  &lt;/ProSidebar&gt;
}
</code></pre>

<p>=========== End file</p><h2>chat-script--message-json</h2><p>Rescript v11</p>
<p>Repo: https://github.com/Exegetech/chat-rescript</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;shared&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;0.5.0&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.4&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Message__JSON.res</p>
<pre class="codehilite"><code>@unboxed
type rec json =
  | @as(false) False
  | @as(true) True
  | @as(null) Null
  | String(string)
  | Number(float)
  | Object(Dict.t&lt;json&gt;)
  | Array(array&lt;json&gt;)

@val
@scope(&quot;JSON&quot;)
external parseExn: string =&gt; json = &quot;parse&quot;

@val
@scope(&quot;JSON&quot;)
external stringifyExn: json =&gt; string = &quot;stringify&quot;

let parse = (payload: string): result&lt;json, string&gt; =&gt; {
  try {
    payload
    -&gt; parseExn
    -&gt; Ok
  } catch {
    | Exn.Error(obj) =&gt; {
      switch Exn.message(obj) {
        | Some(msg) =&gt; Error(msg)
        | None =&gt; Error(&quot;Unknown error&quot;)
      }
    }
  }
}

let stringify = (payload: json): result&lt;string, string&gt; =&gt; {
  try {
    payload
    -&gt; stringifyExn
    -&gt; Ok
  } catch {
    | Exn.Error(obj) =&gt; {
      switch Exn.message(obj) {
        | Some(msg) =&gt; Error(msg)
        | None =&gt; Error(&quot;Unknown error&quot;)
      }
    }
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Message__JSON.resi</p>
<pre class="codehilite"><code>@unboxed
type rec json =
  | @as(false) False
  | @as(true) True
  | @as(null) Null
  | String(string)
  | Number(float)
  | Object(Dict.t&lt;json&gt;)
  | Array(array&lt;json&gt;)

let parse: (string) =&gt; result&lt;json, string&gt; 
let stringify: (json) =&gt; result&lt;string, string&gt;
</code></pre>

<p>=========== End file</p><h2>chat-script--chat-input</h2><p>Rescript v11</p>
<p>Repo: https://github.com/Exegetech/chat-rescript</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;frontend&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;,
    &quot;dev&quot;: &quot;vite&quot;,
    &quot;build&quot;: &quot;vite build&quot;,
    &quot;preview&quot;: &quot;vite preview&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;0.5.0&quot;,
    &quot;@rescript/react&quot;: &quot;0.11.0&quot;,
    &quot;shared&quot;: &quot;workspace:*&quot;,
    &quot;daisyui&quot;: &quot;3.9.2&quot;,
    &quot;react&quot;: &quot;18.2.0&quot;,
    &quot;react-dom&quot;: &quot;18.2.0&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.4&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@vitejs/plugin-react&quot;: &quot;4.0.0&quot;,
    &quot;autoprefixer&quot;: &quot;10.4.15&quot;,
    &quot;postcss&quot;: &quot;8.4.28&quot;,
    &quot;tailwindcss&quot;: &quot;3.3.3&quot;,
    &quot;vite&quot;: &quot;4.4.9&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Chat__Input.res</p>
<pre class="codehilite"><code>@react.component
let make = (~onSubmit: (string) =&gt; unit) =&gt; {
  let (text, setText) = React.useState(() =&gt; &quot;&quot;)

  let handleInputChange = (event) =&gt; {
    let value = ReactEvent.Form.currentTarget(event)[&quot;value&quot;]
    setText((_) =&gt; value)
  }

  let handleButtonClick = (_) =&gt; {
    switch text {
      | &quot;&quot; =&gt; ()
      | text =&gt; {
        onSubmit(text)
        setText((_) =&gt; &quot;&quot;)
      }
    }
  }

  let handleKeyDown = (e) =&gt; {
    let key = ReactEvent.Keyboard.key(e)

    switch (text, key) {
      | (text, &quot;Enter&quot;) if text !== &quot;&quot; =&gt; {
        ReactEvent.Keyboard.preventDefault(e)

        onSubmit(text)
        setText((_) =&gt; &quot;&quot;)
      } 
      | _ =&gt; ()
    }
  }

  &lt;div className=`
    bg-slate-400
    p-2
    flex
    rounded-b-lg
  `&gt;
    &lt;input
      type_=&quot;text&quot;
      placeholder=&quot;Type here&quot;
      className=&quot;input input-bordered mr-1 w-full&quot;
      value={text}
      onChange={handleInputChange}
      onKeyDown={handleKeyDown}
    /&gt;

    &lt;button
      className=&quot;btn btn-square&quot;
      onClick={handleButtonClick}
    &gt;
      &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; width=&quot;16&quot; height=&quot;16&quot; viewBox=&quot;0 0 16 16&quot;&gt;&lt;path fill=&quot;currentColor&quot; d=&quot;M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576L6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76l7.494-7.493Z&quot;/&gt;&lt;/svg&gt;
    &lt;/button&gt;
  &lt;/div&gt;
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Chat__Input.resi</p>
<pre class="codehilite"><code>@react.component
let make: (~onSubmit: (string) =&gt; unit) =&gt; Jsx.element
</code></pre>

<p>=========== End file</p><h2>brightid--reactprosidebar</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file ReactProSidebar.res</p>
<pre class="codehilite"><code>module ProSidebar = {
  @react.component @module(&quot;react-pro-sidebar&quot;)
  external make: (
    ~children: React.element,
    ~className: string=?,
    ~breakPoint: string,
    ~onToggle: bool =&gt; unit,
    ~collapsed: bool=?,
    ~toggled: bool=?,
  ) =&gt; React.element = &quot;ProSidebar&quot;
}

module Menu = {
  @react.component @module(&quot;react-pro-sidebar&quot;)
  external make: (~children: React.element=?, ~iconShape: string) =&gt; React.element = &quot;Menu&quot;
}
module MenuItem = {
  @react.component @module(&quot;react-pro-sidebar&quot;)
  external make: (
    ~children: React.element=?,
    ~className: string=?,
    ~icon: React.element=?,
  ) =&gt; React.element = &quot;MenuItem&quot;
}
module SidebarHeader = {
  @react.component @module(&quot;react-pro-sidebar&quot;)
  external make: (~children: React.element=?, ~className: string=?) =&gt; React.element =
    &quot;SidebarHeader&quot;
}
module SidebarContent = {
  @react.component @module(&quot;react-pro-sidebar&quot;)
  external make: (~children: React.element, ~className: string=?) =&gt; React.element =
    &quot;SidebarContent&quot;
}
module SidebarFooter = {
  @react.component @module(&quot;react-pro-sidebar&quot;)
  external make: (~children: React.element=?, ~className: string=?) =&gt; React.element =
    &quot;SidebarFooter&quot;
}
</code></pre>

<p>=========== End file</p><h2>catala-dsfr--form</h2><p>Rescript v10</p>
<p>Repo: https://github.com/CatalaLang/catala-dsfr</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;catala-dsfr&quot;,
  &quot;version&quot;: &quot;0.1.1&quot;,
  &quot;repository&quot;: &quot;https://github.com/CatalaLang/catala-dsfr&quot;,
  &quot;scripts&quot;: {
    &quot;clean&quot;: &quot;rescript clean -with-deps&quot;,
    &quot;build&quot;: &quot;yarn run pre &amp;&amp; vite build&quot;,
    &quot;deploy&quot;: &quot;yarn run build --base=/demos/catala/ &amp;&amp; rsync -rv --delete-before dist/*&quot;,
    &quot;serve&quot;: &quot;vite preview&quot;,
    &quot;dev&quot;: &quot;yarn run pre &amp;&amp; vite&quot;,
    &quot;re:build&quot;: &quot;rescript build -with-deps&quot;,
    &quot;re:watch&quot;: &quot;yarn run pre &amp;&amp; rescript build -w -with-deps&quot;,
    &quot;assets&quot;: &quot;rsync -r node_modules/@catala-lang/catala-web-assets/assets/* assets&quot;,
    &quot;postinstall&quot;: &quot;copy-dsfr-to-public&quot;,
    &quot;pre&quot;: &quot;yarn run re:build &amp;&amp; only-include-used-icons &amp;&amp; yarn run assets&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;author&quot;: &quot;Emile Rolley &lt;emile.rolley@tuta.io&gt;&quot;,
  &quot;license&quot;: &quot;Apache-2.0&quot;,
  &quot;dependencies&quot;: {
    &quot;@catala-lang/catala-explain&quot;: &quot;^0.2.2&quot;,
    &quot;@catala-lang/catala-web-assets&quot;: &quot;^0.8.9&quot;,
    &quot;@catala-lang/french-law&quot;: &quot;^0.8.3-b.3&quot;,
    &quot;@catala-lang/rescript-catala&quot;: &quot;^0.8.1-b.0&quot;,
    &quot;@codegouvfr/react-dsfr&quot;: &quot;^0.78.2&quot;,
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;@rescript/react&quot;: &quot;^0.11.0&quot;,
    &quot;@rjsf/core&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/utils&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/validator-ajv8&quot;: &quot;^5.1.0&quot;,
    &quot;file-saver&quot;: &quot;^2.0.5&quot;,
    &quot;react&quot;: &quot;^18.2.0&quot;,
    &quot;react-dom&quot;: &quot;^18.2.0&quot;,
    &quot;react-loader-spinner&quot;: &quot;^5.4.5&quot;,
    &quot;rescript-docx&quot;: &quot;^0.1.5&quot;,
    &quot;tslib&quot;: &quot;^2.6.2&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@jihchi/vite-plugin-rescript&quot;: &quot;^5.1.0&quot;,
    &quot;@originjs/vite-plugin-commonjs&quot;: &quot;^1.0.3&quot;,
    &quot;@vitejs/plugin-react&quot;: &quot;^3.1.0&quot;,
    &quot;jsdom&quot;: &quot;^21.1.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.4&quot;,
    &quot;tailwindcss&quot;: &quot;^3.2.6&quot;,
    &quot;vite&quot;: &quot;^4.4.9&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Form.res</p>
<pre class="codehilite"><code>/*
  Binding for the React component [JSONSchemaForm.default] of the package
  [react-jsonschema-form].

  The component is capable of building HTML forms out of a JSON schema.
*/
module RjsfFormDsfrLazy = {
  @react.component @module(&quot;./RjsfFormDsfrLazy.tsx&quot;)
  external make: (
    ~onChange: Js.Dict.t&lt;Js.Json.t&gt; =&gt; unit=?,
    ~onSubmit: Js.Dict.t&lt;Js.Json.t&gt; =&gt; unit=?,
    ~onError: _ =&gt; unit=?,
    ~schema: Js.Json.t,
    ~uiSchema: Js.Json.t=?,
    ~formData: Js.Json.t=?,
  ) =&gt; React.element = &quot;default&quot;
}

// Function to download or import a JSON object
@val external downloadJSONstring: string =&gt; unit = &quot;downloadJSONstring&quot;
%%raw(`
const downloadJSONstring = (data) =&gt; {
  const blob = new Blob([data],{type:'application/json'});
  const href = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = href;
  link.download = &quot;data.json&quot;;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
};
`)

// Function to read a file and get its contents as string
@val external readFileAsJSON: (Js.Json.t, Js.Json.t =&gt; 'a) =&gt; unit = &quot;readFileAsJSON&quot;
%%raw(`
const readFileAsJSON = (file, callback) =&gt; {
  var reader = new FileReader();
  var contents = &quot;&quot;
  reader.onload = function(evt) {
    contents = evt.target.result;
    var json;
    try {
      json = JSON.parse(contents)
    } catch (error) {
      console.log(error)
      json = null;
    }
    callback(json);
  };
  reader.readAsText(file);
};
`)

/*
  Builds a React component from provided information.
*/
module Make = (
  FormInfos: {
    let webAssets: WebAssets.t
    let name: string
    let resultLabel: string
    let formDataPostProcessing: option&lt;Js.Json.t =&gt; Js.Json.t&gt;
    let computeAndPrintResult: Js.Json.t =&gt; React.element
    let url: string
  },
) =&gt; {
  @react.component
  let make = () =&gt; {
    let currentPath = Nav.getCurrentURL().path
    let (formData, setFormData) = React.useState(_ =&gt; FormInfos.webAssets.initialData)
    let (eventsOpt, setEventsOpt) = React.useState(_ =&gt; None)

    React.useEffect2(() =&gt; {
      setEventsOpt(_ =&gt; {
        let events = {
          try {CatalaFrenchLaw.retrieveEventsSerialized()-&gt;CatalaRuntime.deserializedEvents} catch {
          | _ =&gt; []
          }
        }
        if 0 == events-&gt;Belt.Array.size {
          None
        } else {
          Some(events)
        }
      })
      None
    }, (formData, setEventsOpt))

    let (uploadedFile, setUploadedFile) = React.useState(_ =&gt; {
      Js.Json.object_(Js.Dict.empty())
    })

    let fileChangeHandler = (_event: ReactEvent.Form.t) =&gt; {
      setUploadedFile(%raw(`_event.target.files[0]`))
    }

    let retrieveFileContents = _ =&gt; {
      if %raw(`uploadedFile instanceof File`) {
        readFileAsJSON(uploadedFile, form_data =&gt; setFormData(_ =&gt; Some(form_data)))
      }
    }

    let form_footer = {
      let priority = &quot;tertiary&quot;
      &lt;Dsfr.ButtonsGroup
        inlineLayoutWhen=&quot;always&quot;
        className=&quot;text-left&quot;
        buttonsEquisized=true
        buttonsSize=&quot;medium&quot;
        alignment=&quot;center&quot;
        buttons=[
          {
            children: `Réinitialiser le formulaire`-&gt;React.string,
            onClick: _ =&gt; {
              Console.debug(&quot;Resetting form data&quot;)
              setFormData(_ =&gt; FormInfos.webAssets.initialData)
            },
            iconId: &quot;fr-icon-refresh-line&quot;,
            priority,
          },
          {
            children: `Exporter les données au format JSON`-&gt;React.string,
            onClick: _ =&gt; {
              let data_str = Js.Json.stringify(formData-&gt;Belt.Option.getWithDefault(Js.Json.null))
              downloadJSONstring(data_str)
            },
            iconId: &quot;fr-icon-upload-line&quot;,
            priority,
          },
          {
            children: &lt;&gt;
              &lt;input
                className=&quot;hidden w-100&quot; id=&quot;file-upload&quot; type_=&quot;file&quot; onChange={fileChangeHandler}
              /&gt;
              &lt;label htmlFor=&quot;file-upload&quot; className=&quot;cursor-pointer&quot;&gt;
                {`Importer les données au format JSON `-&gt;React.string}
              &lt;/label&gt;
              &lt;p /&gt;
            &lt;/&gt;,
            onClick: retrieveFileContents,
            iconId: &quot;fr-icon-download-line&quot;,
            priority,
          },
          {
            children: {&quot;Code source du programme&quot;-&gt;React.string},
            onClick: {_ =&gt; currentPath-&gt;List.concat(list{`sources`})-&gt;Nav.goToPath},
            iconId: &quot;fr-icon-code-s-slash-line&quot;,
            priority,
          },
        ]
      /&gt;
    }

    let form_result =
      &lt;Dsfr.CallOut&gt;
        {switch formData {
        | None =&gt; `En attente de la confirmation du formulaire...`-&gt;React.string
        | Some(formData) =&gt;
          try {
            &lt;div className=&quot;flex flex-col&quot;&gt;
              &lt;div&gt;
                {FormInfos.resultLabel-&gt;React.string}
                {&quot;: &quot;-&gt;React.string}
                {FormInfos.computeAndPrintResult(formData)}
              &lt;/div&gt;
              &lt;Dsfr.Button
                onClick={_ =&gt; {
                  let doc = CatalaExplain.generate(
                    // NOTE(@EmileRolley): we assume that the events exist,
                    // because we have a result.
                    ~events=eventsOpt-&gt;Option.getExn,
                    ~userInputs=formData,
                    ~schema=FormInfos.webAssets.schema,
                    ~opts={
                      title: `Calcul des ${FormInfos.name}`,
                      // Contains an explicatory text about the computation and the catala program etc...
                      description: `Explication du détail des étapes de calcul établissant l'éligibilité et le montant des ${FormInfos.name} pour votre demande`,
                      creator: `catala-dsfr`,
                      keysToIgnore: FormInfos.webAssets.keysToIgnore,
                      selectedOutput: FormInfos.webAssets.selectedOutput,
                      sourcesURL: `${Constants.host}/${FormInfos.url}/sources`,
                    },
                  )

                  doc
                  -&gt;Docx.Packer.toBlob
                  -&gt;Promise.thenResolve(blob =&gt; {
                    FileSaver.saveAs(
                      blob,
                      `explication-decision-${FormInfos.name-&gt;String.replaceRegExp(
                          %re(&quot;/\s/g&quot;),
                          &quot;_&quot;,
                        )}.docx`,
                    )
                  })
                  -&gt;ignore
                }}
                iconPosition=&quot;left&quot;
                iconId=&quot;fr-icon-newspaper-line&quot;
                priority=&quot;secondary&quot;&gt;
                {`Télécharger une explication du calcul`-&gt;React.string}
              &lt;/Dsfr.Button&gt;
            &lt;/div&gt;
          } catch {
          | err =&gt;
            &lt;&gt;
              &lt;Lang.String english=&quot;Computation error: &quot; french={`Erreur de calcul : `} /&gt;
              {err
              -&gt;Js.Exn.asJsExn
              -&gt;Belt.Option.map(Js.Exn.message)
              -&gt;Belt.Option.getWithDefault(Some(&quot;&quot;))
              -&gt;Belt.Option.getWithDefault(&quot;unknwon error, please retry the computation&quot;)
              -&gt;React.string}
            &lt;/&gt;
          }
        }}
      &lt;/Dsfr.CallOut&gt;

    &lt;&gt;
      &lt;div className=&quot;fr-container--fluid&quot;&gt;
        &lt;div className=&quot;fr-grid-row fr-grid-row--gutters fr-grid-row--center&quot;&gt;
          &lt;Dsfr.Notice
            title={`Les données collectées par ce formulaire ne sont envoyées nulle part, et sont gérées uniquement par votre navigateur internet. \
            Les données sont traitées localement par un programme Javascript qui a été transmis avec le reste de ce site Internet. \
            Ainsi, ce site ne collecte aucune donnée de ses utilisateurs.`}
            isClosable=true
          /&gt;
          &lt;div className=&quot;fr-col&quot;&gt;
            &lt;React.Suspense fallback={Spinners.loader}&gt;
              &lt;RjsfFormDsfrLazy
                schema={FormInfos.webAssets.schema}
                uiSchema={FormInfos.webAssets.uiSchema}
                formData={formData-&gt;Belt.Option.getWithDefault(Js.Json.null)}
                onSubmit={t =&gt; {
                  setFormData(_ =&gt; {
                    let formData = t-&gt;Js.Dict.get(&quot;formData&quot;)
                    switch (FormInfos.formDataPostProcessing, formData) {
                    | (Some(f), Some(formData)) =&gt; {
                        let newFormData = f(formData)
                        Some(newFormData)
                      }
                    | _ =&gt; formData
                    }
                  })
                }}
              /&gt;
            &lt;/React.Suspense&gt;
          &lt;/div&gt;
          &lt;div
            className=&quot;w-full fr-m-1w border-2 border-solid rounded-full border-[var(--border-default-grey)]&quot;
          /&gt;
          &lt;div className=&quot;fr-col&quot;&gt; form_result &lt;/div&gt;
        &lt;/div&gt;
        form_footer
      &lt;/div&gt;
    &lt;/&gt;
  }
}
</code></pre>

<p>=========== End file</p><h2>brightid--discorserver</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file DiscordServer.res</p>
<pre class="codehilite"><code>open Promise

exception DiscordRateLimited

let botToken = Remix.process[&quot;env&quot;][&quot;DISCORD_API_TOKEN&quot;]

// let options: Client.clientOptions = {
//   intents: [&quot;GUILDS&quot;],
// }

// let client = Client.createDiscordClient(~options)

let mapGuildOauthRecord = decodedGuilds =&gt; {
  decodedGuilds-&gt;Belt.Option.map(guilds =&gt;
    guilds-&gt;Js.Array2.map(guild =&gt; {
      let guild = guild-&gt;Js.Json.decodeObject-&gt;Belt.Option.getUnsafe

      (
        {
          id: guild
          -&gt;Js.Dict.get(&quot;id&quot;)
          -&gt;Belt.Option.flatMap(Js.Json.decodeString)
          -&gt;Belt.Option.getExn,
          name: guild
          -&gt;Js.Dict.get(&quot;name&quot;)
          -&gt;Belt.Option.flatMap(Js.Json.decodeString)
          -&gt;Belt.Option.getExn,
          icon: guild-&gt;Js.Dict.get(&quot;icon&quot;)-&gt;Belt.Option.flatMap(Js.Json.decodeString),
        }: Types.oauthGuild
      )
    })
  )
}
let mapGuildRecord = decodedGuild =&gt; {
  switch decodedGuild {
  | None =&gt; None
  | Some(guild) =&gt;
    Some(
      (
        {
          id: guild
          -&gt;Js.Dict.get(&quot;id&quot;)
          -&gt;Belt.Option.flatMap(Js.Json.decodeString)
          -&gt;Belt.Option.getExn,
          name: guild
          -&gt;Js.Dict.get(&quot;name&quot;)
          -&gt;Belt.Option.flatMap(Js.Json.decodeString)
          -&gt;Belt.Option.getExn,
          icon: guild-&gt;Js.Dict.get(&quot;icon&quot;)-&gt;Belt.Option.flatMap(Js.Json.decodeString),
          roles: guild
          -&gt;Js.Dict.get(&quot;roles&quot;)
          -&gt;Belt.Option.flatMap(Js.Json.decodeArray)
          -&gt;Belt.Option.getExn,
          owner_id: guild
          -&gt;Js.Dict.get(&quot;owner_id&quot;)
          -&gt;Belt.Option.flatMap(Js.Json.decodeString)
          -&gt;Belt.Option.getExn,
        }: Types.guild
      ),
    )
  }
}
let mapGuildMemberRecord = decodedGuildMember =&gt; {
  switch decodedGuildMember {
  | None =&gt; None
  | Some(guildMember) =&gt;
    Some(
      (
        {
          roles: guildMember
          -&gt;Js.Dict.get(&quot;roles&quot;)
          -&gt;Belt.Option.flatMap(Js.Json.decodeArray)
          -&gt;Belt.Option.map(roles =&gt;
            roles-&gt;Js.Array2.map(role =&gt; role-&gt;Js.Json.decodeString-&gt;Belt.Option.getExn)
          )
          -&gt;Belt.Option.getExn,
        }: Types.guildMember
      ),
    )
  }
}

let mapRoleRecord = decodedRoles =&gt; {
  decodedRoles-&gt;Belt.Option.map(roles =&gt;
    roles-&gt;Js.Array2.map(role =&gt; {
      let role = role-&gt;Js.Json.decodeObject-&gt;Belt.Option.getUnsafe

      (
        {
          id: role
          -&gt;Js.Dict.get(&quot;id&quot;)
          -&gt;Belt.Option.flatMap(Js.Json.decodeString)
          -&gt;Belt.Option.getExn,
          name: role
          -&gt;Js.Dict.get(&quot;name&quot;)
          -&gt;Belt.Option.flatMap(Js.Json.decodeString)
          -&gt;Belt.Option.getExn,
          permissions: role
          -&gt;Js.Dict.get(&quot;permissions&quot;)
          -&gt;Belt.Option.flatMap(Js.Json.decodeNumber)
          -&gt;Belt.Option.getExn,
        }: Types.role
      )
    })
  )
}

let sleep = _ms =&gt; %raw(` new Promise((resolve) =&gt; setTimeout(resolve, _ms))`)

//fetch all bot and user guilds
let rec fetchBotGuilds = (~after=0, ~allGuilds=[], ()): Promise.t&lt;array&lt;Types.oauthGuild&gt;&gt; =&gt; {
  open Webapi.Fetch

  let headers = HeadersInit.make({
    &quot;Authorization&quot;: `Bot ${botToken}`,
  })
  let init = RequestInit.make(~method_=Get, ~headers, ())

  `https://discord.com/api/users/@me/guilds?after=${after-&gt;Belt.Int.toString}`
  -&gt;Request.makeWithInit(init)
  -&gt;fetchWithRequest
  -&gt;then(res =&gt; res-&gt;Response.json)
  -&gt;then(json =&gt; {
    switch json-&gt;Js.Json.test(Js.Json.Array) {
    | false =&gt; {
        let rateLimit = json-&gt;Js.Json.decodeObject-&gt;Belt.Option.getUnsafe

        let retry_after =
          rateLimit-&gt;Js.Dict.get(&quot;retry_after&quot;)-&gt;Belt.Option.flatMap(Js.Json.decodeNumber)

        let retry_after = switch retry_after {
        | None =&gt; DiscordRateLimited-&gt;raise
        | Some(retry_after) =&gt; retry_after-&gt;Belt.Float.toInt + 100
        }

        Js.log(
          `Discord Rate Limited: Retrying fetch for guilds after: ${after-&gt;Belt.Int.toString} in ${retry_after-&gt;Belt.Int.toString}ms`,
        )
        sleep(retry_after)-&gt;then(_ =&gt; fetchBotGuilds(~after, ~allGuilds, ()))
      }

    | true =&gt; {
        let guilds = json-&gt;Js.Json.decodeArray-&gt;mapGuildOauthRecord-&gt;Belt.Option.getUnsafe
        switch guilds-&gt;Belt.Array.length &lt;= 1 {
        | true =&gt; allGuilds-&gt;Belt.Array.concat(guilds)-&gt;resolve
        | false =&gt; {
            let last = guilds-&gt;Js.Array2.length - 1
            let after = guilds[last].id-&gt;Belt.Int.fromString-&gt;Belt.Option.getUnsafe
            let allGuilds = allGuilds-&gt;Belt.Array.concat(guilds)
            fetchBotGuilds(~after, ~allGuilds, ())
          }
        }
      }
    }
  })
  -&gt;catch(e =&gt; {
    switch e {
    | DiscordRateLimited =&gt; e-&gt;raise
    | _ =&gt; allGuilds-&gt;resolve
    }
  })
}

type guildsCursor = {guilds: array&lt;Types.oauthGuild&gt;, after: option&lt;string&gt;}
//fetch first 1000 guilds
let rec fetchBotGuildsLimit = (~after): Promise.t&lt;guildsCursor&gt; =&gt; {
  open Webapi.Fetch

  let headers = HeadersInit.make({
    &quot;Authorization&quot;: `Bot ${botToken}`,
  })
  let init = RequestInit.make(~method_=Get, ~headers, ())
  switch after {
  | Some(after) =&gt;
    `https://discord.com/api/users/@me/guilds?after=${after}`
    -&gt;Request.makeWithInit(init)
    -&gt;fetchWithRequest
    -&gt;then(res =&gt; res-&gt;Response.json)
    -&gt;then(json =&gt; {
      switch json-&gt;Js.Json.test(Js.Json.Array) {
      | false =&gt; {
          let rateLimit = json-&gt;Js.Json.decodeObject-&gt;Belt.Option.getUnsafe

          let retry_after =
            rateLimit-&gt;Js.Dict.get(&quot;retry_after&quot;)-&gt;Belt.Option.flatMap(Js.Json.decodeNumber)

          let retry_after = switch retry_after {
          | None =&gt; DiscordRateLimited-&gt;raise
          | Some(retry_after) =&gt; retry_after-&gt;Belt.Float.toInt + 100
          }

          Js.log(
            `Discord Rate Limited: Retrying fetch for guilds after: ${after} in ${retry_after-&gt;Belt.Int.toString}ms`,
          )
          sleep(retry_after)-&gt;then(_ =&gt; fetchBotGuildsLimit(~after=Some(after)))
        }

      | true =&gt; {
          let guilds = json-&gt;Js.Json.decodeArray-&gt;mapGuildOauthRecord-&gt;Belt.Option.getUnsafe
          let last = guilds-&gt;Js.Array2.length - 1
          let after = guilds[last].id-&gt;Some
          {guilds, after}-&gt;resolve
        }
      }
    })
    -&gt;catch(e =&gt; {
      switch e {
      | DiscordRateLimited =&gt; e-&gt;raise
      | _ =&gt; {guilds: [], after: Some(after)}-&gt;resolve
      }
    })
  | None =&gt; {guilds: [], after}-&gt;resolve
  }
}

let rec fetchUserGuilds = (user: RemixAuth.User.t) =&gt; {
  open Webapi.Fetch
  let headers = HeadersInit.make({
    &quot;Authorization&quot;: `Bearer ${user-&gt;RemixAuth.User.getAccessToken}`,
  })
  let init = RequestInit.make(~method_=Get, ~headers, ())
  &quot;https://discord.com/api/users/@me/guilds&quot;
  -&gt;Request.makeWithInit(init)
  -&gt;fetchWithRequest
  -&gt;then(res =&gt; res-&gt;Response.json)
  -&gt;then(json =&gt;
    switch json-&gt;Js.Json.test(Js.Json.Array) {
    | false =&gt; {
        let rateLimit = json-&gt;Js.Json.decodeObject-&gt;Belt.Option.getUnsafe

        let retry_after =
          rateLimit-&gt;Js.Dict.get(&quot;retry_after&quot;)-&gt;Belt.Option.flatMap(Js.Json.decodeNumber)

        let retry_after = switch retry_after {
        | None =&gt; DiscordRateLimited-&gt;raise
        | Some(retry_after) =&gt; retry_after-&gt;Belt.Float.toInt + 100
        }
        Js.log(
          `Discord Rate Limited: Retrying fetch user guilds in ${retry_after-&gt;Belt.Int.toString}ms`,
        )
        sleep(retry_after)-&gt;then(_ =&gt; fetchUserGuilds(user))
      }

    | true =&gt; json-&gt;Js.Json.decodeArray-&gt;mapGuildOauthRecord-&gt;Belt.Option.getUnsafe-&gt;resolve
    }
  )
  -&gt;catch(e =&gt; {
    switch e {
    | DiscordRateLimited =&gt; e-&gt;raise
    | _ =&gt; []-&gt;resolve
    }
  })
}

let fetchDiscordGuildFromId = (~guildId) =&gt; {
  open Webapi.Fetch
  let headers = HeadersInit.make({
    &quot;Authorization&quot;: `Bot ${botToken}`,
  })
  let init = RequestInit.make(~method_=Get, ~headers, ())

  `https://discord.com/api/guilds/${guildId}`
  -&gt;Request.makeWithInit(init)
  -&gt;fetchWithRequest
  -&gt;then(res =&gt; res-&gt;Response.json)
  -&gt;then(json =&gt; json-&gt;Js.Json.decodeObject-&gt;mapGuildRecord-&gt;Js.Nullable.fromOption-&gt;resolve)
}

let fetchGuildMemberFromId = (~guildId, ~userId) =&gt; {
  open Webapi.Fetch
  let headers = HeadersInit.make({
    &quot;Authorization&quot;: `Bot ${botToken}`,
  })
  let init = RequestInit.make(~method_=Get, ~headers, ())

  `https://discord.com/api/guilds/${guildId}/members/${userId}`
  -&gt;Request.makeWithInit(init)
  -&gt;fetchWithRequest
  -&gt;then(res =&gt; res-&gt;Response.json)
  -&gt;then(json =&gt; {
    json-&gt;Js.Json.decodeObject-&gt;mapGuildMemberRecord-&gt;Js.Nullable.fromOption-&gt;resolve
  })
}

let rec fetchGuildRoles = (~guildId) =&gt; {
  open Webapi.Fetch
  let headers = HeadersInit.make({
    &quot;Authorization&quot;: `Bot ${botToken}`,
  })

  let init = RequestInit.make(~method_=Get, ~headers, ())

  `https://discord.com/api/guilds/${guildId}/roles`
  -&gt;Request.makeWithInit(init)
  -&gt;fetchWithRequest
  -&gt;then(res =&gt; res-&gt;Response.json)
  -&gt;then(json =&gt;
    switch json-&gt;Js.Json.test(Js.Json.Array) {
    | false =&gt; {
        let rateLimit = json-&gt;Js.Json.decodeObject-&gt;Belt.Option.getUnsafe

        let retry_after =
          rateLimit-&gt;Js.Dict.get(&quot;retry_after&quot;)-&gt;Belt.Option.flatMap(Js.Json.decodeNumber)

        let retry_after = switch retry_after {
        | None =&gt; DiscordRateLimited-&gt;raise
        | Some(retry_after) =&gt; retry_after-&gt;Belt.Float.toInt + 100
        }
        Js.log(
          `Discord Rate Limited: Retrying fetch guild: ${guildId} roles in ${retry_after-&gt;Belt.Int.toString}ms`,
        )
        sleep(retry_after)-&gt;then(_ =&gt; fetchGuildRoles(~guildId))
      }

    | true =&gt; json-&gt;Js.Json.decodeArray-&gt;mapRoleRecord-&gt;Belt.Option.getUnsafe-&gt;resolve
    }
  )
  -&gt;catch(e =&gt; {
    switch e {
    | DiscordRateLimited =&gt; e-&gt;raise
    | _ =&gt; []-&gt;resolve
    }
  })
}

let memberIsAdmin = (~guildRoles: array&lt;Types.role&gt;, ~memberRoles) =&gt; {
  let adminPerm = %raw(`0x0000000000000008`)

  let memberRoles = guildRoles-&gt;Js.Array2.filter(role =&gt; memberRoles-&gt;Js.Array2.includes(role.id))
  memberRoles-&gt;Js.Array2.some(role =&gt; {
    %raw(`(role.permissions &amp; adminPerm)`) === adminPerm
  })
}
</code></pre>

<p>=========== End file</p><h2>catala-dsfr--spinners</h2><p>Rescript v10</p>
<p>Repo: https://github.com/CatalaLang/catala-dsfr</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;catala-dsfr&quot;,
  &quot;version&quot;: &quot;0.1.1&quot;,
  &quot;repository&quot;: &quot;https://github.com/CatalaLang/catala-dsfr&quot;,
  &quot;scripts&quot;: {
    &quot;clean&quot;: &quot;rescript clean -with-deps&quot;,
    &quot;build&quot;: &quot;yarn run pre &amp;&amp; vite build&quot;,
    &quot;deploy&quot;: &quot;yarn run build --base=/demos/catala/ &amp;&amp; rsync -rv --delete-before dist/*&quot;,
    &quot;serve&quot;: &quot;vite preview&quot;,
    &quot;dev&quot;: &quot;yarn run pre &amp;&amp; vite&quot;,
    &quot;re:build&quot;: &quot;rescript build -with-deps&quot;,
    &quot;re:watch&quot;: &quot;yarn run pre &amp;&amp; rescript build -w -with-deps&quot;,
    &quot;assets&quot;: &quot;rsync -r node_modules/@catala-lang/catala-web-assets/assets/* assets&quot;,
    &quot;postinstall&quot;: &quot;copy-dsfr-to-public&quot;,
    &quot;pre&quot;: &quot;yarn run re:build &amp;&amp; only-include-used-icons &amp;&amp; yarn run assets&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;author&quot;: &quot;Emile Rolley &lt;emile.rolley@tuta.io&gt;&quot;,
  &quot;license&quot;: &quot;Apache-2.0&quot;,
  &quot;dependencies&quot;: {
    &quot;@catala-lang/catala-explain&quot;: &quot;^0.2.2&quot;,
    &quot;@catala-lang/catala-web-assets&quot;: &quot;^0.8.9&quot;,
    &quot;@catala-lang/french-law&quot;: &quot;^0.8.3-b.3&quot;,
    &quot;@catala-lang/rescript-catala&quot;: &quot;^0.8.1-b.0&quot;,
    &quot;@codegouvfr/react-dsfr&quot;: &quot;^0.78.2&quot;,
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;@rescript/react&quot;: &quot;^0.11.0&quot;,
    &quot;@rjsf/core&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/utils&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/validator-ajv8&quot;: &quot;^5.1.0&quot;,
    &quot;file-saver&quot;: &quot;^2.0.5&quot;,
    &quot;react&quot;: &quot;^18.2.0&quot;,
    &quot;react-dom&quot;: &quot;^18.2.0&quot;,
    &quot;react-loader-spinner&quot;: &quot;^5.4.5&quot;,
    &quot;rescript-docx&quot;: &quot;^0.1.5&quot;,
    &quot;tslib&quot;: &quot;^2.6.2&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@jihchi/vite-plugin-rescript&quot;: &quot;^5.1.0&quot;,
    &quot;@originjs/vite-plugin-commonjs&quot;: &quot;^1.0.3&quot;,
    &quot;@vitejs/plugin-react&quot;: &quot;^3.1.0&quot;,
    &quot;jsdom&quot;: &quot;^21.1.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.4&quot;,
    &quot;tailwindcss&quot;: &quot;^3.2.6&quot;,
    &quot;vite&quot;: &quot;^4.4.9&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Spinners.res</p>
<pre class="codehilite"><code>module Oval = {
  @react.component @module(&quot;react-loader-spinner&quot;)
  external make: (
    ~height: int=?,
    ~width: int=?,
    ~color: string=?,
    ~visible: bool=?,
    ~secondaryColor: string=?,
    ~strokeWidth: int=?,
    ~strokeWidthSecondary: int=?,
    ~radius: int=?,
    ~wrapperClassName: string=?,
  ) =&gt; React.element = &quot;Oval&quot;
}

module ThreeDots = {
  @react.component @module(&quot;react-loader-spinner&quot;)
  external make: (
    ~height: int=?,
    ~width: int=?,
    ~color: string=?,
    ~secondaryColor: string=?,
    ~visible: bool=?,
    ~radius: int=?,
    ~wrapperClassName: string=?,
  ) =&gt; React.element = &quot;ThreeDots&quot;
}

let loader =
  &lt;Oval
    height=25
    width=25
    strokeWidth=5
    color=&quot;#518fff&quot;
    secondaryColor=&quot;#98b4ff&quot;
    wrapperClassName=&quot;justifyCenter&quot;
  /&gt;
</code></pre>

<p>=========== End file</p><h2>chat-script--server</h2><p>Rescript v11</p>
<p>Repo: https://github.com/Exegetech/chat-rescript</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;backend&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;,
    &quot;dev&quot;: &quot;NODE_ENV=dev nodemon src/Server.bs.mjs&quot;,
    &quot;build&quot;: &quot;node scripts/build.js&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@fastify/cors&quot;: &quot;8.4.0&quot;,
    &quot;@fastify/static&quot;: &quot;6.11.2&quot;,
    &quot;@fastify/websocket&quot;: &quot;8.2.0&quot;,
    &quot;@rescript/core&quot;: &quot;0.5.0&quot;,
    &quot;fastify&quot;: &quot;4.24.1&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.4&quot;,
    &quot;shared&quot;: &quot;workspace:*&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;esbuild&quot;: &quot;0.19.5&quot;,
    &quot;nodemon&quot;: &quot;3.0.1&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Server.res</p>
<pre class="codehilite"><code>open Fastify

let env = Dict.get(Node.Process.env, &quot;NODE_ENV&quot;)

@val external importMetaUrl: string = &quot;import.meta.url&quot;

let dirname = importMetaUrl
  -&gt; Node.Url.fileURLToPath
  -&gt; Node.Path.dirname

let fastify = create({ logger: true })

switch env {
  | None =&gt; {
    fastify-&gt;registerStatic(fastifyStatic, {
      root: Node.Path.join(dirname, &quot;public&quot;),
    })
  }
  | _ =&gt; ()
}

fastify-&gt;register(fastifyCors)
fastify-&gt;register(fastifyWebsocket)

fastify-&gt;addHook(PreValidation, async (request, reply) =&gt; {
  let path = request.routeOptions.url
  let username = Dict.get(request.query, &quot;username&quot;)

  switch (path, username) {
    | (&quot;/chat&quot;, None) =&gt; reply
      -&gt;HTTP.code(Forbidden)
      -&gt;HTTP.send(&quot;Connection rejected&quot;)
    | _ =&gt; ()
  }
})

fastify-&gt;httpGet(&quot;/chat&quot;, async (_request, reply) =&gt; {
  let payload = Chat.getChatHistory()
    -&gt; Message.ToClient.serializeMany

  switch payload {
    | Error(error) =&gt; fastify.log-&gt;Log.logError(error)
    | Ok(payload) =&gt; reply
      -&gt;HTTP.code(Okay)
      -&gt;HTTP.send(payload)
  }
})

fastify-&gt;register(async (fastify) =&gt; {
  fastify-&gt;socketGet(&quot;/room&quot;, (connection, request) =&gt; {
    let username = request.query
      -&gt; Dict.get(&quot;username&quot;)
      -&gt; Option.getExn

    Chat.handleClient(~username, ~socket=connection.socket, ~onError=(errMsg) =&gt; {
      fastify.log-&gt;Log.logError(errMsg)
    })
  })
})

let start = async () =&gt; {
  try {
    await fastify-&gt;listen({ port: 3000 })
  } catch {
    | Exn.Error(obj) =&gt;
      switch Exn.message(obj) {
        | Some(m) =&gt; fastify.log-&gt;Log.logError(m)
    | None =&gt; ()
      }

      Node.Process.exit(1)
  }
}

let _ = await start()
</code></pre>

<p>=========== End file</p><h2>brightid--authserver</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file AuthServer.res</p>
<pre class="codehilite"><code>let clientID = Remix.process[&quot;env&quot;][&quot;DISCORD_CLIENT_ID&quot;]
let clientSecret = Remix.process[&quot;env&quot;][&quot;DISCORD_CLIENT_SECRET&quot;]
let baseUrl = Remix.process[&quot;env&quot;][&quot;BASE_URL&quot;]
let uuidNamespace = Remix.process[&quot;env&quot;][&quot;UUID_NAMESPACE&quot;]

let cookieOptions = Remix.CreateCookieOptions.make(
  ~sameSite=#lax,
  ~path=&quot;/&quot;,
  ~httpOnly=true,
  ~secrets=[uuidNamespace],
  ~secure=Remix.process[&quot;env&quot;][&quot;NODE_ENV&quot;] === &quot;production&quot;,
  (),
)

let cookie = Remix.createCookieWithOptions(&quot;__session&quot;, cookieOptions)

let sessionStorage =
  cookie
  -&gt;Remix.CreateCookieSessionStorageOptions.make(~cookie=_)
  -&gt;Remix.createCookieSessionStorageWithOptions(~options=_)

let authenticator = sessionStorage-&gt;RemixAuth.Authenticator.make

let discordStrategy = RemixAuth.DiscordStrategy.CreateDiscordStategyOptions.make(
  ~clientID,
  ~clientSecret,
  ~callbackURL=baseUrl ++ &quot;/auth/discord/callback&quot;,
  ~scope=[&quot;identify&quot;, &quot;guilds&quot;, &quot;guilds.join&quot;],
  (),
)-&gt;RemixAuth.DiscordStrategy.make(({accessToken, profile}) =&gt; {
  {&quot;accessToken&quot;: accessToken, &quot;profile&quot;: profile}-&gt;Promise.resolve
})

authenticator-&gt;RemixAuth.Authenticator.use(discordStrategy)
</code></pre>

<p>=========== End file</p><h2>catala-dsfr--router</h2><p>Rescript v10</p>
<p>Repo: https://github.com/CatalaLang/catala-dsfr</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;catala-dsfr&quot;,
  &quot;version&quot;: &quot;0.1.1&quot;,
  &quot;repository&quot;: &quot;https://github.com/CatalaLang/catala-dsfr&quot;,
  &quot;scripts&quot;: {
    &quot;clean&quot;: &quot;rescript clean -with-deps&quot;,
    &quot;build&quot;: &quot;yarn run pre &amp;&amp; vite build&quot;,
    &quot;deploy&quot;: &quot;yarn run build --base=/demos/catala/ &amp;&amp; rsync -rv --delete-before dist/*&quot;,
    &quot;serve&quot;: &quot;vite preview&quot;,
    &quot;dev&quot;: &quot;yarn run pre &amp;&amp; vite&quot;,
    &quot;re:build&quot;: &quot;rescript build -with-deps&quot;,
    &quot;re:watch&quot;: &quot;yarn run pre &amp;&amp; rescript build -w -with-deps&quot;,
    &quot;assets&quot;: &quot;rsync -r node_modules/@catala-lang/catala-web-assets/assets/* assets&quot;,
    &quot;postinstall&quot;: &quot;copy-dsfr-to-public&quot;,
    &quot;pre&quot;: &quot;yarn run re:build &amp;&amp; only-include-used-icons &amp;&amp; yarn run assets&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;author&quot;: &quot;Emile Rolley &lt;emile.rolley@tuta.io&gt;&quot;,
  &quot;license&quot;: &quot;Apache-2.0&quot;,
  &quot;dependencies&quot;: {
    &quot;@catala-lang/catala-explain&quot;: &quot;^0.2.2&quot;,
    &quot;@catala-lang/catala-web-assets&quot;: &quot;^0.8.9&quot;,
    &quot;@catala-lang/french-law&quot;: &quot;^0.8.3-b.3&quot;,
    &quot;@catala-lang/rescript-catala&quot;: &quot;^0.8.1-b.0&quot;,
    &quot;@codegouvfr/react-dsfr&quot;: &quot;^0.78.2&quot;,
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;@rescript/react&quot;: &quot;^0.11.0&quot;,
    &quot;@rjsf/core&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/utils&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/validator-ajv8&quot;: &quot;^5.1.0&quot;,
    &quot;file-saver&quot;: &quot;^2.0.5&quot;,
    &quot;react&quot;: &quot;^18.2.0&quot;,
    &quot;react-dom&quot;: &quot;^18.2.0&quot;,
    &quot;react-loader-spinner&quot;: &quot;^5.4.5&quot;,
    &quot;rescript-docx&quot;: &quot;^0.1.5&quot;,
    &quot;tslib&quot;: &quot;^2.6.2&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@jihchi/vite-plugin-rescript&quot;: &quot;^5.1.0&quot;,
    &quot;@originjs/vite-plugin-commonjs&quot;: &quot;^1.0.3&quot;,
    &quot;@vitejs/plugin-react&quot;: &quot;^3.1.0&quot;,
    &quot;jsdom&quot;: &quot;^21.1.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.4&quot;,
    &quot;tailwindcss&quot;: &quot;^3.2.6&quot;,
    &quot;vite&quot;: &quot;^4.4.9&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Router.res</p>
<pre class="codehilite"><code>@react.component
let make = () =&gt; {
  switch Nav.getCurrentURL().path {
  | list{route} if route == AllocationsFamiliales.FormInfos.url =&gt; &lt;AllocationsFamiliales /&gt;
  | list{route} if route == AidesLogement.FormInfos.url =&gt; &lt;AidesLogement /&gt;
  | list{route, &quot;sources&quot;} if route == AllocationsFamiliales.FormInfos.url =&gt;
    &lt;SourceCode
      html={WebAssets.allocationsFamilialesAssets.html}
      simulatorUrl={AllocationsFamiliales.FormInfos.url}
    /&gt;
  | list{route, &quot;sources&quot;} if route == AidesLogement.FormInfos.url =&gt;
    &lt;SourceCode
      html={WebAssets.aidesLogementAssets.html} simulatorUrl={AidesLogement.FormInfos.url}
    /&gt;
  | _ =&gt; &lt;Home /&gt;
  }
}

module Link = {
  @react.component
  let make = (~href: string, ~children) =&gt; {
    &lt;a
      href={href}
      onClick={evt =&gt; {
        evt-&gt;ReactEvent.Mouse.preventDefault
        href-&gt;Nav.goTo
      }}&gt;
      children
    &lt;/a&gt;
  }
}
</code></pre>

<p>=========== End file</p><h2>res-x--htmx</h2><p>Rescript v11</p>
<p>Repo: https://github.com/zth/res-x</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;rescript-x&quot;,
  &quot;version&quot;: &quot;0.1.0-alpha.7&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;files&quot;: [
    &quot;README.md&quot;,
    &quot;CHANGELOG.md&quot;,
    &quot;rescript.json&quot;,
    &quot;src/**/*&quot;,
    &quot;res-x-vite-plugin.mjs&quot;
  ],
  &quot;author&quot;: &quot;Gabriel Nordeborn&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;peerDependencies&quot;: {
    &quot;rescript&quot;: &quot;&gt;=11.0.0-rc.5&quot;,
    &quot;@rescript/core&quot;: &quot;&gt;=0.5.0&quot;,
    &quot;vite&quot;: &quot;&gt;=4.4.11&quot;,
    &quot;rescript-bun&quot;: &quot;&gt;=0.1.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.5&quot;,
    &quot;rescript-bun&quot;: &quot;0.1.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Htmx.res</p>
<pre class="codehilite"><code>type hxSwap =
  | @as(&quot;outerHTML&quot;) OuterHTML
  | @as(&quot;innerHTML&quot;) InnerHTML
  | @as(&quot;beforebegin&quot;) BeforeBegin
  | @as(&quot;afterbegin&quot;) AfterBegin
  | @as(&quot;beforeend&quot;) BeforeEnd
  | @as(&quot;afterend&quot;) AfterEnd
  | @as(&quot;delete&quot;) Delete
  | @as(&quot;none&quot;) None

type topOrBottom = | @as(&quot;top&quot;) Top | @as(&quot;bottom&quot;) Bottom

type modifier =
  | Swap(string)
  | Settle(string)
  | Transition
  | Scroll(topOrBottom)
  | ScrollWithSelector(string, topOrBottom)
  | Show(topOrBottom)
  | ShowWithSelector(string, topOrBottom)

module Swap = {
  type t = string
  let make = (swap: hxSwap, ~modifier=?) =&gt;
    [
      Some((swap :&gt; string)),
      modifier-&gt;Option.map(modifier =&gt;
        switch modifier {
        | Swap(s) =&gt; `swap:${s}`
        | Transition =&gt; `transition:true`
        | Settle(s) =&gt; `settle:${s}`
        | Scroll(topOrBottom) =&gt; `scroll:${(topOrBottom :&gt; string)}`
        | ScrollWithSelector(s, topOrBottom) =&gt; `scroll:${s}:${(topOrBottom :&gt; string)}`
        | Show(topOrBottom) =&gt; `show:${(topOrBottom :&gt; string)}`
        | ShowWithSelector(s, topOrBottom) =&gt; `show:${s}:${(topOrBottom :&gt; string)}`
        }
      ),
    ]
    -&gt;Array.keepSome
    -&gt;Array.joinWith(&quot; &quot;)
}

type hxTarget =
  | CssSelector(string)
  | This
  | Closest({cssSelector: string})
  | Find({cssSelector: string})
  | Next({cssSelector: string})
  | Previous({cssSelector: string})

module Target = {
  type t = string
  let make = (target: hxTarget) =&gt;
    switch target {
    | Closest({cssSelector}) =&gt; `closest ${cssSelector}`
    | This =&gt; &quot;this&quot;
    | CssSelector(cssSelector) =&gt; cssSelector
    | Find({cssSelector}) =&gt; `find ${cssSelector}`
    | Next({cssSelector}) =&gt; `next ${cssSelector}`
    | Previous({cssSelector}) =&gt; `previous ${cssSelector}`
    }
}

@unboxed type hxUrl = | @as(true) True | @as(false) False | URL(string)

type hxParams = IncludeAll | IncludeNone | Not(array&lt;string&gt;) | Only(array&lt;string&gt;)

module Params = {
  type t = string
  let make = (p: hxParams) =&gt; {
    switch p {
    | IncludeAll =&gt; &quot;*&quot;
    | IncludeNone =&gt; &quot;none&quot;
    | Not(list) =&gt; `not ${list-&gt;Array.joinWith(&quot;,&quot;)}`
    | Only(list) =&gt; list-&gt;Array.joinWith(&quot;,&quot;)
    }
  }
}

type hxEncoding = MultipartFormData

module Encoding = {
  type t = string
  let make = encoding =&gt;
    switch encoding {
    | MultipartFormData =&gt; &quot;multipart/form-data&quot;
    }
}

type hxIndicator = Selector(string) | Closest(string)

module Indicator = {
  type t = string
  let make = (hxIndicator: hxIndicator) =&gt;
    switch hxIndicator {
    | Selector(s) =&gt; s
    | Closest(s) =&gt; `closest ${s}`
    }
}

module Headers: {
  type t
  let make: Dict.t&lt;string&gt; =&gt; t
} = {
  type t = string
  let make = (dict: Dict.t&lt;string&gt;) =&gt; dict-&gt;JSON.stringifyAny-&gt;Option.getWithDefault(&quot;{}&quot;)
}

type hxSyncStrategyQueueModifier =
  | /** queue the first request to show up while a request is in flight */
  @as(&quot;first&quot;)
  First
  | /** queue the last request to show up while a request is in flight */
  @as(&quot;last&quot;)
  Last
  | /** queue all requests that show up while a request is in flight */
  @as(&quot;all&quot;)
  All

type hxSyncStrategy =
  Drop | Abort | Replace | Queue | QueueWithModifier(hxSyncStrategyQueueModifier)

type hxSync = Selector(string) | SelectorAndStrategy(string, hxSyncStrategy)

module Sync = {
  type t = string
  let strategyToString = (s: hxSyncStrategy) =&gt;
    switch s {
    | Drop =&gt; &quot;drop&quot;
    | Abort =&gt; &quot;abort&quot;
    | Replace =&gt; &quot;replace&quot;
    | Queue =&gt; &quot;queue&quot;
    | QueueWithModifier(modifier) =&gt;
      `queue ${switch modifier {
        | First =&gt; &quot;first&quot;
        | Last =&gt; &quot;last&quot;
        | All =&gt; &quot;all&quot;
        }}`
    }

  let make = (c: hxSync) =&gt;
    switch c {
    | Selector(s) =&gt; s
    | SelectorAndStrategy(s, strategy) =&gt; `${s}:${strategy-&gt;strategyToString}`
    }
}

type hxVals =
  | /** A JSON value. */ Json(Js.Json.t)
  | /** Raw string. This needs to be valid, parseable JSON. */ JsonUnsafe(string)
  | /** WARNING: This might introduce security issues. Avoid unless really needed.

  Stringified JS that will be evaluated. */
  RawJavaScript(string)

module Vals = {
  type t = string
  let make = vals =&gt;
    switch vals {
    | Json(json) =&gt; JSON.stringify(json)
    | JsonUnsafe(s) =&gt; s
    | RawJavaScript(s) =&gt; `js:${s}`
    }
}

type hxInheritedAttributes =
  | @as(&quot;hx-swap&quot;) Swap
  | @as(&quot;hx-boost&quot;) Boost
  | @as(&quot;hx-push-url&quot;) PushUrl
  | @as(&quot;hx-replace-url&quot;) ReplaceUrl
  | @as(&quot;hx-select&quot;) Select
  | @as(&quot;hx-select-oob&quot;) SelectOob
  | @as(&quot;hx-params&quot;) Params
  | @as(&quot;hx-prompt&quot;) Prompt
  | @as(&quot;hx-validate&quot;) Validate
  | @as(&quot;hx-confirm&quot;) Confirm
  | @as(&quot;hx-disable&quot;) Disable
  | @as(&quot;hx-encoding&quot;) Encoding
  | @as(&quot;hx-indicator&quot;) Indicator
  | @as(&quot;hx-history&quot;) History
  | @as(&quot;hx-history-elt&quot;) HistoryElt
  | @as(&quot;hx-include&quot;) Include
  | @as(&quot;hx-headers&quot;) Headers
  | @as(&quot;hx-sync&quot;) Sync
  | @as(&quot;hx-vals&quot;) Vals
  | @as(&quot;hx-preserve&quot;) Preserve

type hxDisinherit = All | Attributes(array&lt;hxInheritedAttributes&gt;)

module Disinherit = {
  type t = string
  let make = d =&gt;
    switch d {
    | All =&gt; &quot;*&quot;
    | Attributes(attrs) =&gt; attrs-&gt;Array.map(a =&gt; (a :&gt; string))-&gt;Array.joinWith(&quot; &quot;)
    }
}

// Missing:
//  request, ext
type htmxProps = {
  /** https://htmx.org/attributes/hx-get/ */
  @as(&quot;hx-get&quot;)
  hxGet?: Handlers.hxGet,
  @as(&quot;data-hx-get&quot;)
  rawHxGet?: string,
  /** https://htmx.org/attributes/hx-post/ */
  @as(&quot;hx-post&quot;)
  hxPost?: Handlers.hxPost,
  @as(&quot;data-hx-post&quot;)
  rawHxPost?: string,
  /** https://htmx.org/attributes/hx-put/ */
  @as(&quot;hx-put&quot;)
  hxPut?: Handlers.hxPut,
  @as(&quot;data-hx-put&quot;)
  rawHxPut?: string,
  /** https://htmx.org/attributes/hx-delete/ */
  @as(&quot;hx-delete&quot;)
  hxDelete?: Handlers.hxDelete,
  @as(&quot;data-hx-delete&quot;)
  rawHxDelete?: string,
  /** https://htmx.org/attributes/hx-patch/ */
  @as(&quot;hx-patch&quot;)
  hxPatch?: Handlers.hxPatch,
  @as(&quot;data-hx-patch&quot;)
  rawHxPatch?: string,
  /** https://htmx.org/attributes/hx-swap/ */
  @as(&quot;hx-swap&quot;)
  hxSwap?: Swap.t,
  @as(&quot;data-hx-swap&quot;)
  rawHxSwap?: string,
  /** https://htmx.org/docs/#boosting */
  @as(&quot;hx-boost&quot;)
  hxBoost?: bool,
  /** https://htmx.org/attributes/hx-push-url/ */
  @as(&quot;hx-push-url&quot;)
  hxPushUrl?: hxUrl,
  @as(&quot;data-hx-push-url&quot;)
  rawHxPushUrl?: string,
  /** https://htmx.org/attributes/hx-replace-url/ */
  @as(&quot;hx-replace-url&quot;)
  hxReplaceUrl?: hxUrl,
  @as(&quot;data-hx-replace-url&quot;)
  rawHxReplaceUrl?: string,
  /** https://htmx.org/attributes/hx-select/ */
  @as(&quot;hx-select&quot;)
  hxSelect?: string,
  @as(&quot;data-hx-select&quot;)
  rawHxSelect?: string,
  /** https://htmx.org/attributes/hx-select-oob/ */
  @as(&quot;hx-select-oob&quot;)
  hxSelectOob?: string,
  @as(&quot;data-hx-select-oob&quot;)
  rawHxSelectOob?: string,
  /** https://htmx.org/attributes/hx-params/ */
  @as(&quot;hx-params&quot;)
  hxParams?: Params.t,
  @as(&quot;data-hx-params&quot;)
  rawHxParams?: string,
  /** https://htmx.org/attributes/hx-prompt/ */
  @as(&quot;hx-prompt&quot;)
  hxPrompt?: string,
  @as(&quot;data-hx-prompt&quot;)
  rawHxPrompt?: string,
  /** https://htmx.org/attributes/hx-validate/ */
  @as(&quot;hx-validate&quot;)
  hxValidate?: bool,
  /** https://htmx.org/attributes/hx-confirm/ */
  @as(&quot;hx-confirm&quot;)
  hxConfirm?: string,
  /** https://htmx.org/attributes/hx-disable/ */
  @as(&quot;hx-disable&quot;)
  hxDisable?: bool,
  /** https://htmx.org/attributes/hx-encoding/ */
  @as(&quot;hx-encoding&quot;)
  hxEncoding?: Encoding.t,
  @as(&quot;data-hx-encoding&quot;)
  rawHxEncoding?: string,
  /** https://htmx.org/attributes/hx-indicator/ */
  @as(&quot;hx-indicator&quot;)
  hxIndicator?: Indicator.t,
  @as(&quot;data-hx-indicator&quot;)
  rawHxIndicator?: string,
  /** https://htmx.org/attributes/hx-history/ */
  @as(&quot;hx-history&quot;)
  hxHistory?: bool,
  /** https://htmx.org/attributes/hx-history-elt/ */
  @as(&quot;hx-history-elt&quot;)
  hxHistoryElt?: bool,
  /** https://htmx.org/attributes/hx-include/ */
  @as(&quot;hx-include&quot;)
  hxInclude?: string,
  /** https://htmx.org/attributes/hx-headers/ */
  @as(&quot;hx-headers&quot;)
  hxHeaders?: Headers.t,
  @as(&quot;data-hx-headers&quot;)
  rawHxHeaders?: string,
  /** https://htmx.org/attributes/hx-sync/ */
  @as(&quot;hx-sync&quot;)
  hxSync?: Sync.t,
  @as(&quot;data-hx-sync&quot;)
  rawHxSync?: string,
  /** https://htmx.org/attributes/hx-vals/ */
  @as(&quot;hx-vals&quot;)
  hxVals?: Vals.t,
  @as(&quot;data-hx-vals&quot;)
  rawHxVals?: string,
  /** https://htmx.org/attributes/hx-preserve/ */
  @as(&quot;hx-preserve&quot;)
  hxPreserve?: bool,
  /** https://htmx.org/attributes/hx-disinherit/ */
  @as(&quot;hx-disinherit&quot;)
  hxDisinherit?: Disinherit.t,
  @as(&quot;data-hx-disinherit&quot;)
  rawHxDisinherit?: string,
  /** https://htmx.org/attributes/hx-target/  TODO */
  @as(&quot;hx-target&quot;)
  hxTarget?: Target.t,
  @as(&quot;data-hx-target&quot;)
  rawHxTarget?: string,
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file</p>
<pre class="codehilite"><code>type hxSwap =
  | @as(&quot;outerHTML&quot;) OuterHTML
  | @as(&quot;innerHTML&quot;) InnerHTML
  | @as(&quot;beforebegin&quot;) BeforeBegin
  | @as(&quot;afterbegin&quot;) AfterBegin
  | @as(&quot;beforeend&quot;) BeforeEnd
  | @as(&quot;afterend&quot;) AfterEnd
  | @as(&quot;delete&quot;) Delete
  | @as(&quot;none&quot;) None

type topOrBottom = | @as(&quot;top&quot;) Top | @as(&quot;bottom&quot;) Bottom

type modifier =
  | Swap(string)
  | Settle(string)
  | Transition
  | Scroll(topOrBottom)
  | ScrollWithSelector(string, topOrBottom)
  | Show(topOrBottom)
  | ShowWithSelector(string, topOrBottom)

module Swap: {
  type t
  let make: (hxSwap, ~modifier: modifier=?) =&gt; t
}

type hxTarget =
  | CssSelector(string)
  | This
  | Closest({cssSelector: string})
  | Find({cssSelector: string})
  | Next({cssSelector: string})
  | Previous({cssSelector: string})

module Target: {
  type t
  let make: hxTarget =&gt; t
}

@unboxed type hxUrl = | @as(true) True | @as(false) False | URL(string)

type hxParams = IncludeAll | IncludeNone | Not(array&lt;string&gt;) | Only(array&lt;string&gt;)

module Params: {
  type t
  let make: hxParams =&gt; t
}

type hxEncoding = MultipartFormData

module Encoding: {
  type t
  let make: hxEncoding =&gt; t
}

type hxIndicator = Selector(string) | Closest(string)

module Indicator: {
  type t
  let make: hxIndicator =&gt; t
}

module Headers: {
  type t
  let make: RescriptCore.Dict.t&lt;string&gt; =&gt; t
}

type hxSyncStrategyQueueModifier =
  | /** queue the first request to show up while a request is in flight */
  @as(&quot;first&quot;)
  First
  | /** queue the last request to show up while a request is in flight */
  @as(&quot;last&quot;)
  Last
  | /** queue all requests that show up while a request is in flight */
  @as(&quot;all&quot;)
  All

type hxSyncStrategy =
  | Drop
  | Abort
  | Replace
  | Queue
  | QueueWithModifier(hxSyncStrategyQueueModifier)

type hxSync = Selector(string) | SelectorAndStrategy(string, hxSyncStrategy)

module Sync: {
  type t
  let make: hxSync =&gt; t
}

type hxVals = Json(Js.Json.t) | JsonUnsafe(string) | RawJavaScript(string)

module Vals: {
  type t
  let make: hxVals =&gt; t
}

type hxInheritedAttributes =
  | Swap
  | Boost
  | PushUrl
  | ReplaceUrl
  | Select
  | SelectOob
  | Params
  | Prompt
  | Validate
  | Confirm
  | Disable
  | Encoding
  | Indicator
  | History
  | HistoryElt
  | Include
  | Headers
  | Sync
  | Vals
  | Preserve

type hxDisinherit = All | Attributes(array&lt;hxInheritedAttributes&gt;)

module Disinherit: {
  type t
  let make: hxDisinherit =&gt; t
}

type htmxProps = {
  /** https://htmx.org/attributes/hx-get/ */
  @as(&quot;hx-get&quot;)
  hxGet?: Handlers.hxGet,
  @as(&quot;data-hx-get&quot;)
  rawHxGet?: string,
  /** https://htmx.org/attributes/hx-post/ */
  @as(&quot;hx-post&quot;)
  hxPost?: Handlers.hxPost,
  @as(&quot;data-hx-post&quot;)
  rawHxPost?: string,
  /** https://htmx.org/attributes/hx-put/ */
  @as(&quot;hx-put&quot;)
  hxPut?: Handlers.hxPut,
  @as(&quot;data-hx-put&quot;)
  rawHxPut?: string,
  /** https://htmx.org/attributes/hx-delete/ */
  @as(&quot;hx-delete&quot;)
  hxDelete?: Handlers.hxDelete,
  @as(&quot;data-hx-delete&quot;)
  rawHxDelete?: string,
  /** https://htmx.org/attributes/hx-patch/ */
  @as(&quot;hx-patch&quot;)
  hxPatch?: Handlers.hxPatch,
  @as(&quot;data-hx-patch&quot;)
  rawHxPatch?: string,
  /** https://htmx.org/attributes/hx-swap/ */
  @as(&quot;hx-swap&quot;)
  hxSwap?: Swap.t,
  @as(&quot;data-hx-swap&quot;)
  rawHxSwap?: string,
  /** https://htmx.org/docs/#boosting */
  @as(&quot;hx-boost&quot;)
  hxBoost?: bool,
  /** https://htmx.org/attributes/hx-push-url/ */
  @as(&quot;hx-push-url&quot;)
  hxPushUrl?: hxUrl,
  @as(&quot;data-hx-push-url&quot;)
  rawHxPushUrl?: string,
  /** https://htmx.org/attributes/hx-replace-url/ */
  @as(&quot;hx-replace-url&quot;)
  hxReplaceUrl?: hxUrl,
  @as(&quot;data-hx-replace-url&quot;)
  rawHxReplaceUrl?: string,
  /** https://htmx.org/attributes/hx-select/ */
  @as(&quot;hx-select&quot;)
  hxSelect?: string,
  @as(&quot;data-hx-select&quot;)
  rawHxSelect?: string,
  /** https://htmx.org/attributes/hx-select-oob/ */
  @as(&quot;hx-select-oob&quot;)
  hxSelectOob?: string,
  @as(&quot;data-hx-select-oob&quot;)
  rawHxSelectOob?: string,
  /** https://htmx.org/attributes/hx-params/ */
  @as(&quot;hx-params&quot;)
  hxParams?: Params.t,
  @as(&quot;data-hx-params&quot;)
  rawHxParams?: string,
  /** https://htmx.org/attributes/hx-prompt/ */
  @as(&quot;hx-prompt&quot;)
  hxPrompt?: string,
  @as(&quot;data-hx-prompt&quot;)
  rawHxPrompt?: string,
  /** https://htmx.org/attributes/hx-validate/ */
  @as(&quot;hx-validate&quot;)
  hxValidate?: bool,
  /** https://htmx.org/attributes/hx-confirm/ */
  @as(&quot;hx-confirm&quot;)
  hxConfirm?: string,
  /** https://htmx.org/attributes/hx-disable/ */
  @as(&quot;hx-disable&quot;)
  hxDisable?: bool,
  /** https://htmx.org/attributes/hx-encoding/ */
  @as(&quot;hx-encoding&quot;)
  hxEncoding?: Encoding.t,
  @as(&quot;data-hx-encoding&quot;)
  rawHxEncoding?: string,
  /** https://htmx.org/attributes/hx-indicator/ */
  @as(&quot;hx-indicator&quot;)
  hxIndicator?: Indicator.t,
  @as(&quot;data-hx-indicator&quot;)
  rawHxIndicator?: string,
  /** https://htmx.org/attributes/hx-history/ */
  @as(&quot;hx-history&quot;)
  hxHistory?: bool,
  /** https://htmx.org/attributes/hx-history-elt/ */
  @as(&quot;hx-history-elt&quot;)
  hxHistoryElt?: bool,
  /** https://htmx.org/attributes/hx-include/ */
  @as(&quot;hx-include&quot;)
  hxInclude?: string,
  /** https://htmx.org/attributes/hx-headers/ */
  @as(&quot;hx-headers&quot;)
  hxHeaders?: Headers.t,
  @as(&quot;data-hx-headers&quot;)
  rawHxHeaders?: string,
  /** https://htmx.org/attributes/hx-sync/ */
  @as(&quot;hx-sync&quot;)
  hxSync?: Sync.t,
  @as(&quot;data-hx-sync&quot;)
  rawHxSync?: string,
  /** https://htmx.org/attributes/hx-vals/ */
  @as(&quot;hx-vals&quot;)
  hxVals?: Vals.t,
  @as(&quot;data-hx-vals&quot;)
  rawHxVals?: string,
  /** https://htmx.org/attributes/hx-preserve/ */
  @as(&quot;hx-preserve&quot;)
  hxPreserve?: bool,
  /** https://htmx.org/attributes/hx-disinherit/ */
  @as(&quot;hx-disinherit&quot;)
  hxDisinherit?: Disinherit.t,
  @as(&quot;data-hx-disinherit&quot;)
  rawHxDisinherit?: string,
  /** https://htmx.org/attributes/hx-target/  TODO */
  @as(&quot;hx-target&quot;)
  hxTarget?: Target.t,
  @as(&quot;data-hx-target&quot;)
  rawHxTarget?: string,
}
</code></pre>

<p>=========== End file</p><h2>brightid--deploycommands</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file DeployCommands.res</p>
<pre class="codehilite"><code>open Promise
open Discord

exception DeployCommandsError(string)
module Rest = {
  type t
  @module(&quot;@discordjs/rest&quot;) @new external make: {&quot;version&quot;: int} =&gt; t = &quot;REST&quot;
  @send external setToken: (t, string) =&gt; t = &quot;setToken&quot;
  @send
  external put: (t, string, {&quot;body&quot;: array&lt;SlashCommandBuilder.json&gt;}) =&gt; promise&lt;unit&gt; = &quot;put&quot;
  @send
  external delete: (t, string) =&gt; promise&lt;unit&gt; = &quot;delete&quot;
}

module Routes = {
  type t
  @module(&quot;discord-api-types/v9&quot;) @scope(&quot;Routes&quot;)
  external applicationCommands: (~clientId: string) =&gt; string = &quot;applicationCommands&quot;
  @module(&quot;discord-api-types/v9&quot;) @scope(&quot;Routes&quot;)
  external applicationCommand: (~clientId: string, ~commandId: string) =&gt; string =
    &quot;applicationCommand&quot;
}

Env.createEnv()

let envConfig = Env.getConfig()
let envConfig = switch envConfig {
| Ok(config) =&gt; config
| Error(err) =&gt; err-&gt;Env.EnvError-&gt;raise
}

let token = envConfig[&quot;discordApiToken&quot;]
let clientId = envConfig[&quot;discordClientId&quot;]

// @TODO: Shouldn't need to hardcode each command, instaed loop through files
let helpCommand = Commands_Help.data-&gt;SlashCommandBuilder.toJSON
let verifyCommand = Commands_Verify.data-&gt;SlashCommandBuilder.toJSON
let inviteCommand = Commands_Invite.data-&gt;SlashCommandBuilder.toJSON

let commands = [helpCommand, verifyCommand, inviteCommand]

let rest = Rest.make({&quot;version&quot;: 9})-&gt;Rest.setToken(token)

rest
-&gt;Rest.put(Routes.applicationCommands(~clientId), {&quot;body&quot;: commands})
-&gt;thenResolve(() =&gt; Console.log(&quot;Successfully registered application commands.&quot;))
-&gt;catch(e =&gt; {
  switch e {
  | DeployCommandsError(msg) =&gt; Console.error(&quot;Deploy Commands Error:&quot; ++ msg)
  | Exn.Error(obj) =&gt;
    switch Exn.message(obj) {
    | Some(msg) =&gt; Console.error(&quot;Deploy Commands Error: &quot; ++ msg)
    | None =&gt; Console.error(&quot;Must be some non-error value&quot;)
    }
  | _ =&gt; Console.error(&quot;Some unknown error&quot;)
  }
  resolve()
})
-&gt;ignore

// delete guilds command
// rest
// -&gt;Rest.delete(Routes.applicationCommand(~clientId, ~commandId=&quot;981007485634748511&quot;))
// -&gt;then(_ =&gt; {
//   Console.log(&quot;Successfully deleted guilds command.&quot;)-&gt;resolve
// })
// -&gt;catch(e =&gt; {
//   Console.log(e)
//   resolve()
// })
// -&gt;ignore
</code></pre>

<p>=========== End file</p><h2>catala-dsfr--dsfr</h2><p>Rescript v10</p>
<p>Repo: https://github.com/CatalaLang/catala-dsfr</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;catala-dsfr&quot;,
  &quot;version&quot;: &quot;0.1.1&quot;,
  &quot;repository&quot;: &quot;https://github.com/CatalaLang/catala-dsfr&quot;,
  &quot;scripts&quot;: {
    &quot;clean&quot;: &quot;rescript clean -with-deps&quot;,
    &quot;build&quot;: &quot;yarn run pre &amp;&amp; vite build&quot;,
    &quot;deploy&quot;: &quot;yarn run build --base=/demos/catala/ &amp;&amp; rsync -rv --delete-before dist/*&quot;,
    &quot;serve&quot;: &quot;vite preview&quot;,
    &quot;dev&quot;: &quot;yarn run pre &amp;&amp; vite&quot;,
    &quot;re:build&quot;: &quot;rescript build -with-deps&quot;,
    &quot;re:watch&quot;: &quot;yarn run pre &amp;&amp; rescript build -w -with-deps&quot;,
    &quot;assets&quot;: &quot;rsync -r node_modules/@catala-lang/catala-web-assets/assets/* assets&quot;,
    &quot;postinstall&quot;: &quot;copy-dsfr-to-public&quot;,
    &quot;pre&quot;: &quot;yarn run re:build &amp;&amp; only-include-used-icons &amp;&amp; yarn run assets&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;author&quot;: &quot;Emile Rolley &lt;emile.rolley@tuta.io&gt;&quot;,
  &quot;license&quot;: &quot;Apache-2.0&quot;,
  &quot;dependencies&quot;: {
    &quot;@catala-lang/catala-explain&quot;: &quot;^0.2.2&quot;,
    &quot;@catala-lang/catala-web-assets&quot;: &quot;^0.8.9&quot;,
    &quot;@catala-lang/french-law&quot;: &quot;^0.8.3-b.3&quot;,
    &quot;@catala-lang/rescript-catala&quot;: &quot;^0.8.1-b.0&quot;,
    &quot;@codegouvfr/react-dsfr&quot;: &quot;^0.78.2&quot;,
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;@rescript/react&quot;: &quot;^0.11.0&quot;,
    &quot;@rjsf/core&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/utils&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/validator-ajv8&quot;: &quot;^5.1.0&quot;,
    &quot;file-saver&quot;: &quot;^2.0.5&quot;,
    &quot;react&quot;: &quot;^18.2.0&quot;,
    &quot;react-dom&quot;: &quot;^18.2.0&quot;,
    &quot;react-loader-spinner&quot;: &quot;^5.4.5&quot;,
    &quot;rescript-docx&quot;: &quot;^0.1.5&quot;,
    &quot;tslib&quot;: &quot;^2.6.2&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@jihchi/vite-plugin-rescript&quot;: &quot;^5.1.0&quot;,
    &quot;@originjs/vite-plugin-commonjs&quot;: &quot;^1.0.3&quot;,
    &quot;@vitejs/plugin-react&quot;: &quot;^3.1.0&quot;,
    &quot;jsdom&quot;: &quot;^21.1.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.4&quot;,
    &quot;tailwindcss&quot;: &quot;^3.2.6&quot;,
    &quot;vite&quot;: &quot;^4.4.9&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Dsfr.res</p>
<pre class="codehilite"><code>type linkProps = {&quot;href&quot;: string, &quot;title&quot;: string}

module Spa = {
  type startReactDsfrParams&lt;'props&gt; = {
    defaultColorScheme: [#light | #dark | #system],
    verbose?: bool,
    @as(&quot;Link&quot;) link: 'props =&gt; React.element,
    useLang?: unit =&gt; [#fr | #en],
  }

  @module(&quot;@codegouvfr/react-dsfr/spa&quot;)
  external startReactDsfr: startReactDsfrParams&lt;'props&gt; =&gt; unit = &quot;startReactDsfr&quot;
}

module Badge = {
  type severity = [#success | #info | #warning | #error]
  type tag = [#span | #div | #p]
  @react.component @module(&quot;@codegouvfr/react-dsfr/Badge&quot;)
  external make: (
    ~className: string=?,
    ~children: React.element,
    ~noIcon: bool=?,
    ~small: bool=?,
    ~severity: severity=?,
    @as(&quot;as&quot;) ~as_: tag=?,
  ) =&gt; React.element = &quot;default&quot;
}

module Breadcrumb = {
  type segment = {label: string, linkProps: linkProps}
  @react.component @module(&quot;@codegouvfr/react-dsfr/Breadcrumb&quot;)
  external make: (
    ~id: string=?,
    ~className: string=?,
    ~homeLinkProps: linkProps=?,
    ~segments: array&lt;segment&gt;,
    ~currentPageLabel: string=?,
  ) =&gt; React.element = &quot;default&quot;
}

module Button = {
  type options = {
    disabled?: bool,
    iconId?: string,
    iconPosition?: string,
    onClick: JsxEvent.Mouse.t =&gt; unit,
    priority?: string,
    size?: string,
    children: React.element,
  }

  @react.component @module(&quot;@codegouvfr/react-dsfr/Button&quot;)
  external make: (
    ~children: React.element,
    ~disabled: bool=?,
    ~iconId: string=?,
    ~iconPosition: string=?,
    ~onClick: JsxEvent.Mouse.t =&gt; unit,
    ~priority: string=?,
    ~size: string=?,
  ) =&gt; React.element = &quot;default&quot;
}

module ButtonsGroup = {
  @react.component @module(&quot;@codegouvfr/react-dsfr/ButtonsGroup&quot;)
  external make: (
    ~alignment: string=?,
    ~buttonsSize: string=?,
    ~buttonsIconPosition: string=?,
    ~buttonsEquisized: bool=?,
    ~buttons: array&lt;Button.options&gt;,
    ~inlineLayoutWhen: string=?,
    ~className: string=?,
  ) =&gt; React.element = &quot;default&quot;
}

module CallOut = {
  @react.component @module(&quot;@codegouvfr/react-dsfr/CallOut&quot;)
  external make: (~title: string=?, ~children: React.element, ~iconId: string=?) =&gt; React.element =
    &quot;default&quot;
}

module Card = {
  @react.component @module(&quot;@codegouvfr/react-dsfr/Card&quot;)
  external make: (
    ~title: string,
    ~desc: string,
    ~linkProps: linkProps,
    ~enlargeLink: bool=?,
    ~size: string=?,
  ) =&gt; React.element = &quot;default&quot;
}

module Header = {
  @react.component @module(&quot;@codegouvfr/react-dsfr/Header&quot;)
  external make: (
    ~brandTop: React.element=?,
    ~homeLinkProps: linkProps,
    ~serviceTagline: string,
    ~operatorLogo: {&quot;alt&quot;: string, &quot;imgUrl&quot;: string, &quot;orientation&quot;: string}=?,
    ~serviceTitle: React.element,
  ) =&gt; React.element = &quot;default&quot;
}

module Footer = {
  @react.component @module(&quot;@codegouvfr/react-dsfr/Footer&quot;)
  external make: (
    ~accessibility: string,
    ~brandTop: React.element=?,
    ~contentDescription: React.element=?,
    ~homeLinkProps: linkProps=?,
    ~bottomItems: array&lt;'button&gt;=?,
    ~license: React.element=?,
  ) =&gt; React.element = &quot;default&quot;
}

module Display = {
  @module(&quot;@codegouvfr/react-dsfr/Display&quot;)
  external headerFooterDisplayItem: 'button = &quot;headerFooterDisplayItem&quot;
}

module Notice = {
  @react.component @module(&quot;@codegouvfr/react-dsfr/Notice&quot;)
  external make: (~title: string, ~isClosable: bool=?) =&gt; React.element = &quot;default&quot;
}
</code></pre>

<p>=========== End file</p><h2>brightid--remixauth</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file RemixAuth.res</p>
<pre class="codehilite"><code>module User = {
  type t
  type profile
  @get external getAccessToken: t =&gt; string = &quot;accessToken&quot;
  @get external getProfile: t =&gt; profile = &quot;profile&quot;
  @get external getId: profile =&gt; string = &quot;id&quot;
}

module DiscordStrategy = {
  type t
  module CreateDiscordStategyOptions = {
    type t
    @obj
    external make: (
      ~clientID: string,
      ~clientSecret: string,
      ~callbackURL: string,
      // Provide all the scopes you want as an array
      ~scope: array&lt;string&gt;,
      unit,
    ) =&gt; t = &quot;&quot;
  }

  // module CreateVerifyFunctionOptions = {
  //   type t
  //   @obj
  //   external make: (
  //     ~accessToken: string,
  //     ~refreshToken: string,
  //     ~extraParams: 'a,
  //     ~profile: 'b,
  //     unit,
  //   ) =&gt; t = &quot;&quot;
  // }
  type verifyFunctionParams&lt;'a, 'b&gt; = {
    accessToken: string,
    refreshToken: string,
    extraParams: 'a,
    profile: 'b,
  }

  @module(&quot;remix-auth-socials&quot;) @new
  external make: (
    CreateDiscordStategyOptions.t,
    verifyFunctionParams&lt;'a, 'b&gt; =&gt; Js.Promise.t&lt;'a&gt;,
  ) =&gt; t = &quot;DiscordStrategy&quot;
}

// module SocialsProvider = {
//   type t = [#Discord]

// }

module CreateAuthenticateOptions = {
  type t

  @obj external make: (~successRedirect: string=?, ~failureRedirect: string=?, unit) =&gt; t = &quot;&quot;
}

module Authenticator = {
  type t
  @module(&quot;remix-auth&quot;) @new external make: Remix.SessionStorage.t =&gt; t = &quot;Authenticator&quot;
  @send external use: (t, DiscordStrategy.t) =&gt; unit = &quot;use&quot;
  @send
  external authenticate: (t, string, Webapi.Fetch.Request.t) =&gt; Js.Promise.t&lt;User.t&gt; =
    &quot;authenticate&quot;

  @send
  external authenticateWithOptions: (
    t,
    string,
    Webapi.Fetch.Request.t,
    ~options: CreateAuthenticateOptions.t,
  ) =&gt; Js.Promise.t&lt;User.t&gt; = &quot;authenticate&quot;
  @send
  external isAuthenticated: (t, Webapi.Fetch.Request.t) =&gt; Js.Promise.t&lt;Js.Nullable.t&lt;User.t&gt;&gt; =
    &quot;isAuthenticated&quot;
  @send
  external isAuthenticatedWithOptions: (
    t,
    Webapi.Fetch.Request.t,
    ~options: CreateAuthenticateOptions.t,
  ) =&gt; Js.Promise.t&lt;Js.Nullable.t&lt;User.t&gt;&gt; = &quot;isAuthenticated&quot;

  @send
  external logout: (t, Webapi.Fetch.Request.t, ~options: 'option) =&gt; Js.Promise.t&lt;unit&gt; = &quot;logout&quot;
}
</code></pre>

<p>=========== End file</p><h2>catala-dsfr--sourcecode</h2><p>Rescript v10</p>
<p>Repo: https://github.com/CatalaLang/catala-dsfr</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;catala-dsfr&quot;,
  &quot;version&quot;: &quot;0.1.1&quot;,
  &quot;repository&quot;: &quot;https://github.com/CatalaLang/catala-dsfr&quot;,
  &quot;scripts&quot;: {
    &quot;clean&quot;: &quot;rescript clean -with-deps&quot;,
    &quot;build&quot;: &quot;yarn run pre &amp;&amp; vite build&quot;,
    &quot;deploy&quot;: &quot;yarn run build --base=/demos/catala/ &amp;&amp; rsync -rv --delete-before dist/*&quot;,
    &quot;serve&quot;: &quot;vite preview&quot;,
    &quot;dev&quot;: &quot;yarn run pre &amp;&amp; vite&quot;,
    &quot;re:build&quot;: &quot;rescript build -with-deps&quot;,
    &quot;re:watch&quot;: &quot;yarn run pre &amp;&amp; rescript build -w -with-deps&quot;,
    &quot;assets&quot;: &quot;rsync -r node_modules/@catala-lang/catala-web-assets/assets/* assets&quot;,
    &quot;postinstall&quot;: &quot;copy-dsfr-to-public&quot;,
    &quot;pre&quot;: &quot;yarn run re:build &amp;&amp; only-include-used-icons &amp;&amp; yarn run assets&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;author&quot;: &quot;Emile Rolley &lt;emile.rolley@tuta.io&gt;&quot;,
  &quot;license&quot;: &quot;Apache-2.0&quot;,
  &quot;dependencies&quot;: {
    &quot;@catala-lang/catala-explain&quot;: &quot;^0.2.2&quot;,
    &quot;@catala-lang/catala-web-assets&quot;: &quot;^0.8.9&quot;,
    &quot;@catala-lang/french-law&quot;: &quot;^0.8.3-b.3&quot;,
    &quot;@catala-lang/rescript-catala&quot;: &quot;^0.8.1-b.0&quot;,
    &quot;@codegouvfr/react-dsfr&quot;: &quot;^0.78.2&quot;,
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;@rescript/react&quot;: &quot;^0.11.0&quot;,
    &quot;@rjsf/core&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/utils&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/validator-ajv8&quot;: &quot;^5.1.0&quot;,
    &quot;file-saver&quot;: &quot;^2.0.5&quot;,
    &quot;react&quot;: &quot;^18.2.0&quot;,
    &quot;react-dom&quot;: &quot;^18.2.0&quot;,
    &quot;react-loader-spinner&quot;: &quot;^5.4.5&quot;,
    &quot;rescript-docx&quot;: &quot;^0.1.5&quot;,
    &quot;tslib&quot;: &quot;^2.6.2&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@jihchi/vite-plugin-rescript&quot;: &quot;^5.1.0&quot;,
    &quot;@originjs/vite-plugin-commonjs&quot;: &quot;^1.0.3&quot;,
    &quot;@vitejs/plugin-react&quot;: &quot;^3.1.0&quot;,
    &quot;jsdom&quot;: &quot;^21.1.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.4&quot;,
    &quot;tailwindcss&quot;: &quot;^3.2.6&quot;,
    &quot;vite&quot;: &quot;^4.4.9&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file SourceCode.res</p>
<pre class="codehilite"><code>%%raw(`import  &quot;../css/catala-code.css&quot;`)
%%raw(`import  &quot;../css/syntax-highlighting.css&quot;`)

/*
[scrollToAndHighlightLineNum(parentElem, ids)] scrolls into the corresponding
Catala code line of [ids] inside the [parentElem] DOM element and highlight the
line numbers.
*/

module HtmlSourceCodeLazy = {
  @react.component @module(&quot;../components/HtmlSourceCodeLazy.tsx&quot;)
  external make: (~html: string, ~hash: string) =&gt; React.element = &quot;default&quot;
}

@react.component
let make = (~html: option&lt;string&gt;, ~simulatorUrl: string) =&gt; {
  let {hash} = Nav.getCurrentURL()

  switch html {
  | Some(html) =&gt;
    &lt;div className=&quot;fr-container&quot;&gt;
      &lt;Button.RightAlign
        props={
          iconId: &quot;fr-icon-equalizer-line&quot;,
          iconPosition: &quot;left&quot;,
          priority: &quot;tertiary&quot;,
          size: &quot;medium&quot;,
          onClick: {_ =&gt; `/${simulatorUrl}`-&gt;Nav.goTo},
          children: {&quot;Accéder au simulateur&quot;-&gt;React.string},
        }
      /&gt;
      &lt;React.Suspense fallback={Spinners.loader}&gt;
        &lt;HtmlSourceCodeLazy html hash /&gt;
      &lt;/React.Suspense&gt;
    &lt;/div&gt;
  | None =&gt;
    ()
    &lt;div&gt;
      &lt;p&gt; {&quot;No source code available for this snippet.&quot;-&gt;React.string} &lt;/p&gt;
    &lt;/div&gt;
  }
}
</code></pre>

<p>=========== End file</p><h2>res-x--devs</h2><p>Rescript v11</p>
<p>Repo: https://github.com/zth/res-x</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;rescript-x&quot;,
  &quot;version&quot;: &quot;0.1.0-alpha.7&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;files&quot;: [
    &quot;README.md&quot;,
    &quot;CHANGELOG.md&quot;,
    &quot;rescript.json&quot;,
    &quot;src/**/*&quot;,
    &quot;res-x-vite-plugin.mjs&quot;
  ],
  &quot;author&quot;: &quot;Gabriel Nordeborn&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;peerDependencies&quot;: {
    &quot;rescript&quot;: &quot;&gt;=11.0.0-rc.5&quot;,
    &quot;@rescript/core&quot;: &quot;&gt;=0.5.0&quot;,
    &quot;vite&quot;: &quot;&gt;=4.4.11&quot;,
    &quot;rescript-bun&quot;: &quot;&gt;=0.1.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.5&quot;,
    &quot;rescript-bun&quot;: &quot;0.1.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Dev.res</p>
<pre class="codehilite"><code>module React = ResX__React
module ReactDOM = ResX__ReactDOM

let getScript = (~port) =&gt;
  `(() =&gt; {
let hasMadeInitialConnection = false;
let timeout;
let socket = null;
let reconnectInterval;
let debugging = true;

let debug = (...msg) =&gt; {
  if (debugging) {
    console.log(...msg)
  }
}

function reload() {
  clearTimeout(timeout)
  timeout = setTimeout(() =&gt; {
    window.location.reload()
  }, 200)
}

function connect() {
  clearInterval(reconnectInterval)
  reconnectInterval = setInterval(() =&gt; {
    if (socket == null || socket.readyState === 2 || socket.readyState === 3) {
      bootSocket()
    } else if (socket != null &amp;&amp; (socket.readyState === 0 || socket.readyState === 1)) {
      clearInterval(reconnectInterval)
    }
  }, 200)
}

function updateContent() {
  fetch(document.location.href).then(async res =&gt; {
    let text = await res.text()
    try {
      let domParser = new DOMParser()
      let fromDom = document.documentElement
      let toDom = domParser.parseFromString(text, &quot;text/html&quot;).querySelector(&quot;html&quot;)
      morphdom(fromDom, toDom, {
        onBeforeElUpdated: function(fromEl, toEl) {
          if (fromEl.isEqualNode(toEl)) {
            return false;
          }

          if (fromEl.tagName === 'INPUT') {
            if (fromEl.type === 'checkbox' || fromEl.type === 'radio') {
              toEl.checked = fromEl.checked;
            } else {
              toEl.value = fromEl.value;
            }
          } else if (fromEl.tagName === 'TEXTAREA') {
            toEl.value = fromEl.value;
          }

          if (fromEl.tagName === 'SELECT') {
            toEl.selectedIndex = fromEl.selectedIndex;
          }

          return true;
        }
      })
      debug(&quot;[dev] Content reloaded.&quot;)
    } catch(e) {
      console.warn(&quot;[dev] Error morphing DOM. Doing full reload.&quot;)
      console.error(e)
      document.documentElement.innerHTML = text

    }
  })
}

function bootSocket() {
  socket = new WebSocket(&quot;ws://localhost:${(port + 1)-&gt;Int.toString}&quot;)
  socket.addEventListener(&quot;close&quot;, event =&gt; {
    debug(&quot;[dev] Server restarting&quot;)
    if (event.isTrusted) {
      socket = null
      connect()
    }
  })
  socket.addEventListener(&quot;open&quot;, event =&gt; {
    debug(&quot;[dev] Server connection opened.&quot;)
    if (hasMadeInitialConnection) {
      updateContent()
    }
    hasMadeInitialConnection = true
  })
}

bootSocket()
})()
`

@react.component
let make = (~port=4444) =&gt; {
  if BunUtils.isDev {
    [
      &lt;script dangerouslySetInnerHTML={{&quot;__html&quot;: getScript(~port)}} /&gt;,
      &lt;script src=&quot;https://unpkg.com/morphdom/dist/morphdom-umd.js&quot; /&gt;,
      &lt;script type_=&quot;module&quot; src=&quot;http://localhost:9000/@vite/client&quot; /&gt;,
    ]-&gt;H.array
  } else {
    H.null
  }
}
</code></pre>

<p>=========== End file</p><h2>brightid--root</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Root.res</p>
<pre class="codehilite"><code>%%raw(`import rainbowKit from &quot;@rainbow-me/rainbowkit/styles.css&quot;`)
%%raw(`import proSidebar from &quot;react-pro-sidebar/dist/css/styles.css&quot;`)
%%raw(`
import {
  getDefaultWallets,
} from &quot;@rainbow-me/rainbowkit&quot;;
import { createClient, configureChains } from &quot;wagmi&quot;
import { mainnet} from 'wagmi/chains'
import { alchemyProvider } from 'wagmi/providers/alchemy'
import { publicProvider } from 'wagmi/providers/public'
import { jsonRpcProvider } from '@wagmi/core/providers/jsonRpc'

`)

module LodashMerge = {
  @module(&quot;lodash.merge&quot;) external merge: ('a, 'b) =&gt; 'a = &quot;default&quot;
}

@live
let meta = () =&gt;
  {
    &quot;charset&quot;: &quot;utf-8&quot;,
    &quot;title&quot;: &quot;Bright ID Discord Command Center&quot;,
    &quot;viewport&quot;: &quot;width=device-width,initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot;,
  }

@live
let links = () =&gt; {
  [
    {
      &quot;rel&quot;: &quot;stylesheet&quot;,
      &quot;href&quot;: %raw(`require(&quot;./styles/app.css&quot;)`),
    },
    {
      &quot;rel&quot;: &quot;stylesheet&quot;,
      &quot;href&quot;: %raw(`rainbowKit`),
    },
    {
      &quot;rel&quot;: &quot;stylesheet&quot;,
      &quot;href&quot;: %raw(`proSidebar`),
    },
  ]
}

let _idChain = {
  &quot;id&quot;: 74,
  &quot;name&quot;: &quot;ID Chain&quot;,
  &quot;nativeCurrency&quot;: {&quot;name&quot;: &quot;Eidi&quot;, &quot;symbol&quot;: &quot;EIDI&quot;, &quot;decimals&quot;: 18},
  &quot;rpcUrls&quot;: {
    &quot;default&quot;: {
      &quot;http&quot;: &quot;https://idchain.one/rpc&quot;,
    },
  },
  &quot;blockExplorers&quot;: [
    {
      &quot;name&quot;: &quot;Blockscout&quot;,
      &quot;url&quot;: &quot;https://explorer.idchain.one/&quot;,
    },
  ],
}

type loaderData = {maybeUser: option&lt;RemixAuth.User.t&gt;, rateLimited: bool}

@live
let loader: Remix.loaderFunction&lt;loaderData&gt; = ({request}) =&gt; {
  open DiscordServer
  open Promise

  AuthServer.authenticator
  -&gt;RemixAuth.Authenticator.isAuthenticated(request)
  -&gt;then(user =&gt; {
    {maybeUser: user-&gt;Js.Nullable.toOption, rateLimited: false}-&gt;resolve
  })
  -&gt;catch(error =&gt; {
    switch error {
    | DiscordRateLimited =&gt; {maybeUser: None, rateLimited: true}-&gt;resolve
    | _ =&gt; {maybeUser: None, rateLimited: false}-&gt;resolve
    }
  })
}

let myTheme = LodashMerge.merge(
  RainbowKit.Themes.darkTheme(),
  {&quot;colors&quot;: {&quot;accentColor&quot;: &quot;#ed7a5c&quot;}},
)

let chainConfig = %raw(`configureChains(
    [mainnet, _idChain],
    [
      alchemyProvider({
        apiKey: &quot;Klcw92W_rTgV55TL0zq972TFXTI1FieU&quot;,
        stallTimeout: 5_000
      }),
      jsonRpcProvider({
        rpc: (chain)  =&gt; ({ http: chain.rpcUrls.default.http })
      }),

    ]

  )`)

let _defaultWallets = %raw(`getDefaultWallets({
    appName: &quot;Bright ID Discord Command Center&quot;,
    chains: chainConfig.chains,
  })`)

let wagmiClient = %raw(`createClient({
    autoConnect: true,
    connectors: _defaultWallets.connectors,
    provider: chainConfig.provider,
  })`)

type state = {
  userGuilds: array&lt;Types.oauthGuild&gt;,
  botGuilds: array&lt;Types.oauthGuild&gt;,
  after: option&lt;string&gt;,
  loadingGuilds: bool,
  wagmiClient: option&lt;Wagmi.client&gt;,
  chains: option&lt;array&lt;Wagmi.chain&gt;&gt;,
}

let state = {
  userGuilds: [],
  botGuilds: [],
  after: Some(&quot;0&quot;),
  loadingGuilds: true,
  wagmiClient: Some(wagmiClient),
  chains: Some(chainConfig[&quot;chains&quot;]),
}

type actions =
  | AddBotGuilds(array&lt;Types.oauthGuild&gt;)
  | UserGuilds(array&lt;Types.oauthGuild&gt;)
  | SetAfter(option&lt;string&gt;)
  | SetLoadingGuilds(bool)
  | SetWagmiClient(option&lt;Wagmi.client&gt;)
  | SetChains(option&lt;array&lt;Wagmi.chain&gt;&gt;)

let reducer = (state, action) =&gt;
  switch action {
  | AddBotGuilds(newBotGuilds) =&gt; {
      ...state,
      botGuilds: state.botGuilds-&gt;Belt.Array.concat(newBotGuilds),
    }
  | UserGuilds(userGuilds) =&gt; {...state, userGuilds}
  | SetAfter(after) =&gt; {...state, after}
  | SetLoadingGuilds(loadingGuilds) =&gt; {...state, loadingGuilds}
  | SetWagmiClient(wagmiClient) =&gt; {...state, wagmiClient}
  | SetChains(chains) =&gt; {...state, chains}
  }

@live @react.component
let default = () =&gt; {
  open RainbowKit
  let {maybeUser, rateLimited} = Remix.useLoaderData()
  let (isSidebarVisible, setIsSidebarVisible) = React.useState(_ =&gt; false)

  let fetcher = Remix.useFetcher()

  let (state, dispatch) = React.useReducer(reducer, state)

  React.useEffect1(() =&gt; {
    open Remix
    switch state.after {
    | None =&gt; ()
    | Some(after) =&gt;
      switch fetcher-&gt;Fetcher._type {
      | &quot;init&quot; =&gt;
        fetcher-&gt;Fetcher.load(~href=`/Root_FetchGuilds?after=${after}`)
        SetLoadingGuilds(true)-&gt;dispatch

      | &quot;done&quot; =&gt;
        switch fetcher-&gt;Remix.Fetcher.data-&gt;Js.Nullable.toOption {
        | None =&gt;
          SetLoadingGuilds(false)-&gt;dispatch
          None-&gt;SetAfter-&gt;dispatch
        | Some(data) =&gt;
          switch data[&quot;userGuilds&quot;] {
          | [] =&gt; ()
          | _ =&gt; data[&quot;userGuilds&quot;]-&gt;UserGuilds-&gt;dispatch
          }
          switch data[&quot;botGuilds&quot;] {
          | [] =&gt; None-&gt;SetAfter-&gt;dispatch
          | _ =&gt; data[&quot;botGuilds&quot;]-&gt;AddBotGuilds-&gt;dispatch
          }
          if state.after === data[&quot;after&quot;] {
            None-&gt;SetAfter-&gt;dispatch
            SetLoadingGuilds(false)-&gt;dispatch
          } else {
            data[&quot;after&quot;]-&gt;SetAfter-&gt;dispatch
            fetcher-&gt;Fetcher.load(~href=`/Root_FetchGuilds?after=${data[&quot;after&quot;]}`)
          }
        }
      | _ =&gt; ()
      }
    }

    None
  }, [fetcher])

  let guilds =
    state.userGuilds-&gt;Js.Array2.filter(userGuild =&gt;
      state.botGuilds-&gt;Js.Array2.findIndex(botGuild =&gt; botGuild.id === userGuild.id) !== -1
    )

  let handleIsSidebarVisible = value =&gt; {
    setIsSidebarVisible(_prev =&gt; value)
  }

  &lt;html&gt;
    &lt;head&gt;
      &lt;meta charSet=&quot;utf-8&quot; /&gt;
      &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1&quot; /&gt;
      &lt;Remix.Meta /&gt;
      &lt;Remix.Links /&gt;
    &lt;/head&gt;
    &lt;body className=&quot;h-screen w-screen bg-dark&quot;&gt;
      {switch (state.wagmiClient, state.chains) {
      | (Some(client), Some(chains)) =&gt;
        &lt;Wagmi.WagmiConfig client={client}&gt;
          &lt;RainbowKitProvider chains={chains} theme={myTheme}&gt;
            &lt;div className=&quot;flex h-screen w-screen&quot;&gt;
              {switch maybeUser {
              | None =&gt; &lt;&gt; &lt;/&gt;
              | Some(_) =&gt;
                &lt;Sidebar
                  isSidebarVisible handleIsSidebarVisible guilds loadingGuilds={state.loadingGuilds}
                /&gt;
              }}
              &lt;Remix.Outlet
                context={{
                  &quot;isSidebarVisible&quot;: isSidebarVisible,
                  &quot;handleIsSidebarVisible&quot;: handleIsSidebarVisible,
                  &quot;rateLimited&quot;: rateLimited,
                  &quot;guilds&quot;: guilds,
                }}
              /&gt;
            &lt;/div&gt;
          &lt;/RainbowKitProvider&gt;
        &lt;/Wagmi.WagmiConfig&gt;
      | _ =&gt; &lt;&gt; &lt;/&gt;
      }}
      &lt;Remix.ScrollRestoration /&gt;
      &lt;Remix.Scripts /&gt;
      {if Remix.process[&quot;env&quot;][&quot;NODE_ENV&quot;] === &quot;development&quot; {
        &lt;Remix.LiveReload /&gt;
      } else {
        React.null
      }}
    &lt;/body&gt;
  &lt;/html&gt;
}

%%raw(`
export function ErrorBoundary({ error }) {
  console.error(error);
  return (
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;Oh no!&lt;/title&gt;
        &lt;React$1.Meta /&gt;
        &lt;React$1.Links /&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;p className=&quot;text-center&quot;&gt;Something went wrong!&lt;/p&gt;
        &lt;p className=&quot;text-center&quot;&gt;BrightID command center is still in Beta. Try reloading the page!&lt;/p&gt;
        &lt;React$1.Scripts /&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  );
}`)
</code></pre>

<p>=========== End file</p><h2>res-x--bunutils</h2><p>Rescript v11</p>
<p>Repo: https://github.com/zth/res-x</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;rescript-x&quot;,
  &quot;version&quot;: &quot;0.1.0-alpha.7&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;files&quot;: [
    &quot;README.md&quot;,
    &quot;CHANGELOG.md&quot;,
    &quot;rescript.json&quot;,
    &quot;src/**/*&quot;,
    &quot;res-x-vite-plugin.mjs&quot;
  ],
  &quot;author&quot;: &quot;Gabriel Nordeborn&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;peerDependencies&quot;: {
    &quot;rescript&quot;: &quot;&gt;=11.0.0-rc.5&quot;,
    &quot;@rescript/core&quot;: &quot;&gt;=0.5.0&quot;,
    &quot;vite&quot;: &quot;&gt;=4.4.11&quot;,
    &quot;rescript-bun&quot;: &quot;&gt;=0.1.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.5&quot;,
    &quot;rescript-bun&quot;: &quot;0.1.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file BunUtils.res</p>
<pre class="codehilite"><code>external process: 'process = &quot;process&quot;

let isDev = process[&quot;env&quot;][&quot;NODE_ENV&quot;] !== &quot;production&quot;

type globConfig = {
  dot?: bool,
  cwd?: string,
}

@module(&quot;fast-glob&quot;)
external glob: (array&lt;string&gt;, globConfig) =&gt; promise&lt;array&lt;string&gt;&gt; = &quot;glob&quot;

let loadStaticFiles = async (~root=?) =&gt; {
  await glob(
    switch isDev {
    | true =&gt; [&quot;public/**/*&quot;, &quot;assets/**/*&quot;]
    | false =&gt; [&quot;dist/**/*&quot;]
    },
    {
      dot: true,
      cwd: switch root {
      | None =&gt; process[&quot;cwd&quot;]()
      | Some(cwd) =&gt; cwd
      },
    },
  )
}

let staticFiles = ref(None)

let serveStaticFile = async request =&gt; {
  open Bun

  let staticFiles = switch staticFiles.contents {
  | None =&gt;
    let files = await loadStaticFiles()
    let files =
      files
      -&gt;Array.map(f =&gt; {
        (
          switch isDev {
          | true if f-&gt;String.startsWith(&quot;public/&quot;) =&gt; f-&gt;String.sliceToEnd(~start=7)
          | false if f-&gt;String.startsWith(&quot;dist/&quot;) =&gt; f-&gt;String.sliceToEnd(~start=5)
          | _ =&gt; f
          },
          f,
        )
      })
      -&gt;Map.fromArray
    staticFiles := Some(files)
    files
  | Some(s) =&gt; s
  }

  let url = request-&gt;Request.url-&gt;URL.make
  let pathname = url-&gt;URL.pathname

  let path = pathname-&gt;String.split(&quot;/&quot;)-&gt;Array.filter(p =&gt; p !== &quot;&quot;)
  let joined = path-&gt;Array.joinWith(&quot;/&quot;)

  switch staticFiles-&gt;Map.get(joined) {
  | None =&gt; None
  | Some(fileLoc) =&gt;
    let bunFile = Bun.file(&quot;./&quot; ++ fileLoc)

    Some(
      switch bunFile-&gt;BunFile.size {
      | 0. =&gt; Response.make(&quot;&quot;, ~options={status: 404})
      | _ =&gt; Response.makeFromFile(bunFile)
      },
    )
  }
}

let runDevServer = (~port) =&gt; {
  let _devServer = Bun.serveWithWebSocket({
    port: port + 1,
    development: true,
    websocket: {
      open_: _v =&gt; {
        ()
      },
    },
    fetch: async (request, server) =&gt; {
      open Bun

      if server-&gt;Server.upgrade(request) {
        Response.defer
      } else {
        Response.make(&quot;&quot;, ~options={status: 404})
      }
    },
  })
}

module URLSearchParams = {
  let copy = search =&gt;
    URLSearchParams.makeWithInit(
      search
      -&gt;URLSearchParams.entries
      -&gt;Dict.fromIterator
      -&gt;Object,
    )
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file BunUtils.resi</p>
<pre class="codehilite"><code>let serveStaticFile: Request.t =&gt; promise&lt;option&lt;Response.t&gt;&gt;

let runDevServer: (~port: int) =&gt; unit

let isDev: bool

module URLSearchParams: {
  let copy: URLSearchParams.t =&gt; URLSearchParams.t
}
</code></pre>

<p>=========== End file</p><h2>brightid--brightid</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file BrightId.res</p>
<pre class="codehilite"><code>@module(&quot;brightid_sdk&quot;)
external verifyContextId: (
  ~context: string,
  ~contextId: string,
  ~nodeUrl: string=?,
  unit,
) =&gt; Js.Promise.t&lt;Js.Json.t&gt; = &quot;verifyContextId&quot;

@module(&quot;brightid_sdk&quot;)
external generateDeeplink: (
  ~context: string,
  ~contextId: string,
  ~nodeUrl: string=?,
  unit,
) =&gt; string = &quot;generateDeeplink&quot;
</code></pre>

<p>=========== End file</p><h2>res-x--resxclient</h2><p>Rescript v11</p>
<p>Repo: https://github.com/zth/res-x</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;rescript-x&quot;,
  &quot;version&quot;: &quot;0.1.0-alpha.7&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;files&quot;: [
    &quot;README.md&quot;,
    &quot;CHANGELOG.md&quot;,
    &quot;rescript.json&quot;,
    &quot;src/**/*&quot;,
    &quot;res-x-vite-plugin.mjs&quot;
  ],
  &quot;author&quot;: &quot;Gabriel Nordeborn&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;peerDependencies&quot;: {
    &quot;rescript&quot;: &quot;&gt;=11.0.0-rc.5&quot;,
    &quot;@rescript/core&quot;: &quot;&gt;=0.5.0&quot;,
    &quot;vite&quot;: &quot;&gt;=4.4.11&quot;,
    &quot;rescript-bun&quot;: &quot;&gt;=0.1.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.5&quot;,
    &quot;rescript-bun&quot;: &quot;0.1.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file ResXClient.res</p>
<pre class="codehilite"><code>
</code></pre>

<p>=========== End file
=========== Start file ResXClient.res</p>
<pre class="codehilite"><code>@send
external addEventListener: (Dom.document, string, 'event =&gt; unit, ~capturePhase: bool=?) =&gt; unit =
  &quot;addEventListener&quot;
external document: Dom.document = &quot;document&quot;

external querySelector: string =&gt; Null.t&lt;'element&gt; = &quot;document.querySelector&quot;

type validity = {
  badInput: bool,
  patternMismatch: bool,
  rangeOverflow: bool,
  rangeUnderflow: bool,
  stepMismatch: bool,
  tooLong: bool,
  tooShort: bool,
  typeMismatch: bool,
  valueMissing: bool,
  valid: bool,
}

type attr = {value: string}
type classList = {toggle: string =&gt; unit, add: string =&gt; unit, remove: string =&gt; unit}
type element = {
  &quot;attributes&quot;: {&quot;resx-onclick&quot;: option&lt;attr&gt;, &quot;resx-validity-message&quot;: option&lt;attr&gt;},
  &quot;classList&quot;: classList,
  &quot;validity&quot;: option&lt;validity&gt;,
  &quot;setCustomValidity&quot;: string =&gt; unit,
  &quot;remove&quot;: unit =&gt; unit,
}
type event = {&quot;target&quot;: element}

external parseActions: string =&gt; array&lt;Client.Actions.action&gt; = &quot;JSON.parse&quot;
external parseValidityMessage: string =&gt; Client.ValidityMessage.config = &quot;JSON.parse&quot;

(
  () =&gt; {
    let getTarget = (target: Client.Actions.target, this: element): Null.t&lt;element&gt; =&gt; {
      switch target {
      | This =&gt; Value(this)
      | CssSelector({selector}) =&gt; querySelector(selector)
      }
    }

    let handleAction = (action: Client.Actions.action, this) =&gt; {
      let target = switch action {
      | ToggleClass({target})
      | RemoveClass({target})
      | AddClass({target})
      | RemoveElement({target}) =&gt;
        getTarget(target, this)
      }

      switch target {
      | Null =&gt; ()
      | Value(target) =&gt;
        switch action {
        | ToggleClass({className}) =&gt; target[&quot;classList&quot;].toggle(className)
        | RemoveClass({className}) =&gt; target[&quot;classList&quot;].remove(className)
        | AddClass({className}) =&gt; target[&quot;classList&quot;].add(className)
        | RemoveElement(_) =&gt; target[&quot;remove&quot;]()
        }
      }
    }

    document-&gt;addEventListener(&quot;click&quot;, (event: event) =&gt; {
      let this = event[&quot;target&quot;]
      let actions = switch this[&quot;attributes&quot;][&quot;resx-onclick&quot;] {
      | None =&gt; []
      | Some({value}) =&gt; parseActions(value)
      }

      actions-&gt;Array.forEach(action =&gt; handleAction(action, this))
    })

    document-&gt;addEventListener(&quot;invalid&quot;, ~capturePhase=true, (event: event) =&gt; {
      let this = event[&quot;target&quot;]
      switch (this[&quot;validity&quot;], this[&quot;attributes&quot;][&quot;resx-validity-message&quot;]) {
      | (Some({valid: false} as validity), Some({value})) =&gt;
        let validityMessages = parseValidityMessage(value)
        let messageToSet = switch validity {
        | {badInput: true} =&gt; validityMessages.badInput
        | {patternMismatch: true} =&gt; validityMessages.patternMismatch
        | {rangeOverflow: true} =&gt; validityMessages.rangeOverflow
        | {rangeUnderflow: true} =&gt; validityMessages.rangeUnderflow
        | {stepMismatch: true} =&gt; validityMessages.stepMismatch
        | {tooLong: true} =&gt; validityMessages.tooLong
        | {tooShort: true} =&gt; validityMessages.tooShort
        | {typeMismatch: true} =&gt; validityMessages.typeMismatch
        | {valueMissing: true} =&gt; validityMessages.valueMissing
        | _ =&gt; None
        }
        switch messageToSet {
        | None =&gt; ()
        | Some(messageToSet) =&gt; this[&quot;setCustomValidity&quot;](messageToSet)
        }
      | _ =&gt; ()
      }
    })

    document-&gt;addEventListener(&quot;change&quot;, (event: event) =&gt; {
      let this = event[&quot;target&quot;]
      switch this[&quot;attributes&quot;][&quot;resx-validity-message&quot;] {
      | Some(_) =&gt; this[&quot;setCustomValidity&quot;](&quot;&quot;)
      | None =&gt; ()
      }
    })
  }
)()
</code></pre>

<p>=========== End file</p><h2>res-x--handlers</h2><p>Rescript v11</p>
<p>Repo: https://github.com/zth/res-x</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;rescript-x&quot;,
  &quot;version&quot;: &quot;0.1.0-alpha.7&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;files&quot;: [
    &quot;README.md&quot;,
    &quot;CHANGELOG.md&quot;,
    &quot;rescript.json&quot;,
    &quot;src/**/*&quot;,
    &quot;res-x-vite-plugin.mjs&quot;
  ],
  &quot;author&quot;: &quot;Gabriel Nordeborn&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;peerDependencies&quot;: {
    &quot;rescript&quot;: &quot;&gt;=11.0.0-rc.5&quot;,
    &quot;@rescript/core&quot;: &quot;&gt;=0.5.0&quot;,
    &quot;vite&quot;: &quot;&gt;=4.4.11&quot;,
    &quot;rescript-bun&quot;: &quot;&gt;=0.1.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.5&quot;,
    &quot;rescript-bun&quot;: &quot;0.1.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Handlers.res</p>
<pre class="codehilite"><code>type htmxHandlerConfig&lt;'ctx&gt; = {
  request: Request.t,
  context: 'ctx,
  headers: Headers.t,
  requestController: RequestController.t,
}

type htmxHandler&lt;'ctx&gt; = htmxHandlerConfig&lt;'ctx&gt; =&gt; promise&lt;Jsx.element&gt;

type renderConfig&lt;'ctx&gt; = {
  request: Request.t,
  headers: Headers.t,
  context: 'ctx,
  path: list&lt;string&gt;,
  url: URL.t,
  requestController: RequestController.t,
}

type t&lt;'ctx&gt; = {
  handlers: array&lt;(method, string, htmxHandler&lt;'ctx&gt;)&gt;,
  requestToContext: Request.t =&gt; promise&lt;'ctx&gt;,
  asyncLocalStorage: AsyncHooks.AsyncLocalStorage.t&lt;renderConfig&lt;'ctx&gt;&gt;,
}

type hxGet = string
type hxPost = string
type hxPut = string
type hxPatch = string
type hxDelete = string

let make = (~requestToContext) =&gt; {
  handlers: [],
  requestToContext,
  asyncLocalStorage: AsyncHooks.AsyncLocalStorage.make(),
}

let useContext = t =&gt; t.asyncLocalStorage-&gt;AsyncHooks.AsyncLocalStorage.getStoreUnsafe

let defaultRenderTitle = segments =&gt; segments-&gt;Array.joinWith(&quot; | &quot;)

let renderWithDocType = async (
  el,
  ~requestController: RequestController.t,
  ~renderTitle=defaultRenderTitle,
) =&gt; {
  let (content, appendToHead) = await Promise.all2((
    H.renderToString(el),
    requestController-&gt;RequestController.getAppendedHeadContent,
  ))

  // TODO: Escape? Hyperons has something

  let appendToHead = switch (appendToHead, requestController-&gt;RequestController.getTitleSegments) {
  | (appendToHead, []) =&gt; appendToHead
  | (Some(appendToHead), titleSegments) =&gt;
    let titleElement = `&lt;title&gt;${renderTitle(titleSegments)}&lt;/title&gt;`
    Some(appendToHead ++ titleElement)
  | (None, titleSegments) =&gt; Some(`&lt;title&gt;${renderTitle(titleSegments)}&lt;/title&gt;`)
  }

  let content = switch appendToHead {
  | None =&gt; content
  | Some(appendToHead) =&gt; content-&gt;String.replace(&quot;&lt;/head&gt;&quot;, appendToHead ++ &quot;&lt;/head&gt;&quot;)
  }

  requestController-&gt;RequestController.getDocHeader ++ content
}
let defaultHeaders = [(&quot;Content-Type&quot;, &quot;text/html&quot;)]

type handleRequestConfig&lt;'ctx&gt; = {
  request: Request.t,
  server: Bun.Server.t,
  render: renderConfig&lt;'ctx&gt; =&gt; promise&lt;Jsx.element&gt;,
  setupHeaders?: unit =&gt; Headers.t,
  renderTitle?: array&lt;string&gt; =&gt; string,
  experimental_stream?: bool,
}

let handleRequest = async (t, {request, render, ?experimental_stream} as config) =&gt; {
  let stream = experimental_stream-&gt;Option.getWithDefault(false)

  let url = request-&gt;Request.url-&gt;URL.make
  let pathname = url-&gt;URL.pathname
  let targetHandler = t.handlers-&gt;Array.findMap(((handlerType, path, handler)) =&gt;
    if handlerType === request-&gt;Request.method &amp;&amp; path === pathname {
      Some(handler)
    } else {
      None
    }
  )

  let ctx = await t.requestToContext(request)
  let requestController = RequestController.make()

  let headers = switch config.setupHeaders {
  | Some(setupHeaders) =&gt; setupHeaders()
  | None =&gt; Headers.make(~init=FromArray(defaultHeaders))
  }
  let renderConfig = {
    context: ctx,
    headers,
    request,
    path: pathname
    -&gt;String.split(&quot;/&quot;)
    -&gt;Array.filter(s =&gt; s-&gt;String.trim !== &quot;&quot;)
    -&gt;List.fromArray,
    url,
    requestController,
  }

  await t.asyncLocalStorage-&gt;AsyncHooks.AsyncLocalStorage.run(renderConfig, async _token =&gt; {
    let content = switch targetHandler {
    | None =&gt; await render(renderConfig)
    | Some(handler) =&gt;
      await handler({
        request,
        context: ctx,
        headers,
        requestController,
      })
    }

    if stream {
      let {readable, writable} = TransformStream.make({
        transform: (chunk, controller) =&gt; {
          controller-&gt;TransformStream.Controller.enqueue(chunk)
        },
      })
      let writer = writable-&gt;WritableStream.getWriter
      let textEncoder = TextEncoder.make()

      H.renderToStream(content, ~onChunk=chunk =&gt; {
        let encoded = textEncoder-&gt;TextEncoder.encode(chunk)
        writer-&gt;WritableStream.WritableStreamDefaultWriter.write(encoded)-&gt;Promise.done
      })
      -&gt;Promise.thenResolve(_ =&gt; {
        writer-&gt;WritableStream.WritableStreamDefaultWriter.close
      })
      -&gt;Promise.done

      Response.makeFromReadableStream(
        readable,
        ~options={
          status: 200,
          headers: FromArray([(&quot;Content-Type&quot;, &quot;text/html&quot;)]),
        },
      )
    } else {
      let content = await renderWithDocType(
        content,
        ~requestController,
        ~renderTitle=?config.renderTitle,
      )
      switch (
        requestController-&gt;RequestController.getCurrentRedirect,
        requestController-&gt;RequestController.getCurrentStatus,
      ) {
      | (Some(url, status), _) =&gt; Response.makeRedirect(url, ~status?)
      | (None, status) =&gt; Response.makeWithHeaders(content, ~options={headers, status})
      }
    }
  })
}

let hxGet = (t, path, ~handler) =&gt; {
  t.handlers-&gt;Array.push((GET, path, handler))
  path
}
let makeHxGetIdentifier = path =&gt; {
  path
}
let implementHxGetIdentifier = (t, path, ~handler) =&gt; {
  let _: hxGet = hxGet(t, path, ~handler)
}

let hxPost = (t, path, ~handler) =&gt; {
  t.handlers-&gt;Array.push((POST, path, handler))
  path
}
let makeHxPostIdentifier = path =&gt; {
  path
}
let implementHxPostIdentifier = (t, path, ~handler) =&gt; {
  let _: hxPost = hxPost(t, path, ~handler)
}

let hxPut = (t, path, ~handler) =&gt; {
  t.handlers-&gt;Array.push((PUT, path, handler))
  path
}
let makeHxPutIdentifier = path =&gt; {
  path
}
let implementHxPutIdentifier = (t, path, ~handler) =&gt; {
  let _: hxPut = hxPut(t, path, ~handler)
}

let hxDelete = (t, path, ~handler) =&gt; {
  t.handlers-&gt;Array.push((DELETE, path, handler))
  path
}
let makeHxDeleteIdentifier = path =&gt; {
  path
}
let implementHxDeleteIdentifier = (t, path, ~handler) =&gt; {
  let _: hxDelete = hxDelete(t, path, ~handler)
}

let hxPatch = (t, path, ~handler) =&gt; {
  t.handlers-&gt;Array.push((PATCH, path, handler))
  path
}
let makeHxPatchIdentifier = path =&gt; {
  path
}
let implementHxPatchIdentifier = (t, path, ~handler) =&gt; {
  let _: hxPatch = hxPatch(t, path, ~handler)
}

module Internal = {
  let getHandlers = t =&gt; t.handlers
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Handlers.resi</p>
<pre class="codehilite"><code>type htmxHandlerConfig&lt;'ctx&gt; = {
  request: Request.t,
  context: 'ctx,
  headers: Headers.t,
  requestController: RequestController.t,
}

type htmxHandler&lt;'ctx&gt; = htmxHandlerConfig&lt;'ctx&gt; =&gt; promise&lt;Jsx.element&gt;

type t&lt;'ctx&gt;

type hxGet
type hxPost
type hxPut
type hxPatch
type hxDelete

let make: (~requestToContext: Request.t =&gt; promise&lt;'ctx&gt;) =&gt; t&lt;'ctx&gt;

let hxGet: (t&lt;'ctx&gt;, string, ~handler: htmxHandler&lt;'ctx&gt;) =&gt; hxGet
let makeHxGetIdentifier: string =&gt; hxGet
let implementHxGetIdentifier: (t&lt;'ctx&gt;, hxGet, ~handler: htmxHandler&lt;'ctx&gt;) =&gt; unit

let hxPost: (t&lt;'ctx&gt;, string, ~handler: htmxHandler&lt;'ctx&gt;) =&gt; hxPost
let makeHxPostIdentifier: string =&gt; hxPost
let implementHxPostIdentifier: (t&lt;'ctx&gt;, hxPost, ~handler: htmxHandler&lt;'ctx&gt;) =&gt; unit

let hxPut: (t&lt;'ctx&gt;, string, ~handler: htmxHandler&lt;'ctx&gt;) =&gt; hxPut
let makeHxPutIdentifier: string =&gt; hxPut
let implementHxPutIdentifier: (t&lt;'ctx&gt;, hxPut, ~handler: htmxHandler&lt;'ctx&gt;) =&gt; unit

let hxDelete: (t&lt;'ctx&gt;, string, ~handler: htmxHandler&lt;'ctx&gt;) =&gt; hxDelete
let makeHxDeleteIdentifier: string =&gt; hxDelete
let implementHxDeleteIdentifier: (t&lt;'ctx&gt;, hxDelete, ~handler: htmxHandler&lt;'ctx&gt;) =&gt; unit

let hxPatch: (t&lt;'ctx&gt;, string, ~handler: htmxHandler&lt;'ctx&gt;) =&gt; hxPatch
let makeHxPatchIdentifier: string =&gt; hxPatch
let implementHxPatchIdentifier: (t&lt;'ctx&gt;, hxPatch, ~handler: htmxHandler&lt;'ctx&gt;) =&gt; unit

type renderConfig&lt;'ctx&gt; = {
  request: Request.t,
  headers: Headers.t,
  context: 'ctx,
  path: list&lt;string&gt;,
  url: URL.t,
  requestController: RequestController.t,
}

let useContext: t&lt;'ctx&gt; =&gt; renderConfig&lt;'ctx&gt;

type handleRequestConfig&lt;'ctx&gt; = {
  request: Request.t,
  server: Bun.Server.t,
  render: renderConfig&lt;'ctx&gt; =&gt; promise&lt;Jsx.element&gt;,
  setupHeaders?: unit =&gt; Headers.t,
  renderTitle?: array&lt;string&gt; =&gt; string,
  experimental_stream?: bool,
}

let handleRequest: (t&lt;'ctx&gt;, handleRequestConfig&lt;'ctx&gt;) =&gt; promise&lt;Response.t&gt;

module Internal: {
  let getHandlers: t&lt;'ctx&gt; =&gt; array&lt;(method, string, htmxHandler&lt;'ctx&gt;)&gt;
}
</code></pre>

<p>=========== End file</p><h2>brightid--buttonssponsor</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Buttons_Sponsor.res</p>
<pre class="codehilite"><code>open Discord
open Shared
open NodeFetch
open Exceptions

let {brightIdAppDeeplink, brightIdLinkVerificationEndpoint} = module(Endpoints)

let {makeCanvasFromUri, createMessageAttachmentFromCanvas, makeBeforeSponsorActionRow} = module(
  Commands_Verify
)

@val @scope(&quot;globalThis&quot;)
external fetch: (string, 'params) =&gt; promise&lt;Response.t&lt;JSON.t&gt;&gt; = &quot;fetch&quot;

let sleep: int =&gt; promise&lt;unit&gt; = _ms =&gt; %raw(` new Promise((resolve) =&gt; setTimeout(resolve, _ms))`)

Env.createEnv()

let envConfig = switch Env.getConfig() {
| Ok(config) =&gt; config
| Error(err) =&gt; err-&gt;Env.EnvError-&gt;raise
}

let sponsorRequestSubmittedMessageOptions = async () =&gt; {
  let nowInSeconds = Math.round(Date.now() /. 1000.)
  let fifteenMinutesAfter = 15. *. 60. +. nowInSeconds
  let content = `You sponsor request has been submitted! \n\n Make sure you have scanned the QR code above in the BrightID mobile app to confirm your sponsor and link Discord to BrightID. \n This process will timeout &lt;t:${fifteenMinutesAfter-&gt;Float.toString}:R&gt;.\n\nPlease be patient as the BrightID nodes sync your request \n`
  {
    &quot;content&quot;: content,
    &quot;ephemeral&quot;: true,
  }
}

let noWriteToGistMessage = async interaction =&gt; {
  let options = {
    &quot;content&quot;: &quot;It seems like I can't write to my database at the moment. Please try again or contact the BrightID support.&quot;,
    &quot;ephemeral&quot;: true,
  }

  await Interaction.followUp(interaction, ~options, ())
}

let makeAfterSponsorActionRow = label =&gt; {
  let verifyButton =
    MessageButton.make()
    -&gt;MessageButton.setCustomId(&quot;verify&quot;)
    -&gt;MessageButton.setLabel(label)
    -&gt;MessageButton.setStyle(&quot;PRIMARY&quot;)

  MessageActionRow.make()-&gt;MessageActionRow.addComponents([verifyButton])
}

type sponsorship = Sponsorship(BrightId.Sponsorships.t)
let checkSponsor = async uuid =&gt; {
  open Shared.Decode
  let endpoint = `https://app.brightid.org/node/v5/sponsorships/${uuid}`
  let params = {
    &quot;method&quot;: &quot;GET&quot;,
    &quot;headers&quot;: {
      &quot;Accept&quot;: &quot;application/json&quot;,
      &quot;Content-Type&quot;: &quot;application/json&quot;,
    },
    &quot;timeout&quot;: 60000,
  }
  let res = await fetch(endpoint, params)
  let json = await Response.json(res)

  switch (
    json-&gt;Json.decode(Decode_BrightId.Sponsorships.data),
    json-&gt;Json.decode(Decode_BrightId.Error.data),
  ) {
  | (Ok({data}), _) =&gt; Sponsorship(data)
  | (_, Ok(error)) =&gt; error-&gt;Exceptions.BrightIdError-&gt;raise
  | (Error(err), _) =&gt; err-&gt;Json.Decode.DecodeError-&gt;raise
  }
}

let gistConfig = () =&gt;
  Utils.Gist.makeGistConfig(
    ~id=envConfig[&quot;gistId&quot;],
    ~name=&quot;guildData.json&quot;,
    ~token=envConfig[&quot;githubAccessToken&quot;],
  )

let execute = async interaction =&gt; {
  open Utils
  open Shared.Decode
  let guild = interaction-&gt;Interaction.getGuild
  let guildId = guild-&gt;Guild.getGuildId
  let member = interaction-&gt;Interaction.getGuildMember
  let memberId = member-&gt;GuildMember.getGuildMemberId
  let uuid = memberId-&gt;UUID.v5(envConfig[&quot;uuidNamespace&quot;])
  switch await Interaction.deferReply(interaction, ~options={&quot;ephemeral&quot;: true}, ()) {
  | exception e =&gt; e-&gt;raise
  | _ =&gt;
    switch await Gist.ReadGist.content(~config=gistConfig(), ~decoder=Decode_Gist.brightIdGuilds) {
    | exception e =&gt; e-&gt;raise
    | guilds =&gt;
      switch guilds-&gt;Dict.get(guildId) {
      | None =&gt;
        let _ = await noWriteToGistMessage(interaction)
        SponsorButtonError(
          `Buttons_Sponsor: Guild with guildId: ${guildId} not found in gist`,
        )-&gt;raise
      | Some(guildData) =&gt;
        open Services_Sponsor
        let _ = switch await handleSponsor(interaction, uuid, Helpers.fifteenMinutesFromNow()) {
        | exception e =&gt; e-&gt;raise
        | SponsorshipUsed =&gt;
          let usedSponsorships =
            guildData.usedSponsorships-&gt;Option.getWithDefault(
              Ethers.BigNumber.zero-&gt;Ethers.BigNumber.toString,
            )
          let usedSponsorships =
            usedSponsorships
            -&gt;Ethers.BigNumber.fromString
            -&gt;Ethers.BigNumber.addWithString(&quot;1&quot;)
            -&gt;Ethers.BigNumber.toString

          let updateUsedSponsorships = await Utils.Gist.UpdateGist.updateEntry(
            ~config=gistConfig(),
            ~content=guilds,
            ~key=guildId,
            ~entry={...guildData, usedSponsorships: Some(usedSponsorships)},
          )
          switch updateUsedSponsorships {
          | Ok(_) =&gt;
            let options = await successfulSponsorMessageOptions(uuid)
            let _ = await Interaction.followUp(interaction, ~options, ())
          | Error(err) =&gt;
            Console.error2(&quot;Buttons Sponsor: Error updating used sponsorships&quot;, err)
            let _ = await noWriteToGistMessage(interaction)
          }

        | NoUnusedSponsorships =&gt;
          let _ = await Interaction.followUp(
            interaction,
            ~options=noUnusedSponsorshipsOptions(),
            (),
          )

        | RetriedCommandDuring =&gt;
          let options = {
            &quot;content&quot;: &quot;Your request is still processing. Maybe you haven't scanned the QR code yet?\n\n If you have already scanned the code, please wait a few minutes for BrightID nodes to sync your sponsorship request&quot;,
            &quot;ephemeral&quot;: true,
          }
          let _ = await Interaction.followUp(interaction, ~options, ())
        | TimedOut =&gt;
          let options = await unsuccessfulSponsorMessageOptions(uuid)
          let _ = await Interaction.editReply(interaction, ~options, ())
        }
      }
    }
  }
}

let customId = &quot;before-sponsor&quot;
</code></pre>

<p>=========== End file</p><h2>res-x--react</h2><p>Rescript v11</p>
<p>Repo: https://github.com/zth/res-x</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;rescript-x&quot;,
  &quot;version&quot;: &quot;0.1.0-alpha.7&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;files&quot;: [
    &quot;README.md&quot;,
    &quot;CHANGELOG.md&quot;,
    &quot;rescript.json&quot;,
    &quot;src/**/*&quot;,
    &quot;res-x-vite-plugin.mjs&quot;
  ],
  &quot;author&quot;: &quot;Gabriel Nordeborn&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;peerDependencies&quot;: {
    &quot;rescript&quot;: &quot;&gt;=11.0.0-rc.5&quot;,
    &quot;@rescript/core&quot;: &quot;&gt;=0.5.0&quot;,
    &quot;vite&quot;: &quot;&gt;=4.4.11&quot;,
    &quot;rescript-bun&quot;: &quot;&gt;=0.1.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.5&quot;,
    &quot;rescript-bun&quot;: &quot;0.1.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file ResX__React.res</p>
<pre class="codehilite"><code>type element = Jsx.element

type component&lt;'props&gt; = Jsx.component&lt;'props&gt;
type componentLike&lt;'props, 'return&gt; = Jsx.componentLike&lt;'props, 'return&gt;

type fragmentProps = {children?: element}

@module(&quot;./vendor/hyperons.js&quot;) external jsxFragment: component&lt;fragmentProps&gt; = &quot;Fragment&quot;

@module(&quot;./vendor/hyperons.js&quot;)
external jsx: (component&lt;'props&gt;, 'props) =&gt; Jsx.element = &quot;h&quot;

@module(&quot;./vendor/hyperons.js&quot;)
external jsxs: (component&lt;'props&gt;, 'props) =&gt; element = &quot;h&quot;

@val external null: Jsx.element = &quot;null&quot;

external float: float =&gt; Jsx.element = &quot;%identity&quot;
external int: int =&gt; Jsx.element = &quot;%identity&quot;
external string: string =&gt; Jsx.element = &quot;%identity&quot;
external array: array&lt;Jsx.element&gt; =&gt; Jsx.element = &quot;%identity&quot;
</code></pre>

<p>=========== End file</p><h2>catala-dsfr--app</h2><p>Rescript v10</p>
<p>Repo: https://github.com/CatalaLang/catala-dsfr</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;catala-dsfr&quot;,
  &quot;version&quot;: &quot;0.1.1&quot;,
  &quot;repository&quot;: &quot;https://github.com/CatalaLang/catala-dsfr&quot;,
  &quot;scripts&quot;: {
    &quot;clean&quot;: &quot;rescript clean -with-deps&quot;,
    &quot;build&quot;: &quot;yarn run pre &amp;&amp; vite build&quot;,
    &quot;deploy&quot;: &quot;yarn run build --base=/demos/catala/ &amp;&amp; rsync -rv --delete-before dist/*&quot;,
    &quot;serve&quot;: &quot;vite preview&quot;,
    &quot;dev&quot;: &quot;yarn run pre &amp;&amp; vite&quot;,
    &quot;re:build&quot;: &quot;rescript build -with-deps&quot;,
    &quot;re:watch&quot;: &quot;yarn run pre &amp;&amp; rescript build -w -with-deps&quot;,
    &quot;assets&quot;: &quot;rsync -r node_modules/@catala-lang/catala-web-assets/assets/* assets&quot;,
    &quot;postinstall&quot;: &quot;copy-dsfr-to-public&quot;,
    &quot;pre&quot;: &quot;yarn run re:build &amp;&amp; only-include-used-icons &amp;&amp; yarn run assets&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;author&quot;: &quot;Emile Rolley &lt;emile.rolley@tuta.io&gt;&quot;,
  &quot;license&quot;: &quot;Apache-2.0&quot;,
  &quot;dependencies&quot;: {
    &quot;@catala-lang/catala-explain&quot;: &quot;^0.2.2&quot;,
    &quot;@catala-lang/catala-web-assets&quot;: &quot;^0.8.9&quot;,
    &quot;@catala-lang/french-law&quot;: &quot;^0.8.3-b.3&quot;,
    &quot;@catala-lang/rescript-catala&quot;: &quot;^0.8.1-b.0&quot;,
    &quot;@codegouvfr/react-dsfr&quot;: &quot;^0.78.2&quot;,
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;@rescript/react&quot;: &quot;^0.11.0&quot;,
    &quot;@rjsf/core&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/utils&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/validator-ajv8&quot;: &quot;^5.1.0&quot;,
    &quot;file-saver&quot;: &quot;^2.0.5&quot;,
    &quot;react&quot;: &quot;^18.2.0&quot;,
    &quot;react-dom&quot;: &quot;^18.2.0&quot;,
    &quot;react-loader-spinner&quot;: &quot;^5.4.5&quot;,
    &quot;rescript-docx&quot;: &quot;^0.1.5&quot;,
    &quot;tslib&quot;: &quot;^2.6.2&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@jihchi/vite-plugin-rescript&quot;: &quot;^5.1.0&quot;,
    &quot;@originjs/vite-plugin-commonjs&quot;: &quot;^1.0.3&quot;,
    &quot;@vitejs/plugin-react&quot;: &quot;^3.1.0&quot;,
    &quot;jsdom&quot;: &quot;^21.1.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.4&quot;,
    &quot;tailwindcss&quot;: &quot;^3.2.6&quot;,
    &quot;vite&quot;: &quot;^4.4.9&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file App.res</p>
<pre class="codehilite"><code>%%raw(`import &quot;./css/index.css&quot;;`)

Dsfr.Spa.startReactDsfr({
  defaultColorScheme: #system,
  link: Router.Link.make,
  useLang: () =&gt; #fr,
})

module App = {
  @react.component
  let make = () =&gt; {
    &lt;&gt;
      &lt;Header /&gt;
      &lt;main role=&quot;main&quot; className=&quot;fr-h-10w fr-p-2w&quot;&gt;
        &lt;Router /&gt;
      &lt;/main&gt;
      &lt;Footer /&gt;
    &lt;/&gt;
  }
}

ReactDOM.Client.createRoot(
  ReactDOM.querySelector(&quot;#app-root&quot;)-&gt;Belt.Option.getExn,
)-&gt;ReactDOM.Client.Root.render(
  &lt;React.StrictMode&gt;
    &lt;App /&gt;
  &lt;/React.StrictMode&gt;,
)
</code></pre>

<p>=========== End file</p><h2>brightid--servicessponsor</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Services_Sponsor.res</p>
<pre class="codehilite"><code>open Discord
open NodeFetch

let {brightIdVerificationEndpoint, brightIdAppDeeplink, brightIdLinkVerificationEndpoint} = module(
  Endpoints
)

let {makeCanvasFromUri, createMessageAttachmentFromCanvas, makeBeforeSponsorActionRow} = module(
  Commands_Verify
)

@val @scope(&quot;globalThis&quot;)
external fetch: (string, 'params) =&gt; promise&lt;Response.t&lt;JSON.t&gt;&gt; = &quot;fetch&quot;

let sleep: int =&gt; promise&lt;unit&gt; = _ms =&gt; %raw(` new Promise((resolve) =&gt; setTimeout(resolve, _ms))`)

Env.createEnv()

let envConfig = switch Env.getConfig() {
| Ok(config) =&gt; config
| Error(err) =&gt; err-&gt;Env.EnvError-&gt;raise
}

exception RetryAsync(string)
let rec retry = async (fn, n) =&gt; {
  try {
    let _ = await sleep(1000)
    await fn()
  } catch {
  | _ =&gt;
    if n &gt; 0 {
      await retry(fn, n - 1)
    }
  }
  RetryAsync(j`Failed $fn retrying $n times`)-&gt;raise
}

let noUnusedSponsorshipsOptions = () =&gt;
  {
    &quot;content&quot;: &quot;There are no sponsorhips available in the Discord pool. Please try again later.&quot;,
    &quot;ephemeral&quot;: true,
  }

let unsuccessfulSponsorMessageOptions = async uuid =&gt; {
  let verifyUrl = `${brightIdLinkVerificationEndpoint}/${uuid}`
  let row = makeBeforeSponsorActionRow(&quot;Retry Sponsor&quot;, verifyUrl)
  {
    &quot;content&quot;: &quot;Your sponsor request failed. \n\n This is often due to the BrightID App not being linked to Discord. Please scan the previous QR code in the BrightID mobile app then retry your sponsorship request.\n\n&quot;,
    &quot;ephemeral&quot;: true,
    &quot;components&quot;: [row],
  }
}
let sponsorRequestSubmittedMessageOptions = async () =&gt; {
  let nowInSeconds = Math.round(Date.now() /. 1000.)
  let fifteenMinutesAfter = 15. *. 60. +. nowInSeconds
  let content = `You sponsor request has been submitted! \n\n Make sure you have scanned this QR code in the BrightID mobile app to confirm your sponsor and link Discord to BrightID. \n This process will timeout &lt;t:${fifteenMinutesAfter-&gt;Float.toString}:R&gt;.\n\n`
  {
    &quot;content&quot;: content,
    &quot;ephemeral&quot;: true,
  }
}

let makeAfterSponsorActionRow = label =&gt; {
  let verifyButton =
    MessageButton.make()
    -&gt;MessageButton.setCustomId(&quot;verify&quot;)
    -&gt;MessageButton.setLabel(label)
    -&gt;MessageButton.setStyle(&quot;PRIMARY&quot;)

  MessageActionRow.make()-&gt;MessageActionRow.addComponents([verifyButton])
}

let successfulSponsorMessageOptions = async uuid =&gt; {
  let uri = `${brightIdAppDeeplink}/${uuid}`
  let canvas = await makeCanvasFromUri(uri)
  let attachment = await createMessageAttachmentFromCanvas(canvas)
  let row = makeAfterSponsorActionRow(&quot;Assign BrightID Verified Role&quot;)
  {
    &quot;content&quot;: &quot;You have succesfully been sponsored \n\n If you are verified in BrightID you are all done. Click the button below to assign your role.\n\n&quot;,
    &quot;files&quot;: [attachment],
    &quot;ephemeral&quot;: true,
    &quot;components&quot;: [row],
  }
}

exception HandleSponsorError(string)
type sponsor = SponsorSuccess(Shared.BrightId.Sponsorships.sponsor)
type handleSponsor =
  | SponsorshipUsed
  | RetriedCommandDuring
  | NoUnusedSponsorships
  | TimedOut

type sponsorship = Sponsorship(Shared.BrightId.Sponsorships.t)
let checkSponsor = async uuid =&gt; {
  open Shared.Decode
  let endpoint = `https://app.brightid.org/node/v5/sponsorships/${uuid}`
  let params = {
    &quot;method&quot;: &quot;GET&quot;,
    &quot;headers&quot;: {
      &quot;Accept&quot;: &quot;application/json&quot;,
      &quot;Content-Type&quot;: &quot;application/json&quot;,
    },
    &quot;timeout&quot;: 60000,
  }
  let res = await fetch(endpoint, params)
  let json = await Response.json(res)

  switch (
    json-&gt;Json.decode(Decode_BrightId.Sponsorships.data),
    json-&gt;Json.decode(Decode_BrightId.Error.data),
  ) {
  | (Ok({data}), _) =&gt; Sponsorship(data)
  | (_, Ok(error)) =&gt; error-&gt;Exceptions.BrightIdError-&gt;raise
  | (Error(err), _) =&gt; err-&gt;Json.Decode.DecodeError-&gt;raise
  }
}

@raises([HandleSponsorError, Exn.Error, Json.Decode.DecodeError])
let rec handleSponsor = async (
  ~maybeHash=None,
  ~maybeLogMessage=None,
  interaction,
  uuid,
  endTimeInSeconds,
) =&gt; {
  open Shared.BrightId
  open Shared.Decode

  let guildId = interaction-&gt;Interaction.getGuild-&gt;Guild.getGuildId
  let secondsBetweenAttempts = 15 //Probably won't need this if whe are using our own node
  // 10 second buffer for Webhook expiry
  let hasWebhookExpired = endTimeInSeconds - Helpers.nowInSeconds() &lt; 10
  switch hasWebhookExpired {
  | true =&gt;
    if maybeLogMessage-&gt;Option.isSome {
      let _ = await CustomMessages.editSponsorshipMessage(
        maybeLogMessage-&gt;Option.getExn,
        interaction,
        CustomMessages.Status.Failed,
        uuid,
        maybeHash,
      )
    }
    TimedOut
  | _ =&gt;
    try {
      let json = await sponsor(
        ~key=envConfig[&quot;sponsorshipKey&quot;],
        ~context=&quot;Discord&quot;,
        ~contextId=uuid,
      )
      switch json-&gt;Json.decode(Decode_BrightId.Sponsorships.sponsor) {
      | Ok({hash}) =&gt;
        let options = await sponsorRequestSubmittedMessageOptions()
        let _ = await Interaction.editReply(interaction, ~options, ())
        Console.log2(
          `A sponsor request has been submitted`,
          {&quot;guild&quot;: guildId, &quot;contextId&quot;: uuid, &quot;hash&quot;: hash},
        )
        let maybeLogMessage = await CustomMessages.sponsorshipRequested(
          interaction,
          uuid,
          Some(hash),
        )
        await handleSponsor(
          interaction,
          uuid,
          ~maybeHash=Some(hash),
          ~maybeLogMessage,
          endTimeInSeconds,
        )
      | Error(err) =&gt; Json.Decode.DecodeError(err)-&gt;raise
      }
    } catch {
    | Exn.Error(error) =&gt;
      try {
        let brightIdError =
          JSON.stringifyAny(error)
          -&gt;Option.map(JSON.parseExn)
          -&gt;Option.map(Json.decode(_, Decode_BrightId.Error.data))

        switch brightIdError {
        | None =&gt;
          HandleSponsorError(
            &quot;Handle Sponsor Error: There was a problem JSON parsing the error from sponsor()&quot;,
          )-&gt;raise
        | Some(Error(err)) =&gt; err-&gt;Json.Decode.DecodeError-&gt;raise
        | Some(Ok({errorNum})) =&gt;
          switch (errorNum, maybeHash) {
          //No Sponsorships in the Discord App
          | (38, _) =&gt;
            if maybeLogMessage-&gt;Option.isSome {
              let _ = await CustomMessages.editSponsorshipMessage(
                maybeLogMessage-&gt;Option.getExn,
                interaction,
                CustomMessages.Status.Error(
                  &quot;No Sponsorships available in the BrightID Discord App&quot;,
                ),
                uuid,
                maybeHash,
              )
            }
            NoUnusedSponsorships
          //Sponsorship already assigned
          | (_, None) =&gt; RetriedCommandDuring
          | (39, Some(hash)) =&gt;
            let Sponsorship({spendRequested, appHasAuthorized}) = await checkSponsor(uuid)
            if spendRequested &amp;&amp; appHasAuthorized {
              if maybeLogMessage-&gt;Option.isSome {
                let _ =
                  maybeLogMessage-&gt;Option.map(async logMessage =&gt;
                    await CustomMessages.editSponsorshipMessage(
                      logMessage,
                      interaction,
                      CustomMessages.Status.Successful,
                      uuid,
                      Some(hash),
                    )
                  )
              }
              let options = successfulSponsorMessageOptions(uuid)
              let _ = await Interaction.editReply(interaction, ~options, ())
              SponsorshipUsed
            } else {
              let _ = await sleep(secondsBetweenAttempts * 1000)
              await handleSponsor(~maybeHash, ~maybeLogMessage, interaction, uuid, endTimeInSeconds)
            }
          //App authorized before
          | (45, Some(hash)) =&gt;
            let Sponsorship({spendRequested, appHasAuthorized}) = await checkSponsor(uuid)
            if spendRequested &amp;&amp; appHasAuthorized {
              if maybeLogMessage-&gt;Option.isSome {
                let _ = await CustomMessages.editSponsorshipMessage(
                  maybeLogMessage-&gt;Option.getExn,
                  interaction,
                  CustomMessages.Status.Successful,
                  uuid,
                  Some(hash),
                )
              }
              let options = successfulSponsorMessageOptions(uuid)
              let _ = {await Interaction.editReply(interaction, ~options, ())}
              SponsorshipUsed
            } else {
              let _ = await sleep(secondsBetweenAttempts * 1000)
              await handleSponsor(~maybeHash, ~maybeLogMessage, interaction, uuid, endTimeInSeconds)
            }

          // Spend Request Submitted
          | (46, Some(hash)) =&gt;
            let Sponsorship({spendRequested, appHasAuthorized}) = await checkSponsor(uuid)
            if spendRequested &amp;&amp; appHasAuthorized {
              if maybeLogMessage-&gt;Option.isSome {
                let _ = await CustomMessages.editSponsorshipMessage(
                  maybeLogMessage-&gt;Option.getExn,
                  interaction,
                  CustomMessages.Status.Successful,
                  uuid,
                  Some(hash),
                )
              }
              let options = await successfulSponsorMessageOptions(uuid)
              let _ = await interaction-&gt;Interaction.editReply(~options, ())
              SponsorshipUsed
            } else {
              let _ = await sleep(secondsBetweenAttempts * 1000)
              await handleSponsor(~maybeHash, ~maybeLogMessage, interaction, uuid, endTimeInSeconds)
            }

          // Sponsored Request Recently
          | (47, Some(_)) =&gt;
            let Sponsorship({spendRequested, appHasAuthorized}) = await checkSponsor(uuid)
            if spendRequested &amp;&amp; appHasAuthorized {
              if maybeLogMessage-&gt;Option.isSome {
                let _ = await CustomMessages.editSponsorshipMessage(
                  maybeLogMessage-&gt;Option.getExn,
                  interaction,
                  CustomMessages.Status.Successful,
                  uuid,
                  maybeHash,
                )
              }
              let options = successfulSponsorMessageOptions(uuid)
              let _ = await Interaction.editReply(interaction, ~options, ())
              SponsorshipUsed
            } else {
              let _ = await sleep(secondsBetweenAttempts * 1000)
              await handleSponsor(~maybeHash, ~maybeLogMessage, interaction, uuid, endTimeInSeconds)
            }

          | _ =&gt;
            let _ = await sleep(secondsBetweenAttempts * 1000)
            await handleSponsor(~maybeHash, ~maybeLogMessage, interaction, uuid, endTimeInSeconds)
          }
        }
      } catch {
      | Exceptions.BrightIdError(_) =&gt;
        let _ = await sleep(secondsBetweenAttempts * 1000)
        await handleSponsor(interaction, uuid, ~maybeHash, ~maybeLogMessage, endTimeInSeconds)
      | Json.Decode.DecodeError(msg) =&gt;
        if msg-&gt;String.includes(&quot;503 Service Temporarily Unavailable&quot;) {
          let _ = await sleep(secondsBetweenAttempts * 1000)
          await handleSponsor(~maybeHash, ~maybeLogMessage, interaction, uuid, endTimeInSeconds)
        } else {
          HandleSponsorError(msg)-&gt;raise
        }
      | Exn.Error(obj) =&gt;
        switch Exn.name(obj) {
        | Some(&quot;FetchError&quot;) =&gt;
          let _ = await sleep(3000)
          await handleSponsor(~maybeHash, ~maybeLogMessage, interaction, uuid, endTimeInSeconds)
        | _ =&gt;
          switch Exn.message(obj) {
          | Some(msg) =&gt;
            if maybeLogMessage-&gt;Option.isSome {
              let _ = await CustomMessages.editSponsorshipMessage(
                maybeLogMessage-&gt;Option.getExn,
                interaction,
                CustomMessages.Status.Error(msg),
                uuid,
                maybeHash,
              )
            }
            HandleSponsorError(msg)-&gt;raise
          | None =&gt;
            Console.error(obj)
            if maybeLogMessage-&gt;Option.isSome {
              let _ = await CustomMessages.editSponsorshipMessage(
                maybeLogMessage-&gt;Option.getExn,
                interaction,
                CustomMessages.Status.Error(&quot;Something went wrong&quot;),
                uuid,
                maybeHash,
              )
            }
            HandleSponsorError(&quot;Handle Sponsor: Unknown Error&quot;)-&gt;raise
          }
        }
      }
    }
  }
}
</code></pre>

<p>=========== End file</p><h2>brightid--commandsinvite</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Commands_Invite.res</p>
<pre class="codehilite"><code>open Discord
open Promise
open Exceptions

@module(&quot;../updateOrReadGist.mjs&quot;)
external updateGist: (string, 'a) =&gt; promise&lt;unit&gt; = &quot;updateGist&quot;

let urlRe = %re(
  &quot;/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/&quot;
)

let execute = (interaction: Interaction.t) =&gt; {
  let guild = interaction-&gt;Interaction.getGuild
  let member = interaction-&gt;Interaction.getGuildMember
  let isAdmin = member-&gt;GuildMember.getPermissions-&gt;Permissions.has(Permissions.Flags.administrator)
  let commandOptions = interaction-&gt;Interaction.getOptions
  interaction
  -&gt;Interaction.deferReply(~options={&quot;ephemeral&quot;: true}, ())
  -&gt;then(_ =&gt; {
    switch isAdmin {
    | false =&gt;
      interaction
      -&gt;Interaction.editReply(
        ~options={&quot;content&quot;: &quot;Only administrators can change the invite link&quot;},
        (),
      )
      -&gt;ignore
      InviteCommandError(&quot;Commands_Invite: User does not have Administrator permissions&quot;)-&gt;raise
    | true =&gt; {
        let inviteLink = commandOptions-&gt;CommandInteractionOptionResolver.getString(&quot;invite&quot;)
        switch inviteLink-&gt;Nullable.toOption {
        | None =&gt;
          interaction
          -&gt;Interaction.editReply(
            ~options={&quot;content&quot;: &quot;I didn't receive an invite link. (For some unexplained reason)&quot;},
            (),
          )
          -&gt;ignore
          InviteCommandError(&quot;Commands_Invite: Invite Link returned null or undefined&quot;)-&gt;reject
        | Some(inviteLink) =&gt;
          switch urlRe-&gt;RegExp.test(inviteLink) {
          | false =&gt; {
              interaction
              -&gt;Interaction.editReply(
                ~options={&quot;content&quot;: &quot;The invite link is not a valid URL&quot;},
                (),
              )
              -&gt;ignore
              InviteCommandError(&quot;Commands_Invite: Invite Link is not a valid URL&quot;)-&gt;reject
            }

          | true =&gt; {
              updateGist(
                guild-&gt;Guild.getGuildId,
                {
                  &quot;inviteLink&quot;: inviteLink,
                },
              )-&gt;ignore

              interaction
              -&gt;Interaction.editReply(
                ~options={
                  &quot;content&quot;: `Successfully update server invite link to ${inviteLink}`,
                  &quot;ephemeral&quot;: true,
                },
                (),
              )
              -&gt;ignore
              resolve()
            }
          }
        }
      }
    }-&gt;catch(e =&gt; {
      switch e {
      | InviteCommandError(msg) =&gt; Console.error(msg)
      | Exn.Error(obj) =&gt;
        switch Exn.message(obj) {
        | Some(msg) =&gt; Console.error(msg)
        | None =&gt; Console.error(&quot;Must be some non-error value&quot;)
        }
      | _ =&gt; Console.error(&quot;Some unknown error&quot;)
      }
      resolve()
    })
  })
}

let data =
  SlashCommandBuilder.make()
  -&gt;SlashCommandBuilder.setName(&quot;invite&quot;)
  -&gt;SlashCommandBuilder.setDescription(&quot;Add an invite link to be displayed for this server&quot;)
  -&gt;SlashCommandBuilder.addStringOption(option =&gt; {
    open SlashCommandStringOption
    option
    -&gt;setName(&quot;invite&quot;)
    -&gt;setDescription(&quot;Enter an invite link to this server&quot;)
    -&gt;setRequired(true)
  })
</code></pre>

<p>=========== End file</p><h2>brightid--entryclient</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file entry.client.res</p>
<pre class="codehilite"><code>@val external document: Dom.element = &quot;document&quot;

module ReactDOM = {
  @module(&quot;react-dom/client&quot;)
  external hydrateRoot: (Dom.element, React.element) =&gt; unit = &quot;hydrateRoot&quot;
}

@module(&quot;react&quot;) external startTransition: (unit =&gt; unit) =&gt; unit = &quot;startTransition&quot;

let hydrate = () =&gt;
  startTransition(() =&gt; {
    ReactDOM.hydrateRoot(
      document,
      &lt;React.StrictMode&gt;
        &lt;Remix.RemixBrowser /&gt;
      &lt;/React.StrictMode&gt;,
    )
  })

%%raw(`
if (window.requestIdleCallback) {
    window.requestIdleCallback(hydrate);
 }else {
  // Safari doesn't support requestIdleCallback
  // https://caniuse.com/requestidlecallback
  window.setTimeout(hydrate, 1);
  }`)
</code></pre>

<p>=========== End file</p><h2>chat-script--app</h2><p>Rescript v11</p>
<p>Repo: https://github.com/Exegetech/chat-rescript</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;frontend&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;,
    &quot;dev&quot;: &quot;vite&quot;,
    &quot;build&quot;: &quot;vite build&quot;,
    &quot;preview&quot;: &quot;vite preview&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;0.5.0&quot;,
    &quot;@rescript/react&quot;: &quot;0.11.0&quot;,
    &quot;shared&quot;: &quot;workspace:*&quot;,
    &quot;daisyui&quot;: &quot;3.9.2&quot;,
    &quot;react&quot;: &quot;18.2.0&quot;,
    &quot;react-dom&quot;: &quot;18.2.0&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.4&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@vitejs/plugin-react&quot;: &quot;4.0.0&quot;,
    &quot;autoprefixer&quot;: &quot;10.4.15&quot;,
    &quot;postcss&quot;: &quot;8.4.28&quot;,
    &quot;tailwindcss&quot;: &quot;3.3.3&quot;,
    &quot;vite&quot;: &quot;4.4.9&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>// =========== Start App.res file
module ChatBox = Chat__Box</p>
<p>@react.component
let make = () =&gt; {
  let (username, setUsername) = React.useState(() =&gt; "")
  let (chats, setChats) = React.useState(() =&gt; [])
  let socket = React.useRef(None)</p>
<p>React.useEffect1(() =&gt; {
    let run = async () =&gt; {
      switch username {
        | "" =&gt; ()
        | username =&gt; {
          let chatHistory = await Util.fetchChatHistory(username)
          switch chatHistory {
            | Error(error) =&gt; {
              Console.error(error)
            }
            | Ok(chatHistory) =&gt; setChats((_prev) =&gt; chatHistory)
          }</p>
<pre class="codehilite"><code>      let url = `ws://localhost:3000/room?username=${username}`
      let ws = WebSocket.create(url)

      ws-&gt;WebSocket.set_onOpen(() =&gt; {
        Console.log(&quot;Connected to websocket&quot;)
      })

      ws-&gt;WebSocket.set_onMessage((event) =&gt; {
        let payload = Message.ToClient.deserializeOne(event.data)
        switch payload {
          | Error(error) =&gt; {
            Console.error(error)
          }
          | Ok(payload) =&gt; {
            setChats((prev) =&gt; {
              let newArr = Array.copy(prev)
              Array.push(newArr, payload)

              newArr
            })
          }
        }
      })

      socket.current = Some(ws)
    }
  }
}

let _ = run()

Some(() =&gt; {
  switch socket.current {
    | None =&gt; ()
    | Some(ws) =&gt; WebSocket.close(ws)
  }
})
</code></pre>

<p>}, [username])</p>
<p>let handleUsernameSubmit = (username) =&gt; {
    setUsername((_prev) =&gt; username)
  }</p>
<p>let handleChatSubmit = (from, message) =&gt; {
    switch socket.current {
      | None =&gt; ()
      | Some(ws) =&gt; {
        open Message</p>
<pre class="codehilite"><code>    let payload = ToServer.create(~from, ~message)
      -&gt; Message.ToServer.serialize

    switch payload {
      | Error(errMsg) =&gt; Console.error(errMsg)
      | Ok(payload) =&gt; ws-&gt;WebSocket.send(payload)
    }
  }
}
</code></pre>

<p>}</p>
<p><div className=<code>container
    mx-auto
    h-screen
    w-1/3
    flex
    flex-col</code>>
    <div className="mt-8">
      {switch username {
        | "" =&gt; (
          <Login
            onSubmit={handleUsernameSubmit}
          />
        )
        | username =&gt; (
          <ChatBox
            chats={chats}
            currentUser={username}
            onSubmit={handleChatSubmit}
          />
        )
      }}
    </div>
  </div>
}
// =========== End file</p>
<p>// =========== Start file App.resi
@react.component
let make: unit =&gt; Jsx.element
// =========== End file</p><h2>brightid--env</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Env.res</p>
<pre class="codehilite"><code>exception EnvError(string)
@module(&quot;find-up&quot;) external findUpSync: (string, 'options) =&gt; string = &quot;findUpSync&quot;
@module(&quot;dotenv&quot;) external createEnv: {&quot;path&quot;: string} =&gt; unit = &quot;config&quot;

let nodeEnv = Node.Process.process[&quot;env&quot;]

let createEnv = () =&gt; {
  let path = switch nodeEnv-&gt;Dict.get(&quot;ENV_FILE&quot;) {
  | None =&gt; &quot;.env.local&quot;-&gt;findUpSync()
  | Some(envFile) =&gt; envFile-&gt;findUpSync()
  }
  createEnv({&quot;path&quot;: path})
}

let env = name =&gt;
  switch Dict.get(nodeEnv, name) {
  | Some(value) =&gt; Ok(value)
  | None =&gt; Error(`Environment variable ${name} is missing`)
  }

let getConfig = () =&gt;
  switch (
    env(&quot;DISCORD_API_TOKEN&quot;),
    env(&quot;DISCORD_CLIENT_ID&quot;),
    env(&quot;UUID_NAMESPACE&quot;),
    env(&quot;GIST_ID&quot;),
    env(&quot;GITHUB_ACCESS_TOKEN&quot;),
    env(&quot;SPONSORSHIP_KEY&quot;),
    env(&quot;SPONSORSHIPS_WHITELIST&quot;),
    env(&quot;DISCORD_LOG_CHANNEL_ID&quot;),
  ) {
  // Got all vars
  | (
      Ok(discordApiToken),
      Ok(discordClientId),
      Ok(uuidNamespace),
      Ok(gistId),
      Ok(githubAccessToken),
      Ok(sponsorshipKey),
      Ok(sponsorshipsWhitelist),
      Ok(discordLogChannelId),
    ) =&gt;
    Ok({
      &quot;discordApiToken&quot;: discordApiToken,
      &quot;discordClientId&quot;: discordClientId,
      &quot;uuidNamespace&quot;: uuidNamespace,
      &quot;gistId&quot;: gistId,
      &quot;githubAccessToken&quot;: githubAccessToken,
      &quot;sponsorshipKey&quot;: sponsorshipKey,
      &quot;sponsorshipsWhitelist&quot;: sponsorshipsWhitelist,
      &quot;discordLogChannelId&quot;: discordLogChannelId,
    })
  // Did not get one or more vars, return the first error
  | (Error(_) as err, _, _, _, _, _, _, _)
  | (_, Error(_) as err, _, _, _, _, _, _)
  | (_, _, Error(_) as err, _, _, _, _, _)
  | (_, _, _, Error(_) as err, _, _, _, _)
  | (_, _, _, _, Error(_) as err, _, _, _)
  | (_, _, _, _, _, Error(_) as err, _, _)
  | (_, _, _, _, _, _, Error(_) as err, _)
  | (_, _, _, _, _, _, _, Error(_) as err) =&gt; err
  }
</code></pre>

<p>=========== End file</p><h2>catala-dsfr--allocation</h2><p>Rescript v10</p>
<p>Repo: https://github.com/CatalaLang/catala-dsfr</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;catala-dsfr&quot;,
  &quot;version&quot;: &quot;0.1.1&quot;,
  &quot;repository&quot;: &quot;https://github.com/CatalaLang/catala-dsfr&quot;,
  &quot;scripts&quot;: {
    &quot;clean&quot;: &quot;rescript clean -with-deps&quot;,
    &quot;build&quot;: &quot;yarn run pre &amp;&amp; vite build&quot;,
    &quot;deploy&quot;: &quot;yarn run build --base=/demos/catala/ &amp;&amp; rsync -rv --delete-before dist/*&quot;,
    &quot;serve&quot;: &quot;vite preview&quot;,
    &quot;dev&quot;: &quot;yarn run pre &amp;&amp; vite&quot;,
    &quot;re:build&quot;: &quot;rescript build -with-deps&quot;,
    &quot;re:watch&quot;: &quot;yarn run pre &amp;&amp; rescript build -w -with-deps&quot;,
    &quot;assets&quot;: &quot;rsync -r node_modules/@catala-lang/catala-web-assets/assets/* assets&quot;,
    &quot;postinstall&quot;: &quot;copy-dsfr-to-public&quot;,
    &quot;pre&quot;: &quot;yarn run re:build &amp;&amp; only-include-used-icons &amp;&amp; yarn run assets&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;author&quot;: &quot;Emile Rolley &lt;emile.rolley@tuta.io&gt;&quot;,
  &quot;license&quot;: &quot;Apache-2.0&quot;,
  &quot;dependencies&quot;: {
    &quot;@catala-lang/catala-explain&quot;: &quot;^0.2.2&quot;,
    &quot;@catala-lang/catala-web-assets&quot;: &quot;^0.8.9&quot;,
    &quot;@catala-lang/french-law&quot;: &quot;^0.8.3-b.3&quot;,
    &quot;@catala-lang/rescript-catala&quot;: &quot;^0.8.1-b.0&quot;,
    &quot;@codegouvfr/react-dsfr&quot;: &quot;^0.78.2&quot;,
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;@rescript/react&quot;: &quot;^0.11.0&quot;,
    &quot;@rjsf/core&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/utils&quot;: &quot;^5.1.0&quot;,
    &quot;@rjsf/validator-ajv8&quot;: &quot;^5.1.0&quot;,
    &quot;file-saver&quot;: &quot;^2.0.5&quot;,
    &quot;react&quot;: &quot;^18.2.0&quot;,
    &quot;react-dom&quot;: &quot;^18.2.0&quot;,
    &quot;react-loader-spinner&quot;: &quot;^5.4.5&quot;,
    &quot;rescript-docx&quot;: &quot;^0.1.5&quot;,
    &quot;tslib&quot;: &quot;^2.6.2&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@jihchi/vite-plugin-rescript&quot;: &quot;^5.1.0&quot;,
    &quot;@originjs/vite-plugin-commonjs&quot;: &quot;^1.0.3&quot;,
    &quot;@vitejs/plugin-react&quot;: &quot;^3.1.0&quot;,
    &quot;jsdom&quot;: &quot;^21.1.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.4&quot;,
    &quot;tailwindcss&quot;: &quot;^3.2.6&quot;,
    &quot;vite&quot;: &quot;^4.4.9&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file AllocationsFamiliales.res</p>
<pre class="codehilite"><code>module FormInfos = {
  let webAssets = WebAssets.allocationsFamilialesAssets
  let name = `allocations familiales`
  let resultLabel = `Montant mensuel des ${name}`
  let url = &quot;allocations-familiales&quot;

  // This function automatically assigns numerical ID to kids so we don't
  // have to ask the question in the form
  let formDataPostProcessing = %raw(`
      function (data) {
          var i = 0;
          for (var enfant of data.iEnfantsIn) {
              enfant.dIdentifiant = i;
              i++;
          }
          return data;
      }
  `)

  let computeAndPrintResult = (input: Js.Json.t): React.element =&gt; &lt;&gt;
    &lt;span className=&quot;font-mono font-bold text-[var(--text-active-blue-france)]&quot;&gt;
      {input-&gt;CatalaFrenchLaw.computeAllocationsFamiliales-&gt;Belt.Float.toString-&gt;React.string}
    &lt;/span&gt;
    {React.string(` €`)}
  &lt;/&gt;
}

module Form = Form.Make(FormInfos)

@react.component
let make = () =&gt; {
  React.useEffect0(() =&gt; {
    // Reset the log when the page is loaded.
    CatalaFrenchLaw.resetLog()
    None
  })

  &lt;div className=&quot;fr-container&quot;&gt;
    &lt;PageComponents.Title&gt;
      {&quot;Calcul des allocations familiales&quot;-&gt;React.string}
    &lt;/PageComponents.Title&gt;
    &lt;Form /&gt;
  &lt;/div&gt;
}
</code></pre>

<p>=========== End file</p><h2>res-x--client</h2><p>Rescript v11</p>
<p>Repo: https://github.com/zth/res-x</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;rescript-x&quot;,
  &quot;version&quot;: &quot;0.1.0-alpha.7&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;files&quot;: [
    &quot;README.md&quot;,
    &quot;CHANGELOG.md&quot;,
    &quot;rescript.json&quot;,
    &quot;src/**/*&quot;,
    &quot;res-x-vite-plugin.mjs&quot;
  ],
  &quot;author&quot;: &quot;Gabriel Nordeborn&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;peerDependencies&quot;: {
    &quot;rescript&quot;: &quot;&gt;=11.0.0-rc.5&quot;,
    &quot;@rescript/core&quot;: &quot;&gt;=0.5.0&quot;,
    &quot;vite&quot;: &quot;&gt;=4.4.11&quot;,
    &quot;rescript-bun&quot;: &quot;&gt;=0.1.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.5&quot;,
    &quot;rescript-bun&quot;: &quot;0.1.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Client.res</p>
<pre class="codehilite"><code>module Actions: {
  type t

  @tag(&quot;kind&quot;)
  type target = This | CssSelector({selector: string})

  @tag(&quot;kind&quot;)
  type action =
    | ToggleClass({target: target, className: string})
    | RemoveClass({target: target, className: string})
    | AddClass({target: target, className: string})
    | RemoveElement({target: target})

  let make: array&lt;action&gt; =&gt; t
} = {
  type t = string

  @tag(&quot;kind&quot;)
  type target = This | CssSelector({selector: string})

  @tag(&quot;kind&quot;)
  type action =
    | ToggleClass({target: target, className: string})
    | RemoveClass({target: target, className: string})
    | AddClass({target: target, className: string})
    | RemoveElement({target: target})

  external stringifyActions: array&lt;action&gt; =&gt; string = &quot;JSON.stringify&quot;

  let make = actions =&gt; stringifyActions(actions)
}

module ValidityMessage: {
  type config = {
    badInput?: string,
    patternMismatch?: string,
    rangeOverflow?: string,
    rangeUnderflow?: string,
    stepMismatch?: string,
    tooLong?: string,
    tooShort?: string,
    typeMismatch?: string,
    valueMissing?: string,
  }

  type t

  let make: config =&gt; t
} = {
  type config = {
    badInput?: string,
    patternMismatch?: string,
    rangeOverflow?: string,
    rangeUnderflow?: string,
    stepMismatch?: string,
    tooLong?: string,
    tooShort?: string,
    typeMismatch?: string,
    valueMissing?: string,
  }

  type t = string

  external stringifyConfig: config =&gt; string = &quot;JSON.stringify&quot;

  let make = config =&gt; stringifyConfig(config)
}
</code></pre>

<p>=========== End file</p><h2>res-x--staticexporter</h2><p>Rescript v11</p>
<p>Repo: https://github.com/zth/res-x</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;rescript-x&quot;,
  &quot;version&quot;: &quot;0.1.0-alpha.7&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;files&quot;: [
    &quot;README.md&quot;,
    &quot;CHANGELOG.md&quot;,
    &quot;rescript.json&quot;,
    &quot;src/**/*&quot;,
    &quot;res-x-vite-plugin.mjs&quot;
  ],
  &quot;author&quot;: &quot;Gabriel Nordeborn&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;peerDependencies&quot;: {
    &quot;rescript&quot;: &quot;&gt;=11.0.0-rc.5&quot;,
    &quot;@rescript/core&quot;: &quot;&gt;=0.5.0&quot;,
    &quot;vite&quot;: &quot;&gt;=4.4.11&quot;,
    &quot;rescript-bun&quot;: &quot;&gt;=0.1.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.5&quot;,
    &quot;rescript-bun&quot;: &quot;0.1.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file StaticExporter.res</p>
<pre class="codehilite"><code>open Bun

external process: 'a = &quot;process&quot;
external fetch: string =&gt; promise&lt;Response.t&gt; = &quot;fetch&quot;

let debugging = true

let debug = s =&gt;
  if debugging {
    Console.log2(&quot;[debug]&quot;, s)
  }

let log = s =&gt; Console.log2(&quot;[info]&quot;, s)

let run = async (server: Server.t, ~urls: array&lt;string&gt;) =&gt; {
  let serverUrl = `http://${server-&gt;Server.hostname}:${server-&gt;Server.port-&gt;Int.toString}`
  log(`Exporting ${urls-&gt;Array.length-&gt;Int.toString} URLs.`)

  let _ = await Promise.all(
    urls-&gt;Array.map(async url =&gt; {
      log(`[export] ${url} - Exporting...`)
      let res = await fetch(serverUrl ++ url)

      switch res-&gt;Response.status {
      | 200 =&gt;
        let structure =
          url
          -&gt;String.split(&quot;/&quot;)
          -&gt;Array.filter(p =&gt; p !== &quot;&quot;)
          -&gt;Array.toReversed

        let (sliceStart, fileName) = switch structure-&gt;Array.get(0) {
        | None | Some(&quot;&quot;) =&gt; (0, &quot;index.html&quot;)
        | Some(f) =&gt; (1, f ++ &quot;.html&quot;)
        }

        structure-&gt;Array.push(&quot;dist&quot;)

        let dirStructure = structure-&gt;Array.sliceToEnd(~start=sliceStart)-&gt;Array.toReversed

        switch dirStructure {
        | [] =&gt; ()
        | dirStructure =&gt;
          await Fs.mkdir(dirStructure-&gt;Array.joinWith(&quot;/&quot;), ~options={recursive: true})
        }

        dirStructure-&gt;Array.push(fileName)
        let filePath = dirStructure-&gt;Array.joinWith(&quot;/&quot;)

        await Fs.writeFile(filePath, await res-&gt;Response.text)
        log(`[export] ${url} - Wrote ${filePath}.`)

      | otherStatus =&gt; Console.error(url ++ &quot; gave status &quot; ++ otherStatus-&gt;Int.toString)
      }
    }),
  )

  log(&quot;Done.&quot;)

  server-&gt;Server.stop(~closeActiveConnections=true)
  process[&quot;exit&quot;](0)
}
</code></pre>

<p>=========== End file</p><h2>brightid--entryresserver</h2><p>Rescript v10</p>
<p>Repo: https://github.com/ShenaniganDApp/brightid-discord-bot</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;root&quot;,
  &quot;private&quot;: true,
  &quot;devDependencies&quot;: {
    &quot;patch-package&quot;: &quot;^6.4.7&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.2.0&quot;,
    &quot;brightid_sdk&quot;: &quot;^1.0.1&quot;,
    &quot;canvas&quot;: &quot;^2.9.0&quot;,
    &quot;concurrently&quot;: &quot;^7.1.0&quot;,
    &quot;dotenv&quot;: &quot;^8.2.0&quot;,
    &quot;find-up&quot;: &quot;^6.3.0&quot;,
    &quot;rescript&quot;: &quot;^10.1.0-rc.5&quot;,
    &quot;rescript-discordjs&quot;: &quot;^0.3.0&quot;,
    &quot;rescript-nodejs&quot;: &quot;^14.3.1&quot;,
    &quot;uuid&quot;: &quot;^8.3.0&quot;
  },
  &quot;scripts&quot;: {
    &quot;bot&quot;: &quot;yarn workspace @brightidbot/bot&quot;,
    &quot;web&quot;: &quot;yarn workspace @brightidbot/web&quot;,
    &quot;utils&quot;: &quot;yarn workspace @brightidbot/utils&quot;,
    &quot;scripts&quot;: &quot;yarn workspace @brightidbot/scripts&quot;,
    &quot;shared&quot;: &quot;yarn workspace @brightidbot/shared&quot;,
    &quot;re:build&quot;: &quot;yarn shared re:build &amp;&amp; yarn utils re:build &amp;&amp; yarn bot re:build &amp;&amp; yarn web re:build &amp;&amp; yarn scripts re:build&quot;
  },
  &quot;workspaces&quot;: [
    &quot;apps/*&quot;,
    &quot;packages/*&quot;
  ]
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file entryRes.server.res</p>
<pre class="codehilite"><code>module ResponseInit = {
  type t

  external make: {..} =&gt; t = &quot;%identity&quot;
}

module BodyInit = {
  open Webapi.Fetch
  external makeWithPipeapleStream: NodeJs.Stream.PassThrough.t&lt;
    NodeJs.Buffer.t,
    NodeJs.Buffer.t,
  &gt; =&gt; BodyInit.t = &quot;%identity&quot;
}

@module(&quot;isbot&quot;) external isbot: string =&gt; bool = &quot;default&quot;

module ReactDOMServer = {
  type pipe = NodeJs.Stream.PassThrough.t&lt;
    NodeJs.Buffer.t,
    NodeJs.Buffer.t,
  &gt; =&gt; NodeJs.Stream.writable&lt;NodeJs.Buffer.t&gt;
  type abort = unit =&gt; unit

  type pipeableStream = {
    abort: abort,
    pipe: pipe,
  }

  @get external pipe: pipeableStream =&gt; pipe = &quot;pipe&quot;
  @get external abort: pipeableStream =&gt; abort = &quot;abort&quot;

  @module(&quot;react-dom/server&quot;)
  external renderToPipeableStream: (React.element, 'options) =&gt; pipeableStream =
    &quot;renderToPipeableStream&quot;
}

// TODO: Swap out for Webapi.Fetch.Response when it supports construction
// See https://github.com/tinymce/rescript-webapi/issues/63
@new
external makeResponse: (Webapi.Fetch.BodyInit.t, ResponseInit.t) =&gt; Webapi.Fetch.Response.t =
  &quot;Response&quot;

type onAllReady = {
  onAllReady: unit =&gt; unit,
  onShellError: exn =&gt; unit,
  onError: exn =&gt; unit,
}
type onShellReady = {
  onShellReady: unit =&gt; unit,
  onShellError: exn =&gt; unit,
  onError: exn =&gt; unit,
}
type ready = AllReady(onAllReady) | ShellReady(onShellReady)

@live
let default = (request, responseStatusCode, responseHeaders, remixContext) =&gt; {
  open Webapi
  let abortDelay = 5000

  let maybeCallbackName =
    request
    -&gt;Fetch.Request.headers
    -&gt;Fetch.Headers.get(&quot;User-Agent&quot;)
    -&gt;Belt.Option.map(isbot)
    -&gt;Belt.Option.map(onAllReady =&gt; onAllReady ? &quot;onAllReady&quot; : &quot;onShellReady&quot;)

  Promise.make((resolve, reject) =&gt; {
    let onAllReadyOptions = pipe =&gt; {
      let callbackFn = () =&gt; {
        let body = NodeJs.Stream.PassThrough.make()

        request-&gt;Fetch.Request.headers-&gt;Fetch.Headers.set(&quot;Content-Type&quot;, &quot;text/html&quot;)

        let response = BodyInit.makeWithPipeapleStream(body)-&gt;makeResponse(
          ResponseInit.make({
            &quot;status&quot;: responseStatusCode,
            &quot;headers&quot;: responseHeaders,
          }),
        )

        resolve(. response)
        pipe(body)-&gt;ignore
      }
      {
        onAllReady: callbackFn,
        onShellError: err =&gt; reject(. err),
        onError: err =&gt; Js.Console.error(err),
      }
    }
    let onShellReadyOptions = pipe =&gt; {
      let callbackFn = () =&gt; {
        let body = NodeJs.Stream.PassThrough.make()

        request-&gt;Fetch.Request.headers-&gt;Fetch.Headers.set(&quot;Content-Type&quot;, &quot;text/html&quot;)

        let response = BodyInit.makeWithPipeapleStream(body)-&gt;makeResponse(
          ResponseInit.make({
            &quot;status&quot;: responseStatusCode,
            &quot;headers&quot;: responseHeaders,
          }),
        )

        resolve(. response)
        pipe(body)-&gt;ignore
      }
      {
        onShellReady: callbackFn,
        onShellError: err =&gt; reject(. err),
        onError: err =&gt; Js.Console.error(err),
      }
    }

    // This is hacky because we can't access the return in params in rescript
    open ReactDOMServer
    if maybeCallbackName-&gt;Belt.Option.getWithDefault(&quot;&quot;) === &quot;onAllReady&quot; {
      let allStream = renderToPipeableStream(
        &lt;Remix.RemixServer context={remixContext} url={request-&gt;Fetch.Request.url} /&gt;,
        onAllReadyOptions(%raw(`allStream`)-&gt;pipe),
      )
      let _ = NodeJs.Timers.setTimeout(allStream.abort, abortDelay)
    } else if maybeCallbackName-&gt;Belt.Option.getWithDefault(&quot;&quot;) === &quot;onShellReady&quot; {
      let {abort, pipe} = renderToPipeableStream(
        &lt;Remix.RemixServer context={remixContext} url={request-&gt;Fetch.Request.url} /&gt;,
        onShellReadyOptions(%raw(`pipe`)),
      )

      let _ = NodeJs.Timers.setTimeout(abort, abortDelay)
    }
  })
}
</code></pre>

<p>=========== End file</p><h2>chat-script--message-toclient</h2><p>Rescript v11</p>
<p>Repo: https://github.com/Exegetech/chat-rescript</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;shared&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;
  },
  &quot;dependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;0.5.0&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.4&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Message__ToClient.res</p>
<pre class="codehilite"><code>open Message__JSON

type t = {
  from: string,
  message: string,
  timestamp: float,
}

let getServerUsername = () =&gt; &quot;server&quot;

let create = (~from, ~message) =&gt; {
  let timestamp = Date.now()
  let message = {
    from,
    message,
    timestamp,
  }

  message
}

let encode = (message) =&gt; {
  [
    (&quot;from&quot;, String(message.from)),
    (&quot;message&quot;, String(message.message)),
    (&quot;timestamp&quot;, Number(message.timestamp)),
  ]
  -&gt; Dict.fromArray
  -&gt; Object
}

let serializeOne = (payload) =&gt; {
  payload
  -&gt; encode
  -&gt; stringify
}

let serializeMany = (payload) =&gt; {
  payload
  -&gt; Array.map(encode)
  -&gt; Array
  -&gt; stringify
}

let decode = (json) =&gt; {
  switch json {
    | Object(dict) =&gt; {
      let from = Dict.get(dict, &quot;from&quot;)
      let message = Dict.get(dict, &quot;message&quot;)
      let timestamp = Dict.get(dict, &quot;timestamp&quot;)

      switch (from, message, timestamp) {
        | (
          Some(String(from)),
          Some(String(message)),
          Some(Number(timestamp)),
        ) if from !== &quot;&quot; &amp;&amp; message !== &quot;&quot; =&gt; Ok({ from, message, timestamp })
        | _ =&gt; Error(&quot;Expected non empty string from, string message and number timestamp&quot;)
      }
    }
    | _ =&gt; Error(&quot;Expected an object&quot;)
  }
}

let deserializeOne = (payload) =&gt; {
  switch parse(payload) {
    | Error(errMsg) =&gt; Error(&quot;Error parsing JSON: &quot; ++ errMsg)
    | Ok(json) =&gt; decode(json)
  }
}

let deserializeMany = (payload) =&gt; {
  switch parse(payload) {
    | Error(errMsg) =&gt; Error(&quot;Error parsing JSON: &quot; ++ errMsg)
    | Ok(Array(jsons)) =&gt; {
      let decodedJsons = Array.map(jsons, decode)
      let successes = []
      let failures = []

      Array.forEach(decodedJsons, (json) =&gt; switch json {
        | Error(error) =&gt; Array.push(failures, error)
        | Ok(json) =&gt; Array.push(successes, json)
      })

      if Array.length(failures) &gt; 0 {
        failures
        -&gt; Array.joinWith(&quot;, &quot;)
        -&gt; Error
      } else {
        Ok(successes)
      }
    }
    | _ =&gt; Error(&quot;Expected an array&quot;)
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Message_ToClient.resi</p>
<pre class="codehilite"><code>type t = {
  from: string,
  message: string,
  timestamp: float,
}

let getServerUsername: () =&gt; string

let create: (~from: string, ~message: string) =&gt; t

let serializeOne: (t) =&gt; result&lt;string, string&gt;

let serializeMany: (array&lt;t&gt;) =&gt; result&lt;string, string&gt;

let deserializeOne: (string) =&gt; result&lt;t, string&gt;

let deserializeMany: (string) =&gt; result&lt;array&lt;t&gt;, string&gt;
</code></pre>

<p>=========== End file</p><h2>chat-script--backend--app</h2><p>=========== Start file App.res</p>
<pre class="codehilite"><code>open Fastify
open Node
open Message

module Seed = {
  let getFakeChats = () =&gt; {
    let now = Date.getTime(Date.make())

    let chats: array&lt;ToClient.t&gt; = [
      {
        from: &quot;GitHub Copilot&quot;,
        timestamp: now,
        message: &quot;Have you guys seen those AI robots? They can do some crazy things!&quot;
      },
      {
        from: &quot;Bard&quot;,
        timestamp: now -. 12000.0,
        message: &quot;Yeah, I heard they can even beat humans in chess.&quot;
      },
      {
        from: &quot;ChatGPT&quot;,
        timestamp: now -. 30000.0,
        message: &quot;Well, that's nothing. My AI assistant once translated \&quot;I love you\&quot; to \&quot;Error 404: Romance not found.\&quot;&quot;,
      }
    ]

    chats
  }
}

module Db = {
  let clients: Dict.t&lt;WebSocket.t&gt; = Dict.make()

  let chats: array&lt;ToClient.t&gt; = Seed.getFakeChats()
}

let getChatHistory = () =&gt; Array.copy(Db.chats)

let broadcast = (~payload, ~onError, ~exceptTo=?) =&gt; {
  switch ToClient.serializeOne(payload) {
    | Error(error) =&gt; onError(error)
    | Ok(message) =&gt; Db.clients
      -&gt; Dict.toArray
      -&gt; Array.forEach(((username, socket)) =&gt; {
        switch exceptTo {
          | None =&gt; socket-&gt;WebSocket.send(message)
          | Some(exceptTo) =&gt; {
            if username !== exceptTo {
              socket-&gt;WebSocket.send(message)
            }
          }
        }
      })
  }
}

let handleClient = (~username, ~socket, ~onError) =&gt; {
  Dict.set(Db.clients, username, socket)

  let payload = ToClient.create(
    ~from=ToClient.getServerUsername(),
    ~message=`${username} joined`,
  )

  broadcast(~payload, ~onError, ~exceptTo=username)

  socket-&gt;WebSocket.onMessage((buffer) =&gt; {
    let string = buffer-&gt;Buffer.toString
    let message = ToServer.deserialize(string)
    switch message {
      | Error(error) =&gt; onError(error)
      | Ok(message) =&gt; {
        let payload = ToClient.create(~from=username, ~message=message.message)

        Array.push(Db.chats, payload)

        broadcast(~payload, ~onError)
      }
    }
  })

  socket-&gt;WebSocket.onClose(() =&gt; {
    let payload = ToClient.create(
      ~from=ToClient.getServerUsername(),
      ~message=`${username} left`,
    )

    broadcast(~payload, ~onError, ~exceptTo=username)
  })
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file Chat.resi</p>
<pre class="codehilite"><code>let getChatHistory: () =&gt; array&lt;Message.ToClient.t&gt;

let handleClient: (
  ~username: string,
  ~socket: Fastify.WebSocket.t,
  ~onError: (string) =&gt; (),
) =&gt; ()
</code></pre>

<p>=========== End file</p><h2>res-x--h</h2><p>Rescript v11</p>
<p>Repo: https://github.com/zth/res-x</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;rescript-x&quot;,
  &quot;version&quot;: &quot;0.1.0-alpha.7&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;files&quot;: [
    &quot;README.md&quot;,
    &quot;CHANGELOG.md&quot;,
    &quot;rescript.json&quot;,
    &quot;src/**/*&quot;,
    &quot;res-x-vite-plugin.mjs&quot;
  ],
  &quot;author&quot;: &quot;Gabriel Nordeborn&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;peerDependencies&quot;: {
    &quot;rescript&quot;: &quot;&gt;=11.0.0-rc.5&quot;,
    &quot;@rescript/core&quot;: &quot;&gt;=0.5.0&quot;,
    &quot;vite&quot;: &quot;&gt;=4.4.11&quot;,
    &quot;rescript-bun&quot;: &quot;&gt;=0.1.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.5&quot;,
    &quot;rescript-bun&quot;: &quot;0.1.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file H.res</p>
<pre class="codehilite"><code>@val external null: Jsx.element = &quot;null&quot;

external float: float =&gt; Jsx.element = &quot;%identity&quot;
external int: int =&gt; Jsx.element = &quot;%identity&quot;
external string: string =&gt; Jsx.element = &quot;%identity&quot;
external array: array&lt;Jsx.element&gt; =&gt; Jsx.element = &quot;%identity&quot;

@module(&quot;./vendor/hyperons.js&quot;)
external renderToString: Jsx.element =&gt; promise&lt;string&gt; = &quot;render&quot;

@module(&quot;./vendor/hyperons.js&quot;)
external renderToStream: (Jsx.element, ~onChunk: string =&gt; unit=?) =&gt; promise&lt;unit&gt; = &quot;render&quot;

module Context = {
  type t&lt;'context&gt;

  type props&lt;'context&gt; = {
    value: 'context,
    children: Jsx.element,
  }

  @module(&quot;./vendor/hyperons.js&quot;)
  external createContext: 'context =&gt; t&lt;'context&gt; = &quot;createContext&quot;

  @module(&quot;./vendor/hyperons.js&quot;)
  external useContext: t&lt;'context&gt; =&gt; 'context = &quot;useContext&quot;

  @get external provider: t&lt;'context&gt; =&gt; Jsx.component&lt;props&lt;'context&gt;&gt; = &quot;Provider&quot;
}

module Fragment = {
  type fragmentProps = {children: Jsx.element}
  @module(&quot;./vendor/hyperons.js&quot;)
  external make: fragmentProps =&gt; Jsx.element = &quot;Fragment&quot;
}
</code></pre>

<p>=========== End file</p><h2>res-x--reactdom</h2><p>Rescript v11</p>
<p>Repo: https://github.com/zth/res-x</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;rescript-x&quot;,
  &quot;version&quot;: &quot;0.1.0-alpha.7&quot;,
  &quot;scripts&quot;: {
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:dev&quot;: &quot;rescript build -w&quot;
  },
  &quot;keywords&quot;: [
    &quot;rescript&quot;
  ],
  &quot;files&quot;: [
    &quot;README.md&quot;,
    &quot;CHANGELOG.md&quot;,
    &quot;rescript.json&quot;,
    &quot;src/**/*&quot;,
    &quot;res-x-vite-plugin.mjs&quot;
  ],
  &quot;author&quot;: &quot;Gabriel Nordeborn&quot;,
  &quot;license&quot;: &quot;MIT&quot;,
  &quot;peerDependencies&quot;: {
    &quot;rescript&quot;: &quot;&gt;=11.0.0-rc.5&quot;,
    &quot;@rescript/core&quot;: &quot;&gt;=0.5.0&quot;,
    &quot;vite&quot;: &quot;&gt;=4.4.11&quot;,
    &quot;rescript-bun&quot;: &quot;&gt;=0.1.0&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@rescript/core&quot;: &quot;^0.5.0&quot;,
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;,
    &quot;rescript&quot;: &quot;11.0.0-rc.5&quot;,
    &quot;rescript-bun&quot;: &quot;0.1.0&quot;
  },
  &quot;dependencies&quot;: {
    &quot;fast-glob&quot;: &quot;^3.3.1&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file ResX__ReactDOM.res</p>
<pre class="codehilite"><code>@module(&quot;./vendor/hyperons.js&quot;)
external jsx: (string, H__domProps.domProps) =&gt; Jsx.element = &quot;h&quot;

@module(&quot;./vendor/hyperons.js&quot;)
external jsxs: (string, H__domProps.domProps) =&gt; Jsx.element = &quot;h&quot;

external someElement: Jsx.element =&gt; option&lt;Jsx.element&gt; = &quot;%identity&quot;
</code></pre>

<p>=========== End file</p><h2>fullstack--app</h2><p>Rescript v10</p>
<p>Repo: https://github.com/skonky/fullstack</p>
<p>=========== Start file package.json (part or full code)</p>
<pre class="codehilite"><code>{
  &quot;name&quot;: &quot;rescript-web&quot;,
  &quot;version&quot;: &quot;0.0.0&quot;,
  &quot;author&quot;: &quot;skonky&quot;,
  &quot;private&quot;: true,
  &quot;license&quot;: &quot;Apache-2.0&quot;,
  &quot;dependencies&quot;: {
    &quot;next&quot;: &quot;10.2.3&quot;,
    &quot;react&quot;: &quot;17.0.1&quot;,
    &quot;react-dom&quot;: &quot;17.0.1&quot;
  },
  &quot;scripts&quot;: {
    &quot;dev&quot;: &quot;concurrently \&quot;next dev -p 5000\&quot; \&quot;rescript build -w\&quot;&quot;,
    &quot;debug&quot;: &quot;NODE_OPTIONS='--inspect' next&quot;,
    &quot;build&quot;: &quot;rescript &amp;&amp; next build&quot;,
    &quot;now-build&quot;: &quot;rescript &amp;&amp; next build&quot;,
    &quot;export&quot;: &quot;next export&quot;,
    &quot;start&quot;: &quot;next start -p $PORT&quot;,
    &quot;res:build&quot;: &quot;rescript&quot;,
    &quot;res:clean&quot;: &quot;rescript clean&quot;,
    &quot;res:start&quot;: &quot;rescript build -w&quot;
  },
  &quot;devDependencies&quot;: {
    &quot;@rescript/react&quot;: &quot;0.10.3&quot;,
    &quot;autoprefixer&quot;: &quot;10.1.0&quot;,
    &quot;concurrently&quot;: &quot;^7.6.0&quot;,
    &quot;cssnano&quot;: &quot;5.0.5&quot;,
    &quot;daisyui&quot;: &quot;^2.51.3&quot;,
    &quot;gentype&quot;: &quot;4.1&quot;,
    &quot;next-transpile-modules&quot;: &quot;7.1.2&quot;,
    &quot;postcss&quot;: &quot;8.2.15&quot;,
    &quot;postcss-cli&quot;: &quot;8.3.1&quot;,
    &quot;rescript&quot;: &quot;9.1&quot;,
    &quot;tailwindcss&quot;: &quot;^3.0.23&quot;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file App.res</p>
<pre class="codehilite"><code>// This type is based on the getInitialProps return value.
// If you are using getServerSideProps or getStaticProps, you probably
// will never need this
// See https://nextjs.org/docs/advanced-features/custom-app
type pageProps

module PageComponent = {
  type t = React.component&lt;pageProps&gt;
}

type props = {
  @as(&quot;Component&quot;)
  component: PageComponent.t,
  pageProps: pageProps,
}

// We are not using `@react.component` since we will never
// use &lt;App/&gt; within our ReScript code.
// It's only used within `pages/_app.js`
let default = (props: props): React.element =&gt; {
  let {component, pageProps} = props

  let router = Next.Router.useRouter()

  let content = React.createElement(component, pageProps)

  switch router.route {
  | &quot;/examples&quot; =&gt; &lt;MainLayout&gt; content &lt;/MainLayout&gt;
  | _ =&gt; &lt;MainLayout&gt; content &lt;/MainLayout&gt;
  }
}
</code></pre>

<p>=========== End file</p>
<p>=========== Start file App.resi</p>
<pre class="codehilite"><code>type props
let default: props =&gt; React.element
</code></pre>

<p>=========== End file</p>